"use strict";(self.webpackChunkmikes_dev_notebook=self.webpackChunkmikes_dev_notebook||[]).push([[62160],{3905:(e,t,a)=>{a.d(t,{Zo:()=>c,kt:()=>h});var n=a(67294);function o(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function s(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){o(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function i(e,t){if(null==e)return{};var a,n,o=function(e,t){if(null==e)return{};var a,n,o={},r=Object.keys(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||(o[a]=e[a]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(o[a]=e[a])}return o}var l=n.createContext({}),p=function(e){var t=n.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):s(s({},t),e)),a},c=function(e){var t=p(e.components);return n.createElement(l.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},d=n.forwardRef((function(e,t){var a=e.components,o=e.mdxType,r=e.originalType,l=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),d=p(a),h=o,m=d["".concat(l,".").concat(h)]||d[h]||u[h]||r;return a?n.createElement(m,s(s({ref:t},c),{},{components:a})):n.createElement(m,s({ref:t},c))}));function h(e,t){var a=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=a.length,s=new Array(r);s[0]=d;var i={};for(var l in t)hasOwnProperty.call(t,l)&&(i[l]=t[l]);i.originalType=e,i.mdxType="string"==typeof e?e:o,s[1]=i;for(var p=2;p<r;p++)s[p]=a[p];return n.createElement.apply(null,s)}return n.createElement.apply(null,a)}d.displayName="MDXCreateElement"},27606:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>l,contentTitle:()=>s,default:()=>u,frontMatter:()=>r,metadata:()=>i,toc:()=>p});var n=a(87462),o=(a(67294),a(3905));const r={sidebar_position:9010,slug:"2021-10-14",title:"Zabbix Apache 2 Monitor",authors:"mpolinowski",tags:["Zabbix","Linux","Apache"]},s=void 0,i={unversionedId:"DevOps/Zabbix/2021-01-14--zabbix-apache2-monitor/index",id:"DevOps/Zabbix/2021-01-14--zabbix-apache2-monitor/index",title:"Zabbix Apache 2 Monitor",description:"Guangzhou, China",source:"@site/docs/DevOps/Zabbix/2021-01-14--zabbix-apache2-monitor/index.md",sourceDirName:"DevOps/Zabbix/2021-01-14--zabbix-apache2-monitor",slug:"/DevOps/Zabbix/2021-01-14--zabbix-apache2-monitor/2021-10-14",permalink:"/docs/DevOps/Zabbix/2021-01-14--zabbix-apache2-monitor/2021-10-14",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/DevOps/Zabbix/2021-01-14--zabbix-apache2-monitor/index.md",tags:[{label:"Zabbix",permalink:"/docs/tags/zabbix"},{label:"Linux",permalink:"/docs/tags/linux"},{label:"Apache",permalink:"/docs/tags/apache"}],version:"current",sidebarPosition:9010,frontMatter:{sidebar_position:9010,slug:"2021-10-14",title:"Zabbix Apache 2 Monitor",authors:"mpolinowski",tags:["Zabbix","Linux","Apache"]},sidebar:"tutorialSidebar",previous:{title:"Zabbix Docker-Compose Setup",permalink:"/docs/DevOps/Zabbix/2021-10-13--zabbix-compose-setup/2021-10-13"},next:{title:"Slack Notifications in DevOps",permalink:"/docs/DevOps/Zabbix/2020-09-05--slack-notifications-in-devops/2020-09-05"}},l={},p=[{value:"Apache Module mod_status",id:"apache-module-mod_status",level:2},{value:"Configure Zabbix Agent",id:"configure-zabbix-agent",level:2},{value:"Solution",id:"solution",level:2}],c={toc:p};function u(e){let{components:t,...r}=e;return(0,o.kt)("wrapper",(0,n.Z)({},c,r,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"Guangzhou, China",src:a(48155).Z,width:"1500",height:"467"})),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#apache-module-mod_status"},"Apache Module mod","_","status")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#configure-zabbix-agent"},"Configure Zabbix Agent")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#solution"},"Solution"))),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},(0,o.kt)("strong",{parentName:"p"},"Update"),": I had a couple of issues below. In the end ",(0,o.kt)("a",{parentName:"p",href:"#solution"},"switching the template from HTTP to Zabbix Agent solved it"),".")),(0,o.kt)("h2",{id:"apache-module-mod_status"},"Apache Module mod_status"),(0,o.kt)("p",null,"Activate the ",(0,o.kt)("strong",{parentName:"p"},"Server Status")," module:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"sudo a2enmod status\n")),(0,o.kt)("p",null,"And add the configuration to:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"nano /etc/apache2/mods-available/status.conf\n")),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://httpd.apache.org/docs/2.4/mod/mod_status.html"},"Enabling Status Support")," for the host you want to monitor:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-html"},'<IfModule mod_status.c>\n        # Allow server status reports generated by mod_status,\n        # with the URL of http://servername/server-status\n        # Uncomment and change the "192.0.2.0/24" to allow access from other hosts.\n\n        <Location /server-status>\n                SetHandler server-status\n\n                ##Allow all IPs to access for testing\n                #Allow from all\n\n                ##Allow only localhost and local server IP\n                Order deny,allow\n                Deny from all\n                Allow from 127.0.0.1 ::1\n                Allow from Your.Server.IP.Address.Here\n\n                ##Limit access from other hosts\n                #Require local\n                #Require ip 192.0.2.0/24\n                #Require host example.com\n        </Location>\n\n        # Keep track of extended status information for each request\n        ExtendedStatus On\n\n        # Determine if mod_status displays the first 63 characters of a request or\n        # the last 63, assuming the request itself is greater than 63 chars.\n        # Default: Off\n        #SeeRequestTail On\n        <IfModule mod_proxy.c>\n                # Show Proxy LoadBalancer status in mod_status\n                ProxyStatus On\n        </IfModule>\n</IfModule>\n')),(0,o.kt)("p",null,"Check config integrity and restart:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"apachectl configtest\napache2 -t # or httpd -t\nsystemctl restart apache2 # or httpd\n")),(0,o.kt)("p",null,"Or all in one line:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"apache2ctl -t && apache2ctl graceful\n")),(0,o.kt)("p",null,"Test the status output by:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"curl http://127.0.0.1/server-status?auto\n127.0.0.1\nServerVersion: Apache/2.4.25 (Debian) OpenSSL/1.0.2q\nServerMPM: prefork\nServer Built: 2018-11-03T18:46:19\nCurrentTime: Tuesday, 09-Nov-2021 07:24:39 CET\nRestartTime: Tuesday, 09-Nov-2021 06:44:31 CET\nParentServerConfigGeneration: 1\nParentServerMPMGeneration: 0\nServerUptimeSeconds: 2408\nServerUptime: 40 minutes 8 seconds\nLoad1: 0.07\nLoad5: 0.24\nLoad15: 0.53\nTotal Accesses: 319\nTotal kBytes: 1554\nCPUUser: 5.52\nCPUSystem: 2.06\nCPUChildrenUser: 0\nCPUChildrenSystem: 0\nCPULoad: .314784\nUptime: 2408\nReqPerSec: .132475\nBytesPerSec: 660.837\nBytesPerReq: 4988.39\nBusyWorkers: 2\nIdleWorkers: 8\nScoreboard: _W____W___............................................................................................................................................\nTLSSessionCacheStatus\nCacheType: SHMCB\nCacheSharedMemory: 512000\nCacheCurrentEntries: 35\nCacheSubcaches: 32\nCacheIndexesPerSubcaches: 88\nCacheTimeLeftOldestAvg: 123\nCacheTimeLeftOldestMin: 0\nCacheTimeLeftOldestMax: 262\nCacheIndexUsage: 1%\nCacheUsage: 1%\nCacheStoreCount: 279\nCacheReplaceCount: 0\nCacheExpireCount: 244\nCacheDiscardCount: 0\nCacheRetrieveHitCount: 0\nCacheRetrieveMissCount: 38\nCacheRemoveHitCount: 0\nCacheRemoveMissCount: 0\n")),(0,o.kt)("h2",{id:"configure-zabbix-agent"},"Configure Zabbix Agent"),(0,o.kt)("p",null,"Stat by adding the Apache by HTML template:"),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"Zabbix Apache Monitor",src:a(78058).Z,width:"913",height:"327"})),(0,o.kt)("p",null,"Currently I am only getting the Uptime and Ping:"),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"Zabbix Apache Monitor",src:a(17876).Z,width:"1090",height:"255"})),(0,o.kt)("p",null,"Those are the ",(0,o.kt)("a",{parentName:"p",href:"https://www.zabbix.com/integrations/apache"},"only passively collected")," items of Apache template. All other depend on the queried status from our Apache server. I found that the host address was not set to ",(0,o.kt)("inlineCode",{parentName:"p"},"localhost"),":"),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"Zabbix Apache Monitor",src:a(77425).Z,width:"1160",height:"483"})),(0,o.kt)("p",null,"So I added the macro and set:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"{$APACHE.STATUS.HOST} 127.0.0.1\n")),(0,o.kt)("p",null,"to make sure that the agent is querying from there and is not blocked (on the server IP address I am forcing an HTTPS upgrade of the connection - so using localhost instead allows me to get around that.):"),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"Zabbix Apache Monitor",src:a(52341).Z,width:"1180",height:"322"})),(0,o.kt)("p",null,"But this did not solve the issue :( Initially I though it might be because of an outdated Apache Version - but this is ",(0,o.kt)("em",{parentName:"p"},"fairly")," up-2-date for Debian standards (I have seen the template work with ",(0,o.kt)("inlineCode",{parentName:"p"},"Apache/2.4.37"),"):"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"apache2 -version\nServer version: Apache/2.4.25 (Debian)\n")),(0,o.kt)("p",null,"One more try - I edited the URL that is used by the Apache template:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"{$APACHE.STATUS.SCHEME}://{HOST.CONN}:{$APACHE.STATUS.PORT}/{\\$APACHE.STATUS.PATH}\n")),(0,o.kt)("p",null,"And hardcoded it:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"http://127.0.0.1/server-status?auto\n")),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"Zabbix Apache Monitor",src:a(9740).Z,width:"907",height:"360"})),(0,o.kt)("h2",{id:"solution"},"Solution"),(0,o.kt)("p",null,"For some reasons the template ",(0,o.kt)("inlineCode",{parentName:"p"},"Template App Apache by HTTP")," is not working for me. Switching to ",(0,o.kt)("inlineCode",{parentName:"p"},"Template App Apache by Zabbix agent")," solved it:"),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"Zabbix Apache Monitor",src:a(91665).Z,width:"938",height:"335"})),(0,o.kt)("p",null,"I kept all changes I made above in place and all items started populating once I made the switch to the Agent template:"),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"Zabbix Apache Monitor",src:a(63871).Z,width:"1024",height:"674"})))}u.isMDXComponent=!0},78058:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/Zabbix_Apache2_Monitor_01-b2b476e3bb6f8a8b16a5fecfa3d740b7.png"},17876:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/Zabbix_Apache2_Monitor_02-5471252ad8daff5663ab65dbc156e30e.png"},77425:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/Zabbix_Apache2_Monitor_03-b962990ae1c4a4ab4e19fbe39fb7ff6d.png"},52341:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/Zabbix_Apache2_Monitor_04-f9baa5fd1925acdc296076b235765aae.png"},9740:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/Zabbix_Apache2_Monitor_05-859ff9ff33464a761a27482fffb3700b.png"},91665:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/Zabbix_Apache2_Monitor_06-e27292f3202bd236a176d57aa6558558.png"},63871:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/Zabbix_Apache2_Monitor_07-6a7e10dca5ff713dce89021eb298aa64.png"},48155:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/photo-kt443t6d_64hdh43hfh6dgjdfhg4_d-539dc0d90c8fd4caf3d5cd5162b8ded5.jpg"}}]);