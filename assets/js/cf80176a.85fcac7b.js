"use strict";(self.webpackChunkmikes_dev_notebook=self.webpackChunkmikes_dev_notebook||[]).push([[48077],{3905:(e,t,r)=>{r.d(t,{Zo:()=>c,kt:()=>u});var n=r(67294);function i(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function a(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){i(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function s(e,t){if(null==e)return{};var r,n,i=function(e,t){if(null==e)return{};var r,n,i={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(i[r]=e[r]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}var l=n.createContext({}),p=function(e){var t=n.useContext(l),r=t;return e&&(r="function"==typeof e?e(t):a(a({},t),e)),r},c=function(e){var t=p(e.components);return n.createElement(l.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},f=n.forwardRef((function(e,t){var r=e.components,i=e.mdxType,o=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),f=p(r),u=i,m=f["".concat(l,".").concat(u)]||f[u]||d[u]||o;return r?n.createElement(m,a(a({ref:t},c),{},{components:r})):n.createElement(m,a({ref:t},c))}));function u(e,t){var r=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var o=r.length,a=new Array(o);a[0]=f;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:i,a[1]=s;for(var p=2;p<o;p++)a[p]=r[p];return n.createElement.apply(null,a)}return n.createElement.apply(null,r)}f.displayName="MDXCreateElement"},71151:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>l,contentTitle:()=>a,default:()=>d,frontMatter:()=>o,metadata:()=>s,toc:()=>p});var n=r(87462),i=(r(67294),r(3905));const o={sidebar_position:6010,slug:"2021-10-12",title:"Setting up Wordpress with Traefik v2",authors:"mpolinowski",tags:["Traefik","Linux","Docker"]},a=void 0,s={unversionedId:"DevOps/Provisioning/2021-10-12--traefik-third-attempt/index",id:"DevOps/Provisioning/2021-10-12--traefik-third-attempt/index",title:"Setting up Wordpress with Traefik v2",description:"Central, Hong Kong",source:"@site/docs/DevOps/Provisioning/2021-10-12--traefik-third-attempt/index.md",sourceDirName:"DevOps/Provisioning/2021-10-12--traefik-third-attempt",slug:"/DevOps/Provisioning/2021-10-12--traefik-third-attempt/2021-10-12",permalink:"/docs/DevOps/Provisioning/2021-10-12--traefik-third-attempt/2021-10-12",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/DevOps/Provisioning/2021-10-12--traefik-third-attempt/index.md",tags:[{label:"Traefik",permalink:"/docs/tags/traefik"},{label:"Linux",permalink:"/docs/tags/linux"},{label:"Docker",permalink:"/docs/tags/docker"}],version:"current",sidebarPosition:6010,frontMatter:{sidebar_position:6010,slug:"2021-10-12",title:"Setting up Wordpress with Traefik v2",authors:"mpolinowski",tags:["Traefik","Linux","Docker"]},sidebar:"tutorialSidebar",previous:{title:"Matrix Secure Messaging",permalink:"/docs/DevOps/Provisioning/2021-10-25--matrix-secure-messaging/2021-10-25"},next:{title:"Traefik v2 Webproxy Configuration - 2nd Attempt",permalink:"/docs/DevOps/Provisioning/2021-10-12--traefik-second-attempt/2021-10-12"}},l={},p=[{value:"Preparation",id:"preparation",level:2},{value:"Folders and Files",id:"folders-and-files",level:3},{value:"Proxy Network",id:"proxy-network",level:3},{value:"Configuration",id:"configuration",level:2},{value:"Docker Compose",id:"docker-compose",level:3},{value:"Dynamic Configuration",id:"dynamic-configuration",level:3}],c={toc:p};function d(e){let{components:t,...o}=e;return(0,i.kt)("wrapper",(0,n.Z)({},c,o,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Central, Hong Kong",src:r(46460).Z,width:"1500",height:"473"})),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"This guide is incomplete... Traefik, atm unfortunately, does not match my workflow. I am running into a lot of issues with the official documentation as well as the countless tutorials out there. I will put this project on hold until I figured it out.")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#preparation"},"Preparation"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#folders-and-files"},"Folders and Files")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#proxy-network"},"Proxy Network")))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#configuration"},"Configuration"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#docker-compose"},"Docker Compose")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#dynamic-configuration"},"Dynamic Configuration"))))),(0,i.kt)("h2",{id:"preparation"},"Preparation"),(0,i.kt)("h3",{id:"folders-and-files"},"Folders and Files"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"mkdir -p /opt/traefik/{letsencrypt,config,db,wp}\n")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"touch /opt/traefik/traefik.log\n")),(0,i.kt)("h3",{id:"proxy-network"},"Proxy Network"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"docker network create --gateway 192.168.144.1 --subnet 192.168.144.0/24 traefik_proxy\n")),(0,i.kt)("h2",{id:"configuration"},"Configuration"),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://gist.github.com/Mau5Machine"},"Configuration Files by @Mau5Machine")),(0,i.kt)("h3",{id:"docker-compose"},"Docker Compose"),(0,i.kt)("p",null,(0,i.kt)("em",{parentName:"p"},"/opt/traefik/docker-compose.yml")),(0,i.kt)("p",null,"Instead of using a YML or TOML file and file provider to link it, we will add all ",(0,i.kt)("strong",{parentName:"p"},"Static Configuration")," directly to the Docker Compose file:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yml"},'version: "3.3"\n\nservices:\n  ################################################\n  ####        Traefik Proxy Setup           #####\n  ###############################################\n  traefik:\n    image: traefik:v2.5\n    restart: always\n    container_name: traefik\n    ports:\n      - "80:80" # <== http\n      - "8080:8080" # <== :8080 is where the dashboard runs on\n      - "443:443" # <== https\n    command:\n    #### These are the CLI commands that will configure Traefik and tell it how to work! ####\n      ## API Settings - https://docs.traefik.io/operations/api/, endpoints - https://docs.traefik.io/operations/api/#endpoints ##\n      - --api.insecure=true # <== Enabling insecure api, NOT RECOMMENDED FOR PRODUCTION\n      - --api.dashboard=true # <== Enabling the dashboard to view services, middlewares, routers, etc...\n      - --api.debug=true # <== Enabling additional endpoints for debugging and profiling\n      ## Log Settings (options: ERROR, DEBUG, PANIC, FATAL, WARN, INFO) - https://docs.traefik.io/observability/logs/ ##\n      - --log.level=DEBUG # <== Setting the level of the logs from traefik\n      ## Provider Settings - https://docs.traefik.io/providers/docker/#provider-configuration ##\n      - --providers.docker=true # <== Enabling docker as the provider for traefik\n      - --providers.docker.exposedbydefault=false # <== Don\'t expose every container to traefik, only expose enabled ones\n      - --providers.file.filename=/dynamic.yaml # <== Referring to a dynamic configuration file\n      - --providers.docker.network=web # <== Operate on the docker network named web\n      ## Entrypoints Settings - https://docs.traefik.io/routing/entrypoints/#configuration ##\n      - --entrypoints.web.address=:80 # <== Defining an entrypoint for port :80 named web\n      - --entrypoints.web-secured.address=:443 # <== Defining an entrypoint for https on port :443 named web-secured\n      ## Certificate Settings (Let\'s Encrypt) -  https://docs.traefik.io/https/acme/#configuration-examples ##\n      - --certificatesresolvers.mytlschallenge.acme.tlschallenge=true # <== Enable TLS-ALPN-01 to generate and renew ACME certs\n      - --certificatesresolvers.mytlschallenge.acme.email=mpolinowski@gmail.com # <== Setting email for certs\n      - --certificatesresolvers.mytlschallenge.acme.storage=/letsencrypt/acme.json # <== Defining acme file to store cert information\n    volumes:\n      - /opt/traefik/letsencrypt:/letsencrypt # <== Volume for certs (TLS)\n      - /var/run/docker.sock:/var/run/docker.sock # <== Volume for docker admin\n      - /opt/traefik/config/dynamic.yml:/dynamic.yml # <== Volume for dynamic conf file, **ref: line 27\n    networks:\n      - web # <== Placing traefik on the network named web, to access containers on this network\n    labels:\n    #### Labels define the behaviour and rules of the traefik proxy for this container ####\n      - "traefik.enable=true" # <== Enable traefik on itself to view dashboard and assign subdomain to view it\n      - "traefik.http.routers.api.rule=Host(`monitor.example.com`)" # <== Setting the domain for the dashboard\n      - "traefik.http.routers.api.service=api@internal" # <== Enabling the api to be a service to access\n\n  ################################################\n  ####         Site Setup Container         #####\n  ##############################################\n  wordpress: # <== we aren\'t going to open :80 here because traefik is going to serve this on entrypoint \'web\'\n  ## :80 is already exposed from within the container ##\n    image: wordpress\n    restart: always\n    container_name: wp\n    environment:\n      WORDPRESS_DB_HOST: db\n      WORDPRESS_DB_USER: exampleuser\n      WORDPRESS_DB_PASSWORD: examplepass\n      WORDPRESS_DB_NAME: exampledb\n    volumes:\n      - /opt/traefik/wp:/var/www/html\n    networks:\n      - web\n      - backend\n    labels:\n      #### Labels define the behavior and rules of the traefik proxy for this container ####\n      - "traefik.enable=true" # <== Enable traefik to proxy this container\n      - "traefik.http.routers.traefik-web.rule=Host(`example.com`)" # <== Your Domain Name goes here for the http rule\n      - "traefik.http.routers.traefik-web.entrypoints=web" # <== Defining the entrypoint for http, **ref: line 30\n      - "traefik.http.routers.traefik-web.middlewares=redirect@file" # <== This is a middleware to redirect to https\n      - "traefik.http.routers.traefik-secured.rule=Host(`example.com`)" # <== Your Domain Name for the https rule\n      - "traefik.http.routers.traefik-secured.entrypoints=web-secured" # <== Defining entrypoint for https, **ref: line 31\n      - "traefik.http.routers.traefik-secured.tls.certresolver=mytlschallenge" # <== Defining certsresolvers for https\n\n ################################################\n ####     DB Container not on traefik      #####\n ##############################################\n  db:\n    image: mysql:5.7\n    restart: always\n    environment:\n      MYSQL_DATABASE: exampledb\n      MYSQL_USER: exampleuser\n      MYSQL_PASSWORD: examplepass\n      MYSQL_RANDOM_ROOT_PASSWORD: \'1\'\n    volumes:\n      - /opt/traefik/db:/var/lib/mysql\n    networks:\n      - backend\n\nnetworks:\n  web:\n    external: true\n  backend:\n    external: false\n\n volumes:\n  wordpress:\n    external: true\n  db:\n    external: true\n')),(0,i.kt)("h3",{id:"dynamic-configuration"},"Dynamic Configuration"),(0,i.kt)("p",null,"We used the file provider above to point to our dynamic configuration:"),(0,i.kt)("p",null,(0,i.kt)("em",{parentName:"p"},"/opt/traefik/config/dynamic.yml")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yml"},"## Setting up the middleware for redirect to https ##\nhttp:\n  middlewares:\n    redirect:\n      redirectScheme:\n        scheme: https\n")))}d.isMDXComponent=!0},46460:(e,t,r)=>{r.d(t,{Z:()=>n});const n=r.p+"assets/images/photo-kt443t6d_64hdh43hfh6dgjdfhg4_d-4118b3ab0d3d411170645e7e387ce566.jpg"}}]);