"use strict";(self.webpackChunkmikes_dev_notebook=self.webpackChunkmikes_dev_notebook||[]).push([[20593],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>m});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=a.createContext({}),u=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},c=function(e){var t=u(e.components);return a.createElement(l.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),d=u(n),m=r,h=d["".concat(l,".").concat(m)]||d[m]||p[m]||i;return n?a.createElement(h,o(o({ref:t},c),{},{components:n})):a.createElement(h,o({ref:t},c))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,o=new Array(i);o[0]=d;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:r,o[1]=s;for(var u=2;u<i;u++)o[u]=n[u];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},5025:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>o,default:()=>p,frontMatter:()=>i,metadata:()=>s,toc:()=>u});var a=n(87462),r=(n(67294),n(3905));const i={sidebar_position:9e3,slug:"2019-06-15",title:"Installing Discourse on Centos 8",authors:"mpolinowski",tags:["LINUX","Docker","Discourse"]},o=void 0,s={unversionedId:"DevOps/Provisioning/2019-06-15--installing-discourse-on-centos8/index",id:"DevOps/Provisioning/2019-06-15--installing-discourse-on-centos8/index",title:"Installing Discourse on Centos 8",description:"Mongkok, Hongkong",source:"@site/docs/DevOps/Provisioning/2019-06-15--installing-discourse-on-centos8/index.mdx",sourceDirName:"DevOps/Provisioning/2019-06-15--installing-discourse-on-centos8",slug:"/DevOps/Provisioning/2019-06-15--installing-discourse-on-centos8/2019-06-15",permalink:"/docs/DevOps/Provisioning/2019-06-15--installing-discourse-on-centos8/2019-06-15",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/DevOps/Provisioning/2019-06-15--installing-discourse-on-centos8/index.mdx",tags:[{label:"LINUX",permalink:"/docs/tags/linux"},{label:"Docker",permalink:"/docs/tags/docker"},{label:"Discourse",permalink:"/docs/tags/discourse"}],version:"current",sidebarPosition:9e3,frontMatter:{sidebar_position:9e3,slug:"2019-06-15",title:"Installing Discourse on Centos 8",authors:"mpolinowski",tags:["LINUX","Docker","Discourse"]},sidebar:"tutorialSidebar",previous:{title:"Migrating from vBulletin 5 to Discourse on CentOS 8",permalink:"/docs/DevOps/Provisioning/2019-06-16--migrating-from-vbulletin-to-discourse-on-centos8/2019-06-16"},next:{title:"Sensors Data and Grafana",permalink:"/docs/DevOps/Provisioning/2019-01-08--creating-a-grafana-dashboard/2019-01-08"}},l={},u=[{value:"Configure FirewallD",id:"configure-firewalld",level:2},{value:"Download Discourse from Github",id:"download-discourse-from-github",level:2},{value:"Configure Discourse",id:"configure-discourse",level:2},{value:"Set Mail Credentials",id:"set-mail-credentials",level:3},{value:"Set Domain",id:"set-domain",level:3},{value:"Optional: Tune Memory Settings",id:"optional-tune-memory-settings",level:3},{value:"Bootstrap Discourse",id:"bootstrap-discourse",level:2},{value:"Access Discourse",id:"access-discourse",level:2},{value:"Sign Up and Create Admin Account",id:"sign-up-and-create-admin-account",level:2},{value:"Upgrade",id:"upgrade",level:2},{value:"Install Plugins",id:"install-plugins",level:2},{value:"Missing Certificate",id:"missing-certificate",level:2},{value:"Forced Manual Renew",id:"forced-manual-renew",level:3}],c={toc:u};function p(e){let{components:t,...i}=e;return(0,r.kt)("wrapper",(0,a.Z)({},c,i,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Mongkok, Hongkong",src:n(87666).Z,width:"1500",height:"671"})),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#configure-firewalld"},"Configure FirewallD")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#download-discourse-from-github"},"Download Discourse from Github")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#configure-discourse"},"Configure Discourse"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#set-mail-credentials"},"Set Mail Credentials")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#set-domain"},"Set Domain")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#optional-tune-memory-settings"},"Optional: Tune Memory Settings")))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#bootstrap-discourse"},"Bootstrap Discourse")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#access-discourse"},"Access Discourse")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#sign-up-and-create-admin-account"},"Sign Up and Create Admin Account")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#upgrade"},"Upgrade")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#install-plugins"},"Install Plugins")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#missing-certificate"},"Missing Certificate"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#forced-manual-renew"},"Forced Manual Renew"))))),(0,r.kt)("h2",{id:"configure-firewalld"},"Configure FirewallD"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"firewall-cmd --zone=public --permanent --add-service=http\nfirewall-cmd --zone=public --permanent --add-service=https\nfirewall-cmd --zone=public --permanent --add-service=pop3s\nfirewall-cmd --zone=public --permanent --add-service=smtp\nfirewall-cmd --reload\nfirewall-cmd --zone=public --list-services\n")),(0,r.kt)("p",null,"Not sure if those are necessary (needs testing):\nfirewall-cmd --permanent --zone=trusted --add-interface=docker0\nfirewall-cmd --permanent --zone=trusted --add-port=25/tcp"),(0,r.kt)("h2",{id:"download-discourse-from-github"},"Download Discourse from Github"),(0,r.kt)("p",null,"Create a ",(0,r.kt)("inlineCode",{parentName:"p"},"/opt/discourse")," folder, where all the Discourse-related files will reside:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"sudo mkdir /opt/discourse\n")),(0,r.kt)("p",null,"Clone the ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/discourse/discourse_docker"},"official Discourse Docker Image")," into this /opt/discourse folder:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"sudo git clone https://github.com/discourse/discourse_docker.git /opt/discourse\n")),(0,r.kt)("h2",{id:"configure-discourse"},"Configure Discourse"),(0,r.kt)("p",null,"In this section we will configure your initial Discourse settings."),(0,r.kt)("p",null,"Switch to the ",(0,r.kt)("inlineCode",{parentName:"p"},"/opt/discourse")," directory:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"cd /opt/discourse\n")),(0,r.kt)("p",null,"Copy the ",(0,r.kt)("inlineCode",{parentName:"p"},"samples/standalone.yml")," file into the containers folder as ",(0,r.kt)("inlineCode",{parentName:"p"},"app.yml"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"sudo cp samples/standalone.yml containers/app.yml\n")),(0,r.kt)("p",null,"Edit the Discourse configuration in the ",(0,r.kt)("inlineCode",{parentName:"p"},"app.yml")," file:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"sudo nano containers/app.yml\n")),(0,r.kt)("h3",{id:"set-mail-credentials"},"Set Mail Credentials"),(0,r.kt)("p",null,"Enter your SMTP credentials in the lines for ",(0,r.kt)("inlineCode",{parentName:"p"},"DISCOURSE_SMTP_ADDRESS"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"DISCOURSE_SMTP_PORT"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"DISCOURSE_SMTP_USER_NAME"),", and ",(0,r.kt)("inlineCode",{parentName:"p"},"DISCOURSE_SMTP_PASSWORD"),". (Be sure you remove the comment # character from the beginnings of these lines as necessary.)"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"env:\n  LANG: en_US.UTF-8\n  ## TODO: How many concurrent web requests are supported?\n  ## With 2GB we recommend 3-4 workers, with 1GB only 2\n  #UNICORN_WORKERS: 3\n  ##\n  ## TODO: List of comma delimited emails that will be made admin and developer\n  ## on initial signup example 'user1@example.com,user2@example.com'\n  DISCOURSE_DEVELOPER_EMAILS: 'myaddress@example.com'\n  ##\n  ## TODO: The mailserver this Discourse instance will use\n  DISCOURSE_SMTP_ADDRESS: smtp.mail.com              # (mandatory)\n  DISCOURSE_SMTP_PORT: 587                           # (optional)\n  DISCOURSE_SMTP_USER_NAME: myaddress@example.com    # (optional)\n  DISCOURSE_SMTP_PASSWORD: mypassword                # (optional)\n")),(0,r.kt)("p",null,"The SMTP settings are required to send mail from your Discourse instance; for example, to send registration emails, password reset emails, reply notifications, etc."),(0,r.kt)("p",null,"Having trouble setting up mail credentials? See the ",(0,r.kt)("a",{parentName:"p",href:"https://meta.discourse.org/t/troubleshooting-email-on-a-new-discourse-install/16326"},"Discourse Email Troubleshooting guide"),"."),(0,r.kt)("p",null,"Setting up mail credentials is required, or else you will not be able to bootstrap your Discourse instance. The credentials must be correct, or else you will not be able to register users (including the admin user) for the forum."),(0,r.kt)("h3",{id:"set-domain"},"Set Domain"),(0,r.kt)("p",null,"Set ",(0,r.kt)("inlineCode",{parentName:"p"},"DISCOURSE_HOSTNAME")," to discourse.example.com. This means you want your Discourse forum to be available at ",(0,r.kt)("a",{parentName:"p",href:"http://discourse.example.com/"},"http://discourse.example.com/"),". You can use an IP address here instead if you don\u2019t have a domain pointing to your server yet. Only one domain (or IP) can be listed here."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"DISCOURSE_HOSTNAME: 'discourse.example.com'\n")),(0,r.kt)("h3",{id:"optional-tune-memory-settings"},"Optional: Tune Memory Settings"),(0,r.kt)("p",null,"Also in the env section of the configuration file, set ",(0,r.kt)("inlineCode",{parentName:"p"},"db_shared_buffers")," to 128MB and ",(0,r.kt)("inlineCode",{parentName:"p"},"UNICORN_WORKERS")," to 2 so you have more memory room."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"db_shared_buffers: '128MB'\nUNICORN_WORKERS: 2\n")),(0,r.kt)("p",null,"Save the ",(0,r.kt)("inlineCode",{parentName:"p"},"app.yml")," file, and exit the text editor."),(0,r.kt)("h2",{id:"bootstrap-discourse"},"Bootstrap Discourse"),(0,r.kt)("p",null,"Now use the bootstrap process to build Discourse and initialize it with all the settings you configured in the previous section. This also starts the Docker container."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"sudo /opt/discourse/launcher bootstrap app\n")),(0,r.kt)("p",null,"At this point I got an error message ",(0,r.kt)("inlineCode",{parentName:"p"},"/usr/bin/env: \u2018bash\\r\u2019: No such file or directory")," which suggests that the file ",(0,r.kt)("inlineCode",{parentName:"p"},"launcher")," has Windows-style ",(0,r.kt)("strong",{parentName:"p"},"\\r\\n")," line endings instead of the ",(0,r.kt)("strong",{parentName:"p"},"\\n-only")," line endings bash expects. To remove the \\r chars run the following command:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"sed $'s/\\r$//' /opt/discourse/launcher > /opt/discourse/launcher-unix\nchmod u+x /opt/discourse/launcher-unix\n")),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"chmod")," command makes the script executable. Then rerun the command above ",(0,r.kt)("inlineCode",{parentName:"p"},"sudo /opt/discourse/launcher-unix bootstrap app"),"."),(0,r.kt)("p",null,"At this point I ran into the problem that Docker was unable to download the discourse base image. And I had to ",(0,r.kt)("a",{parentName:"p",href:"/docs/DevOps/Linux/2019-06-14--download-and-save-docker-image/2019-06-14"},"download and save it on a different machine"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"docker pull discourse/base:2.0.20191013-2320\ndocker save -o discourse.docker discourse/base:2.0.20191013-2320\n")),(0,r.kt)("p",null,"The image file can then be transfered to the CentOS 8 machine and be loaded with the following command ",(0,r.kt)("inlineCode",{parentName:"p"},"sudo docker load -i discourse.docker")),(0,r.kt)("p",null,"This command will take about 8 minutes to run while it configures your Discourse environment. (Early in this process you will be asked to generate a SSH key; press Y to accept.)"),(0,r.kt)("p",null,"After the bootstrap process completes, start Discourse:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"sudo /opt/discourse/launcher start app\n")),(0,r.kt)("h2",{id:"access-discourse"},"Access Discourse"),(0,r.kt)("p",null,"Visit the domain or IP address (that you set for the Discourse hostname previously) in your web browser to view the default Discourse web page."),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Discourse on CentOS 8",src:n(28772).Z,width:"772",height:"621"})),(0,r.kt)("p",null,"If you receive a 502 Bad Gateway error, try waiting a minute or two and then refreshing so Discourse can finish starting."),(0,r.kt)("h2",{id:"sign-up-and-create-admin-account"},"Sign Up and Create Admin Account"),(0,r.kt)("p",null,"Use the Sign Up button at the top right of the page to register a new Discourse account. You should use the email address you provided in the ",(0,r.kt)("inlineCode",{parentName:"p"},"DISCOURSE_DEVELOPER_EMAILS")," setting previously. Once you confirm your account, that account will automatically be granted admin privileges."),(0,r.kt)("p",null,"Once you sign up and log in, you should see the Staff topics and the ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/discourse/discourse/blob/master/docs/ADMIN-QUICK-START-GUIDE.md"},"Admin Quick Start Guide"),". It contains the next steps for further configuring and customizing your Discourse installation."),(0,r.kt)("p",null,"You can access the admin dashboard by visting ",(0,r.kt)("inlineCode",{parentName:"p"},"/admin"),"."),(0,r.kt)("p",null,"If you don\u2019t get any email from signing up, and are unable to register a new admin account, please see the ",(0,r.kt)("a",{parentName:"p",href:"https://meta.discourse.org/t/troubleshooting-email-on-a-new-discourse-install/16326"},"Discourse email troubleshooting checklist"),"."),(0,r.kt)("p",null,"If you are still unable to register a new admin account via email, see the ",(0,r.kt)("a",{parentName:"p",href:"https://meta.discourse.org/t/create-admin-account-from-console/17274"},"Create Admin Account from Console")," walkthrough, but please note that you will have a broken site until you get normal SMTP email working."),(0,r.kt)("h2",{id:"upgrade"},"Upgrade"),(0,r.kt)("p",null,"To upgrade Discourse to the latest version, visit ",(0,r.kt)("inlineCode",{parentName:"p"},"/admin/upgrade")," and follow the instructions."),(0,r.kt)("h2",{id:"install-plugins"},"Install Plugins"),(0,r.kt)("p",null,"In this tutorial, we\u2019ll install ",(0,r.kt)("a",{parentName:"p",href:"https://meta.discourse.org/t/discourse-spoiler-alert/12650"},"Discourse Spoiler Alert")," and ",(0,r.kt)("a",{parentName:"p",href:"https://meta.discourse.org/t/discourse-sitemap-plugin/40348"},"Discourse Sitemap")," plugin."),(0,r.kt)("p",null,"To install a ",(0,r.kt)("a",{parentName:"p",href:"https://meta.discourse.org/tags/plugins"},"plugin in Discourse"),", it needs to be placed in ",(0,r.kt)("inlineCode",{parentName:"p"},"/var/www/discourse/plugins"),". However, this is inside the container - and changes to the container are wiped when it is rebuilt! So, the container definition is what needs to be edited."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"On your Centos system enter the Discourse directory: ",(0,r.kt)("inlineCode",{parentName:"li"},"cd /opt/discourse"),"."),(0,r.kt)("li",{parentName:"ol"},"Edit the app configuration file: ",(0,r.kt)("inlineCode",{parentName:"li"},"nano containers/app.yml"),"."),(0,r.kt)("li",{parentName:"ol"},"Access the Github page (",(0,r.kt)("a",{parentName:"li",href:"https://github.com/discourse/discourse-sitemap"},"discourse-sitemap"),", ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/discourse/discourse-spoiler-alert"},"discourse-spoiler-alert"),") of each plugin you want to install, click on the green ",(0,r.kt)("strong",{parentName:"li"},"Clone or download")," button and copy the web URL."),(0,r.kt)("li",{parentName:"ol"},"Now paste the URLs into the plugin section of the ",(0,r.kt)("inlineCode",{parentName:"li"},"app.yml")," file:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"## Plugins go here\n## see https://meta.discourse.org/t/19157 for details\nhooks:\n  after_code:\n    - exec:\n        cd: $home/plugins\n        cmd:\n          - git clone https://github.com/discourse/docker_manager.git\n          - git clone https://github.com/discourse/discourse-spoiler-alert.git\n          - git clone https://github.com/discourse/discourse-sitemap.git\n")),(0,r.kt)("ol",{start:5},(0,r.kt)("li",{parentName:"ol"},"And rebuild the container: ",(0,r.kt)("inlineCode",{parentName:"li"},"./launcher rebuild app"))),(0,r.kt)("p",null,"What to do when you receive this error message:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"[root@localhost discourse]# ./launcher rebuild app\nEnsuring launcher is up to date\nFetching origin\nremote: Enumerating objects: 3, done.\nremote: Counting objects: 100% (3/3), done.\nremote: Compressing objects: 100% (3/3), done.\nremote: Total 3 (delta 0), reused 2 (delta 0), pack-reused 0\nUnpacking objects: 100% (3/3), done.\nFrom https://github.com/discourse/discourse_docker\n   b637998..20e812e  master     -> origin/master\nUpdating Launcher\nUpdating b637998..20e812e\nerror: Your local changes to the following files would be overwritten by merge:\n        discourse-setup\nPlease commit your changes or stash them before you merge.\nAborting\nfailed to update\n")),(0,r.kt)("p",null,"Stash your changes and rerun the rebuild command:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"cd /opt/discourse\ngit stash\ngit pull\n./launcher rebuild app\n")),(0,r.kt)("p",null,"Once the rebuild process is done open Discourse again inside your browser and head to ",(0,r.kt)("inlineCode",{parentName:"p"},"/admin/plugins")," to activate your new plugins:"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Discourse on CentOS 8",src:n(41142).Z,width:"856",height:"353"})),(0,r.kt)("p",null,"All Plugins are update through ",(0,r.kt)("inlineCode",{parentName:"p"},"/admin/upgrade"),":"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Discourse on CentOS 8",src:n(36416).Z,width:"855",height:"528"})),(0,r.kt)("p",null,"The sitemap plugin publishes two files:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("inlineCode",{parentName:"li"},"/sitemap.xml")," : the regular Google Sitemap format"),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("inlineCode",{parentName:"li"},"/news.xml")," : special sitemap for Google News containing all new topics in the last three days")),(0,r.kt)("p",null,"To test the spoiler plugin start a new thread and post:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"[spoiler]This is a spoiler[/spoiler] \n")),(0,r.kt)("h2",{id:"missing-certificate"},"Missing Certificate"),(0,r.kt)("p",null,"Error message with ",(0,r.kt)("inlineCode",{parentName:"p"},"/opt/discourse/launcher logs app"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"[emerg] cannot load certificate '/shared/ssl/forum.instar.com.cer': PEM_read_bio_X509_AUX() failed (SSL: error:0909006C:PEM routines:get_name:no start line:Expecting: TRUSTED CERTIFICATE)\n")),(0,r.kt)("p",null,"Remove old certificate and rebuild:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"rm -rf /opt/discourse/shared/standalone/ssl\nrm -rf /opt/discourse/shared/standalone/letsencrypt\n./launcher rebuild app\n")),(0,r.kt)("h3",{id:"forced-manual-renew"},"Forced Manual Renew"),(0,r.kt)("p",null,"If this does not solve the issue try a manual renewal:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"cd /opt/discourse\n./launcher enter app\n/shared/letsencrypt/acme.sh  --issue -d forum.instar.com --force --debug\n/shared/letsencrypt/acme.sh  --renew -d forum.instar.com --force --debug\n")),(0,r.kt)("p",null,"This will show you the issue - e.g. rate limit:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"Create new order error. Le_OrderFinalize not found. {\n  'type': 'urn:ietf:params:acme:error:rateLimited',\n  'detail': 'Error creating new order :: too many certificates already issued for exact set of domains: forum.instar.com: see https://letsencrypt.org/docs/rate-limits/',\n  'status': 429\n}\n")),(0,r.kt)("p",null,"Retry the renewal after a while or assign a different domain to your forum:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"/opt/discourse/launcher enter app\nservice nginx stop\n/usr/sbin/nginx -c /etc/nginx/letsencrypt.conf\nLE_WORKING_DIR=/shared/letsencrypt DEBUG=1 /shared/letsencrypt/acme.sh --issue -d example.com -k 4096 -w /var/www/discourse/public\nLE_WORKING_DIR=/shared/letsencrypt /shared/letsencrypt/acme.sh --installcert -d example.com --fullchainpath /shared/ssl/forum.instar.com.cer --keypath /shared/ssl/forum.instar.com.key --reloadcmd 'sv reload nginx'\n/usr/sbin/nginx -c /etc/nginx/letsencrypt.conf -s stop\nexit\n")))}p.isMDXComponent=!0},28772:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/Discourse_01-27ea3f8d4cf81fea623f87b5cd29e11f.png"},41142:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/Discourse_02-61e4bc9aaed4239f475b616b71496e3f.png"},36416:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/Discourse_03-80831d4ae25a19ae59ddb4b16a18c46f.png"},87666:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/photo-456t66d_64567fh6dgjkhg4_d-b91054562a25526578ecd9d08b9913f6.jpg"}}]);