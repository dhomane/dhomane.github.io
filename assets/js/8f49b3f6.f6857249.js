"use strict";(self.webpackChunkmikes_dev_notebook=self.webpackChunkmikes_dev_notebook||[]).push([[48533],{3905:(e,t,a)=>{a.d(t,{Zo:()=>p,kt:()=>m});var n=a(67294);function o(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){o(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,n,o=function(e,t){if(null==e)return{};var a,n,o={},r=Object.keys(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||(o[a]=e[a]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(o[a]=e[a])}return o}var s=n.createContext({}),d=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},p=function(e){var t=d(e.components);return n.createElement(s.Provider,{value:t},e.children)},h={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},c=n.forwardRef((function(e,t){var a=e.components,o=e.mdxType,r=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),c=d(a),m=o,u=c["".concat(s,".").concat(m)]||c[m]||h[m]||r;return a?n.createElement(u,i(i({ref:t},p),{},{components:a})):n.createElement(u,i({ref:t},p))}));function m(e,t){var a=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=a.length,i=new Array(r);i[0]=c;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:o,i[1]=l;for(var d=2;d<r;d++)i[d]=a[d];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}c.displayName="MDXCreateElement"},88126:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>h,frontMatter:()=>r,metadata:()=>l,toc:()=>d});var n=a(87462),o=(a(67294),a(3905));const r={sidebar_position:9060,slug:"2018-11-13",title:"Node-RED with IFTTT",authors:"mpolinowski",tags:["Node-RED","IoT"]},i=void 0,l={unversionedId:"IoT-and-Machine-Learning/Home_Automation/2018-11-13--nodered-ifttt/index",id:"IoT-and-Machine-Learning/Home_Automation/2018-11-13--nodered-ifttt/index",title:"Node-RED with IFTTT",description:"Shenzhen, China",source:"@site/docs/IoT-and-Machine-Learning/Home_Automation/2018-11-13--nodered-ifttt/index.mdx",sourceDirName:"IoT-and-Machine-Learning/Home_Automation/2018-11-13--nodered-ifttt",slug:"/IoT-and-Machine-Learning/Home_Automation/2018-11-13--nodered-ifttt/2018-11-13",permalink:"/docs/IoT-and-Machine-Learning/Home_Automation/2018-11-13--nodered-ifttt/2018-11-13",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/IoT-and-Machine-Learning/Home_Automation/2018-11-13--nodered-ifttt/index.mdx",tags:[{label:"Node-RED",permalink:"/docs/tags/node-red"},{label:"IoT",permalink:"/docs/tags/io-t"}],version:"current",sidebarPosition:9060,frontMatter:{sidebar_position:9060,slug:"2018-11-13",title:"Node-RED with IFTTT",authors:"mpolinowski",tags:["Node-RED","IoT"]},sidebar:"tutorialSidebar",previous:{title:"A Collection of Node-RED MQTT Recipes",permalink:"/docs/IoT-and-Machine-Learning/Home_Automation/2018-11-17--nodered-mqtt-connect/2018-11-17"},next:{title:"Using SQLite with Node-RED on Windows",permalink:"/docs/IoT-and-Machine-Learning/Home_Automation/2018-11-12--nodered-sqlite/2018-11-12"}},s={},d=[{value:"Basic Setup",id:"basic-setup",level:2},{value:"Node-RED Introduction",id:"node-red-introduction",level:3},{value:"IFTTT Setting up a Webhook",id:"ifttt-setting-up-a-webhook",level:2},{value:"Node-RED Contacting the external Webhook",id:"node-red-contacting-the-external-webhook",level:3},{value:"IFTTT Contacting a Node-RED Endpoint",id:"ifttt-contacting-a-node-red-endpoint",level:3},{value:"Real-world example",id:"real-world-example",level:2},{value:"Deactivate the Alarm when I am Home",id:"deactivate-the-alarm-when-i-am-home",level:3}],p={toc:d};function h(e){let{components:t,...r}=e;return(0,o.kt)("wrapper",(0,n.Z)({},p,r,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"Shenzhen, China",src:a(50528).Z,width:"1500",height:"641"})),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#basic-setup"},"Basic Setup"),(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#node-red-introduction"},"Node-RED Introduction")))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#ifttt-setting-up-a-webhook"},"IFTTT Setting up a Webhook"),(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#node-red-contacting-the-external-webhook"},"Node-RED Contacting the external Webhook")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#ifttt-contacting-a-node-red-endpoint"},"IFTTT Contacting a Node-RED Endpoint")))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#real-world-example"},"Real-world example"),(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#deactivate-the-alarm-when-i-am-home"},"Deactivate the Alarm when I am Home"))))),(0,o.kt)("h2",{id:"basic-setup"},"Basic Setup"),(0,o.kt)("p",null,(0,o.kt)("em",{parentName:"p"},"If This Then That"),", also known as ",(0,o.kt)("a",{parentName:"p",href:"https://ifttt.com/"},"IFTTT")," is a free web-based service to create chains of simple conditional statements, called applets. Build your own applets to connect web services with your INSTAR IP Camera."),(0,o.kt)("h3",{id:"node-red-introduction"},"Node-RED Introduction"),(0,o.kt)("p",null,"Use your Node-RED Installation under Windows, Linux (e.g. on a Raspberry Pi) to serve as an interface between your camera and the ",(0,o.kt)("a",{parentName:"p",href:"https://ifttt.com/discover"},"IFTTT services"),". Node-RED will serve both to send messages to the IFTTT Webhook API when an event occurs on your local network, as well as provides an HTTP Endpoint for your IFTTT Applets to trigger events on your local network."),(0,o.kt)("p",null,"An example would be a camera triggers an alarm, contacts Node-RED that forwards a message to IFTTT, that in turns sends a message to your smartphone. Or the other way around - your phones GPS detects that you are arriving home, the IFTTT smartphone app contacts the IFTTT server that your local Node-RED installation should be informed to deactivate the motion detection on your INSTAR IP cameras."),(0,o.kt)("h2",{id:"ifttt-setting-up-a-webhook"},"IFTTT Setting up a Webhook"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"First you need to ",(0,o.kt)("a",{parentName:"li",href:"https://ifttt.com/join"},"create an account")," on IFTTT and ",(0,o.kt)("a",{parentName:"li",href:"https://ifttt.com/login?wp_=1"},"login to your account"),". Then go to the ",(0,o.kt)("strong",{parentName:"li"},"My Applets")," tab and click on ",(0,o.kt)("strong",{parentName:"li"},"New Applet"),":")),(0,o.kt)("hr",null),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"IFTTT",src:a(28645).Z,width:"730",height:"370"})),(0,o.kt)("hr",null),(0,o.kt)("ol",{start:2},(0,o.kt)("li",{parentName:"ol"},"Click on ",(0,o.kt)("strong",{parentName:"li"},"this")," to create the conditional part of the script - we want to select what needs to happen for this script to be executed:")),(0,o.kt)("hr",null),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"IFTTT",src:a(4506).Z,width:"730",height:"302"})),(0,o.kt)("hr",null),(0,o.kt)("ol",{start:3},(0,o.kt)("li",{parentName:"ol"},"As mentioned above, we want to use the ",(0,o.kt)("a",{parentName:"li",href:"https://ifttt.com/services/maker_webhooks"},"webhook service")," - which is basically just a web address that your Node-RED installation needs to contact to trigger the IFTTT applet. Search for ",(0,o.kt)("em",{parentName:"li"},"web")," and select the ",(0,o.kt)("strong",{parentName:"li"},"Webhooks Service"),":")),(0,o.kt)("hr",null),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"IFTTT",src:a(59768).Z,width:"730",height:"430"})),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"IFTTT",src:a(20785).Z,width:"730",height:"480"})),(0,o.kt)("hr",null),(0,o.kt)("ol",{start:4},(0,o.kt)("li",{parentName:"ol"},"Then name the event - this will be part of the URL that we will later have to contact with Node-RED to trigger the event:")),(0,o.kt)("hr",null),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"IFTTT",src:a(35120).Z,width:"730",height:"619"})),(0,o.kt)("hr",null),(0,o.kt)("ol",{start:5},(0,o.kt)("li",{parentName:"ol"},"With the trigger set up we now need to assign an IFTTT service we want to trigger. To do this click on ",(0,o.kt)("strong",{parentName:"li"},"that"),":")),(0,o.kt)("hr",null),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"IFTTT",src:a(36690).Z,width:"730",height:"258"})),(0,o.kt)("hr",null),(0,o.kt)("ol",{start:6},(0,o.kt)("li",{parentName:"ol"},"Let's use the ",(0,o.kt)("strong",{parentName:"li"},"Email service")," - when the URL (webhook) for this applet is contacted we want to receive an Email to the address that we used to register with IFTTT:")),(0,o.kt)("hr",null),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"IFTTT",src:a(73673).Z,width:"730",height:"414"})),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"IFTTT",src:a(22644).Z,width:"730",height:"435"})),(0,o.kt)("hr",null),(0,o.kt)("ol",{start:7},(0,o.kt)("li",{parentName:"ol"},"Now we can configure the subject and body text the email should have. Notice the words that are highlighted in white - these are variables that will be filled with data before the mail is sent. ",(0,o.kt)("strong",{parentName:"li"},"EventName")," will be the name that you choose in step 4 above, ",(0,o.kt)("strong",{parentName:"li"},"OccuredAt")," will be filled with a time stamp. The ",(0,o.kt)("strong",{parentName:"li"},"Value 1-3")," below are variables that we can define in Node-RED and send them whenever the event is triggered in our flow - the naming, as well as the amount of variables that you want to add is up to you:")),(0,o.kt)("hr",null),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"IFTTT",src:a(56511).Z,width:"730",height:"831"})),(0,o.kt)("hr",null),(0,o.kt)("ol",{start:8},(0,o.kt)("li",{parentName:"ol"},"Confirm your setup and save your applet:")),(0,o.kt)("hr",null),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"IFTTT",src:a(44822).Z,width:"730",height:"838"})),(0,o.kt)("hr",null),(0,o.kt)("h3",{id:"node-red-contacting-the-external-webhook"},"Node-RED Contacting the external Webhook"),(0,o.kt)("p",null,"Now we need to set up Node-RED to contact the webhook that we just configured whenever a local event is fired (we will be using a manual inject node to trigger it for now). The flow that we are going to build will consist of the following nodes:"),(0,o.kt)("hr",null),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"IFTTT",src:a(35619).Z,width:"730",height:"240"})),(0,o.kt)("hr",null),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"First, copy and import the following code into the Node-RED Admin Panel:")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},"[{'id':'87f67c26.0ff7b','type':'inject','z':'b8ce5e67.23af6','name':'','topic':'','payload':'','payloadType':'str','repeat':'','crontab':'','once':false,'onceDelay':'','x':90,'y':40,'wires':[['3b378299.bdbede']]},{'id':'e8acbbcd.763f78','type':'http request','z':'b8ce5e67.23af6','name':'Web Req','method':'POST','ret':'txt','url':'https://maker.ifttt.com/trigger/{{event}}/with/key/API_KEY','tls':'','x':374,'y':40,'wires':[['9fe779e1.db2bb8']]},{'id':'9fe779e1.db2bb8','type':'debug','z':'b8ce5e67.23af6','name':'','active':true,'tosidebar':true,'console':false,'complete':'false','x':521,'y':40,'wires':[]},{'id':'3b378299.bdbede','type':'function','z':'b8ce5e67.23af6','name':'Req Params','func':'msg.event = \\'test_request\\';\\nmsg.payload = {\\'value1\\': \\'testvalue1\\', \\'value2\\': \\'testvalue2\\', \\'value3\\': \\'testvalue3\\'};\\nreturn msg;','outputs':1,'noerr':0,'x':226,'y':40,'wires':[['e8acbbcd.763f78']]}]\n")),(0,o.kt)("ol",{start:2},(0,o.kt)("li",{parentName:"ol"},"The Inject Node is set up to insert an empty string when clicked manually. It follows a ",(0,o.kt)("strong",{parentName:"li"},"Function Node")," that has to set the ",(0,o.kt)("strong",{parentName:"li"},"Event Name")," - needed to set the right URL for our IFTTT Webhook and a message payload that carries our three variables ",(0,o.kt)("strong",{parentName:"li"},"Value 1-3")," that we want to display in the IFTTT Email notification:")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"msg.event = 'test_request';\nmsg.payload = {'value1': 'testvalue1', 'value2': 'testvalue2', 'value3': 'testvalue3'};\nreturn msg;\n\n")),(0,o.kt)("hr",null),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"IFTTT",src:a(21487).Z,width:"730",height:"311"})),(0,o.kt)("hr",null),(0,o.kt)("ol",{start:3},(0,o.kt)("li",{parentName:"ol"},"Next we have a ",(0,o.kt)("strong",{parentName:"li"},"HTTP Request Node")," that sets the URL for our IFTTT Webhook as a ",(0,o.kt)("strong",{parentName:"li"},"POST")," message:")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"https://maker.ifttt.com/trigger/{{event}}/with/key/API_KEY\n")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Note")," that this is using the ",(0,o.kt)("strong",{parentName:"p"},"Event Name")," that we set as ",(0,o.kt)("inlineCode",{parentName:"p"},"msg.event")," in the previous ",(0,o.kt)("strong",{parentName:"p"},"Function Node"),". But to identify our IFTTT account we first need to find out our personal ",(0,o.kt)("strong",{parentName:"p"},"API_KEY")," and add it at the end of the URL:"),(0,o.kt)("hr",null),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"IFTTT",src:a(36526).Z,width:"730",height:"381"})),(0,o.kt)("hr",null),(0,o.kt)("ol",{start:4},(0,o.kt)("li",{parentName:"ol"},"To get access to our personal API key we first have to sign in to our IFTTT account and open the following page ",(0,o.kt)("inlineCode",{parentName:"li"},"https://ifttt.com/services/maker_webhooks/settings"),". Copy the alpha-numeric key in the Account Info - e.g. if you find the ",(0,o.kt)("inlineCode",{parentName:"li"},"URL: https://maker.ifttt.com/use/c3oL9WnAbz8Z08KumJWS"),", then ",(0,o.kt)("inlineCode",{parentName:"li"},"c3oL9WnAbz8Z08KumJWS")," is your API key:")),(0,o.kt)("hr",null),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"IFTTT",src:a(79889).Z,width:"730",height:"561"})),(0,o.kt)("hr",null),(0,o.kt)("ol",{start:5},(0,o.kt)("li",{parentName:"ol"},"Copy your API key and replace the ",(0,o.kt)("inlineCode",{parentName:"li"},"API_KEY")," part in the URL for the ",(0,o.kt)("strong",{parentName:"li"},"HTTP Request Node")," in Node-RED. Then confirm the edit by hitting ",(0,o.kt)("strong",{parentName:"li"},"Done")," and the ",(0,o.kt)("strong",{parentName:"li"},"Deploy")," your flow:")),(0,o.kt)("hr",null),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"IFTTT",src:a(85568).Z,width:"730",height:"450"})),(0,o.kt)("hr",null),(0,o.kt)("ol",{start:6},(0,o.kt)("li",{parentName:"ol"},"Hit the ",(0,o.kt)("strong",{parentName:"li"},"Inject Node")," to trigger an event. The ",(0,o.kt)("strong",{parentName:"li"},"HTTP Request Node")," will contact your IFTTT webhook and you will see a ",(0,o.kt)("em",{parentName:"li"},"success message")," outputted into the debug panel from the ",(0,o.kt)("strong",{parentName:"li"},"Debug Node")," connected to the request node - ",(0,o.kt)("inlineCode",{parentName:"li"},"Congratulation! You fired the test_request event")," - telling you that the IFTTT server was contacted and your Applet was executed:")),(0,o.kt)("hr",null),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"IFTTT",src:a(93240).Z,width:"730",height:"243"})),(0,o.kt)("hr",null),(0,o.kt)("ol",{start:7},(0,o.kt)("li",{parentName:"ol"},"Check your Email (the one you used to register your IFTTT account) - you will have received a message from IFTTT that follows the structure we set up in the Applet configuration:")),(0,o.kt)("hr",null),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"IFTTT",src:a(45610).Z,width:"730",height:"284"})),(0,o.kt)("hr",null),(0,o.kt)("h3",{id:"ifttt-contacting-a-node-red-endpoint"},"IFTTT Contacting a Node-RED Endpoint"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"We now want to set up a Node-RED sequence that contacts an IFTTT Webhook - just as in the step before - but instead of sending an Email, we want IFTTT to contact our own Webhook in Node-RED and trigger an event there that we can consume in a Flow. ",(0,o.kt)("strong",{parentName:"li"},"Note")," that this is just a proof of concept - later we want to use one of the many IFTTT services to replace the manual trigger, enabling us to connect the Node-RED webhook to services like ",(0,o.kt)("em",{parentName:"li"},"Amazon Alexa"),", ",(0,o.kt)("em",{parentName:"li"},"Google Home"),", ",(0,o.kt)("em",{parentName:"li"},"Nest Home Automation"),", etc.")),(0,o.kt)("p",null,"To set up the manual trigger, we could simply recycle the node sequence we build previously. But to explore a different approach, we are going to install a third-party node called ",(0,o.kt)("a",{parentName:"p",href:"https://www.npmjs.com/package/node-red-contrib-ifttt"},"node-red-contrib-ifttt")," - that basically just combines the ",(0,o.kt)("strong",{parentName:"p"},"Function Node")," and ",(0,o.kt)("strong",{parentName:"p"},"HTTP Request Node")," that we used earlier (",(0,o.kt)("strong",{parentName:"p"},"Note")," with this setup, we cannot send custom variables with the message payload - we still would have to add another function node to realize the same sequence we created earlier.):"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},"[{'id':'2efd9020.529d9','type':'inject','z':'b8ce5e67.23af6','name':'','topic':'','payload':'','payloadType':'str','repeat':'','crontab':'','once':false,'onceDelay':'','x':92,'y':139,'wires':[['7abb924d.fcfabc']]},{'id':'7abb924d.fcfabc','type':'ifttt out','z':'b8ce5e67.23af6','eventName':'ifttt_webhook','key':'d6390bcb.c9fc08','x':236,'y':139,'wires':[]},{'id':'d6390bcb.c9fc08','type':'ifttt-key','z':''}]\n")),(0,o.kt)("hr",null),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"IFTTT",src:a(5598).Z,width:"730",height:"169"})),(0,o.kt)("hr",null),(0,o.kt)("ol",{start:2},(0,o.kt)("li",{parentName:"ol"},"Double-Click the ",(0,o.kt)("strong",{parentName:"li"},"IFTT Node")," to add an ",(0,o.kt)("strong",{parentName:"li"},"Event Name")," - we choose ",(0,o.kt)("inlineCode",{parentName:"li"},"ifttt_webhook")," -  and click on the pencil icon to add your ",(0,o.kt)("strong",{parentName:"li"},"API key"),", that we determined earlier:")),(0,o.kt)("hr",null),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"IFTTT",src:a(7656).Z,width:"730",height:"296"})),(0,o.kt)("hr",null),(0,o.kt)("ol",{start:3},(0,o.kt)("li",{parentName:"ol"},"Just as in the ",(0,o.kt)("a",{parentName:"li",href:"#ifttt-setting-up-a-webhook"},"previous example"),", we now create an Applet on IFTTT that will use a ",(0,o.kt)("strong",{parentName:"li"},"Webhook")," to listen to the ",(0,o.kt)("inlineCode",{parentName:"li"},"ifttt_webhook")," event. Go to the ",(0,o.kt)("strong",{parentName:"li"},"My Applets")," tab on IFTTT and click on ",(0,o.kt)("strong",{parentName:"li"},"New Applet"),". Click on ",(0,o.kt)("strong",{parentName:"li"},"this")," and choose a ",(0,o.kt)("strong",{parentName:"li"},"Webhook")," as trigger:")),(0,o.kt)("hr",null),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"IFTTT",src:a(89252).Z,width:"730",height:"775"})),(0,o.kt)("hr",null),(0,o.kt)("ol",{start:4},(0,o.kt)("li",{parentName:"ol"},"You have to give this ",(0,o.kt)("strong",{parentName:"li"},"Webhook")," the ",(0,o.kt)("strong",{parentName:"li"},"Event Name")," that you choose in Node-RED in the previous step and give it the URL to your Node-RED server. This can be done via the WAN IP address (",(0,o.kt)("strong",{parentName:"li"},"Note")," that this usually changes every 24hrs) or via your INSTAR cameras DDNS address (as long as it is on the same network as your Node-RED server!). This is followed by the port used by your Node-RED installation - by default this is the ",(0,o.kt)("strong",{parentName:"li"},"Port 1880"),". ",(0,o.kt)("strong",{parentName:"li"},"Note")," that this port needs to be forwarded in your router for IFTTT to be able to access it! We complete the URL by adding ",(0,o.kt)("inlineCode",{parentName:"li"},"/pushalarm/trigger/recording")," to identify the Node-RED webhook that we will have to create later.")),(0,o.kt)("ol",{start:5},(0,o.kt)("li",{parentName:"ol"},"We can also add a message payload to the webhook request by IFTTT - this way we will be able to use the same webhook in Node-RED for more than one IFTTT Applet - e.g. when I leave home ",(0,o.kt)("strong",{parentName:"li"},"Applet 1")," sends the payload ",(0,o.kt)("inlineCode",{parentName:"li"},"{'val': 'on'}")," to activate the Motion Detection on my IP cameras. But if I arrive home and you receive ",(0,o.kt)("inlineCode",{parentName:"li"},"{'val': 'off'}")," from ",(0,o.kt)("strong",{parentName:"li"},"Applet 2"),", switch it off again. For this we have to switch to the ",(0,o.kt)("strong",{parentName:"li"},"POST Method"),", choose the ",(0,o.kt)("strong",{parentName:"li"},"JSON Content Type")," and the value that we need - like ",(0,o.kt)("inlineCode",{parentName:"li"},"{'val': 'on'}")," :")),(0,o.kt)("hr",null),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"IFTTT",src:a(41135).Z,width:"730",height:"664"})),(0,o.kt)("hr",null),(0,o.kt)("ol",{start:6},(0,o.kt)("li",{parentName:"ol"},"We now created an IFTTT Applet that, when triggered, will try to contact a webhook (",(0,o.kt)("strong",{parentName:"li"},"HTTP IN Node"),") in our Node-RED installation - make sure that the URL is reachable from the internet before you continue in step 4). Let's create that HTTP Endpoint in our Node-RED Flow:")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},"[{'id':'988f4c1b.cfac3','type':'http in','z':'b8ce5e67.23af6','name':'IFTTT Trigger','url':'/pushalarm/trigger/recording','method':'post','upload':false,'swaggerDoc':'','x':86,'y':238,'wires':[['650a9d50.1e9294','df518ee6.55111']]},{'id':'df518ee6.55111','type':'http response','z':'b8ce5e67.23af6','name':'','x':242,'y':239,'wires':[]},{'id':'650a9d50.1e9294','type':'json','z':'b8ce5e67.23af6','name':'','property':'payload','action':'','pretty':false,'x':242,'y':203,'wires':[['c2531a9f.8b5378']]},{'id':'c2531a9f.8b5378','type':'debug','z':'b8ce5e67.23af6','name':'','active':true,'tosidebar':true,'console':false,'tostatus':false,'complete':'false','x':381,'y':203,'wires':[]}]\n")),(0,o.kt)("hr",null),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"IFTTT",src:a(42200).Z,width:"730",height:"232"})),(0,o.kt)("hr",null),(0,o.kt)("p",null,"The sequence starts with an ",(0,o.kt)("strong",{parentName:"p"},"HTTP IN Node")," that expects a ",(0,o.kt)("strong",{parentName:"p"},"POST Request")," on ",(0,o.kt)("inlineCode",{parentName:"p"},"/pushalarm/trigger/recording")," - that is the URL we added to our IFTTT Applet as the webhook that needs to be contacted. We need to add an empty ",(0,o.kt)("strong",{parentName:"p"},"HTTP Response Node")," at the end for the webhook to be operational:"),(0,o.kt)("hr",null),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"IFTTT",src:a(41773).Z,width:"730",height:"335"})),(0,o.kt)("hr",null),(0,o.kt)("p",null,"Beside the  ",(0,o.kt)("strong",{parentName:"p"},"HTTP Response Node"),", we also connect a ",(0,o.kt)("strong",{parentName:"p"},"Debug Node")," that receives the payload that we set in the IFTTT Applet - the JSON payload ",(0,o.kt)("inlineCode",{parentName:"p"},"{'val': 'on'}")," will be received as a JavaScript Object that can be used by following nodes."),(0,o.kt)("p",null,"We can now test the chain that we build. Clicking on the ",(0,o.kt)("strong",{parentName:"p"},"Inject Node")," will contact the ",(0,o.kt)("strong",{parentName:"p"},"IFTTT Webhook")," that ",(0,o.kt)("strong",{parentName:"p"},"IFTTT Applet")," is listening at. The Applet, when triggered, will then contact the ",(0,o.kt)("strong",{parentName:"p"},"HTTP IN Node")," in our Node-RED Flow and transmit the JSON payload ",(0,o.kt)("inlineCode",{parentName:"p"},"{'val': 'on'}"),", as seen in the debug panel."),(0,o.kt)("hr",null),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"IFTTT",src:a(75236).Z,width:"730",height:"318"})),(0,o.kt)("hr",null),(0,o.kt)("h2",{id:"real-world-example"},"Real-world example"),(0,o.kt)("p",null,"We are now able to trigger IFTTT Applets from a Node-RED Flow, as well as trigger the Flow through an IFTTT Applet - which opens up the whole variety of ",(0,o.kt)("a",{parentName:"p",href:"https://ifttt.com/services"},"services IFTTT")," offers to automate our INSTAR IP camera."),(0,o.kt)("h3",{id:"deactivate-the-alarm-when-i-am-home"},"Deactivate the Alarm when I am Home"),(0,o.kt)("p",null,"IFTTT offers an ",(0,o.kt)("a",{parentName:"p",href:"https://play.google.com/store/apps/details?id=com.ifttt.ifttt"},"Android")," and ",(0,o.kt)("a",{parentName:"p",href:"https://itunes.apple.com/jp/app/ifttt/id660944635?mt=8"},"iOS")," App that can use the sensors on your phone to trigger your IFTTT Applets. For example, create a new Applet, choose ",(0,o.kt)("strong",{parentName:"p"},"this")," to add a trigger and search for ",(0,o.kt)("strong",{parentName:"p"},"location"),":"),(0,o.kt)("hr",null),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"IFTTT",src:a(75211).Z,width:"730",height:"480"})),(0,o.kt)("hr",null),(0,o.kt)("p",null,"Select the ",(0,o.kt)("strong",{parentName:"p"},"Location Trigger")," and choose if you want this trigger to go off when you enter an area or when you are leaving it - in the end we will have to add two applets for both cases. They can be combined into one Node-RED sequence later on. Choose ",(0,o.kt)("em",{parentName:"p"},"Enter Condition")," for now and point it to your home:"),(0,o.kt)("hr",null),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"IFTTT",src:a(29742).Z,width:"730",height:"736"})),(0,o.kt)("hr",null),(0,o.kt)("p",null,"Now we have to select a ",(0,o.kt)("strong",{parentName:"p"},"Webhook")," as the ",(0,o.kt)("strong",{parentName:"p"},"that")," condition - just as we have done in the earlier example. We will create a new ",(0,o.kt)("strong",{parentName:"p"},"HTTP IN Node")," listening on ",(0,o.kt)("inlineCode",{parentName:"p"},"/alarm/md/areas")," in Node-RED for it - the URL for the webhook will be ",(0,o.kt)("inlineCode",{parentName:"p"},"https://<DDNS Address>:1880/alarm/md/areas")," accordingly. The Applet has to use this URL to ",(0,o.kt)("strong",{parentName:"p"},"POST")," the ",(0,o.kt)("inlineCode",{parentName:"p"},"{'val':'off'}")," message:"),(0,o.kt)("hr",null),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"IFTTT",src:a(65815).Z,width:"731",height:"927"})),(0,o.kt)("hr",null),(0,o.kt)("p",null,"Repeat those steps for a second Applet that posts ",(0,o.kt)("inlineCode",{parentName:"p"},"{'val':'on'}"),", whenever you leave the area."),(0,o.kt)("p",null,"We can now use a variation of the Alarm Flow that we ",(0,o.kt)("a",{parentName:"p",href:"https://wiki.instar.com/en/Advanced_User/OpenHAB_Home_Automation/IP_Camera_Control/#setting-up-node-red"},"already used a couple of times")," to switch the alarm areas of our INSTAR IP camera on and off when the message ",(0,o.kt)("inlineCode",{parentName:"p"},"{'val':'on'}")," or ",(0,o.kt)("inlineCode",{parentName:"p"},"{'val':'off'}")," is posted to our ",(0,o.kt)("strong",{parentName:"p"},"HTTP IN Node")," webhook - you can ",(0,o.kt)("a",{parentName:"p",href:"https://wiki.instar.com/en/Node-RED_Flows/nodered_flow_alarm_areas_IFTTT.json"},"download the Flow from here")," and add your camera login to the ",(0,o.kt)("strong",{parentName:"p"},"Login Node"),". When the IFTTT Applets triggers our Node-RED webhook, the CGI commands for activating or deactivating the alarm areas will be send to your camera. ",(0,o.kt)("strong",{parentName:"p"},"Note")," that the commands used here only work with HD and Full HD cameras and you can replace them with every other CGI command you need:"),(0,o.kt)("hr",null),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"IFTTT",src:a(90113).Z,width:"730",height:"289"})),(0,o.kt)("hr",null))}h.isMDXComponent=!0},28645:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/IFTTT_01-d41e5d547bc2df834915e2894d46f335.png"},4506:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/IFTTT_02-beefdd808c49ce34ed825e72bd71ac73.png"},59768:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/IFTTT_03-60b5b50651f1117b6a85f2cf85cd17d5.png"},20785:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/IFTTT_04-4c91ba5e722946ca9c52e6f9e704f2fd.png"},35120:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/IFTTT_05-ea23ce0fe5abdc3f728249db3e47cfee.png"},36690:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/IFTTT_06-6f8638345d099115b615206157972718.png"},73673:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/IFTTT_07-acc7fa24dd04f67fc9a3055add8ba770.png"},22644:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/IFTTT_08-0d5dad87a60a10aad5fcd40400754a7e.png"},56511:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/IFTTT_09-c990d5589454af8e70b6dc9aea868cd3.png"},44822:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/IFTTT_10-7da02e82dfbfb05c88b6f504327f0ab4.png"},35619:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/IFTTT_11-1732a6f1808fe1d3f9cbc16d49fc4ea5.png"},21487:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/IFTTT_12-2268d1d1331212ad71a38c4acb158e22.png"},36526:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/IFTTT_13-78db208c523f90364f64da963bccb04e.png"},79889:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/IFTTT_14-8b0e437d17ccf998062041092ad3a94e.png"},85568:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/IFTTT_15-1c7640c05ae58ee8c34d97785ff44cb2.png"},93240:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/IFTTT_16-308e146875590d2fede1898ab4e0ceac.png"},45610:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/IFTTT_17-d2d2b3afe8f3e9cd2c0d95bfdb7a6652.png"},5598:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/IFTTT_18-ee843e3e17946265dc31eab27b9cfdd4.png"},7656:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/IFTTT_19-a69a3c74e6cf7fd770a144521d23f545.png"},89252:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/IFTTT_20-6daee532e13014f5b85f6cde6ba24f4b.png"},41135:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/IFTTT_21-11bceec2d861dfe671a9ad5074590808.png"},42200:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/IFTTT_22-4272bcf25cda75a83637623715205d79.png"},41773:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/IFTTT_23-2fcc662ee5e816ff92302ccd6313d5c1.png"},75236:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/IFTTT_24-af3a44fba6c7bb9b429846c21ffb3434.gif"},75211:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/IFTTT_25-fdeab40d5596ecf0a7ec3f2e8fd66988.png"},29742:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/IFTTT_26-4f59994ee179eb91bfd68ed57d6eebc5.png"},65815:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/IFTTT_27-01d492c79eda338edf634f3afb6422c0.png"},90113:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/IFTTT_28-0d77d528196d8c9b732453c84bc41db0.gif"},50528:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/photo-15491736416_6abd8de751_o-b6acc423fc2fd175cd430638e4ea1ef2.png"}}]);