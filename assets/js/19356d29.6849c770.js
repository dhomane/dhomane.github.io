"use strict";(self.webpackChunkmikes_dev_notebook=self.webpackChunkmikes_dev_notebook||[]).push([[32137],{3905:(e,n,t)=>{t.d(n,{Zo:()=>p,kt:()=>g});var a=t(67294);function i(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function r(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?r(Object(t),!0).forEach((function(n){i(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,a,i=function(e,n){if(null==e)return{};var t,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||(i[t]=e[t]);return i}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}var c=a.createContext({}),s=function(e){var n=a.useContext(c),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},p=function(e){var n=s(e.components);return a.createElement(c.Provider,{value:n},e.children)},d={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},u=a.forwardRef((function(e,n){var t=e.components,i=e.mdxType,r=e.originalType,c=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),u=s(t),g=i,f=u["".concat(c,".").concat(g)]||u[g]||d[g]||r;return t?a.createElement(f,o(o({ref:n},p),{},{components:t})):a.createElement(f,o({ref:n},p))}));function g(e,n){var t=arguments,i=n&&n.mdxType;if("string"==typeof e||i){var r=t.length,o=new Array(r);o[0]=u;var l={};for(var c in n)hasOwnProperty.call(n,c)&&(l[c]=n[c]);l.originalType=e,l.mdxType="string"==typeof e?e:i,o[1]=l;for(var s=2;s<r;s++)o[s]=t[s];return a.createElement.apply(null,o)}return a.createElement.apply(null,t)}u.displayName="MDXCreateElement"},16809:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>d,frontMatter:()=>r,metadata:()=>l,toc:()=>s});var a=t(87462),i=(t(67294),t(3905));const r={sidebar_position:9040,slug:"2020-08-26",title:"NGINX Docker Setup",authors:"mpolinowski",tags:["LINUX","NGINX","Docker"]},o=void 0,l={unversionedId:"DevOps/NGINX/2020-08-26--nginx-docker-setup/index",id:"DevOps/NGINX/2020-08-26--nginx-docker-setup/index",title:"NGINX Docker Setup",description:"Victoria Harbour, Hong Kong",source:"@site/docs/DevOps/NGINX/2020-08-26--nginx-docker-setup/index.md",sourceDirName:"DevOps/NGINX/2020-08-26--nginx-docker-setup",slug:"/DevOps/NGINX/2020-08-26--nginx-docker-setup/2020-08-26",permalink:"/docs/DevOps/NGINX/2020-08-26--nginx-docker-setup/2020-08-26",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/DevOps/NGINX/2020-08-26--nginx-docker-setup/index.md",tags:[{label:"LINUX",permalink:"/docs/tags/linux"},{label:"NGINX",permalink:"/docs/tags/nginx"},{label:"Docker",permalink:"/docs/tags/docker"}],version:"current",sidebarPosition:9040,frontMatter:{sidebar_position:9040,slug:"2020-08-26",title:"NGINX Docker Setup",authors:"mpolinowski",tags:["LINUX","NGINX","Docker"]},sidebar:"tutorialSidebar",previous:{title:"NGINX Docker with SSL Encryption (Self-signed)",permalink:"/docs/DevOps/NGINX/2020-08-27--nginx-docker-ssl-certs-self-signed/2020-08-27"},next:{title:"Securing Webservers - Apache and NGINX",permalink:"/docs/DevOps/NGINX/2020-07-29--securing-apache-and-nginx/2020-07-29"}},c={},s=[{value:"NGINX Configuration Overview",id:"nginx-configuration-overview",level:2},{value:"Testing Configuration",id:"testing-configuration",level:2},{value:"Location Context Modifier",id:"location-context-modifier",level:2},{value:"Prefix",id:"prefix",level:3},{value:"Exact Value",id:"exact-value",level:3},{value:"Case Sensitive Regular Expression",id:"case-sensitive-regular-expression",level:3},{value:"Case Insensitive Regular Expression",id:"case-insensitive-regular-expression",level:3},{value:"Try Files Directive",id:"try-files-directive",level:2},{value:"Structuring the Main Configuration File",id:"structuring-the-main-configuration-file",level:2},{value:"/etc/nginx/nginx.conf",id:"etcnginxnginxconf",level:3},{value:"/etc/nginx/conf.d/buffers.conf",id:"etcnginxconfdbuffersconf",level:3},{value:"/etc/nginx/conf.d/timeouts.conf",id:"etcnginxconfdtimeoutsconf",level:3},{value:"/etc/nginx/conf.d/cache.conf",id:"etcnginxconfdcacheconf",level:3},{value:"/etc/nginx/conf.d/gzip.conf",id:"etcnginxconfdgzipconf",level:3},{value:"Setting up the Server Context",id:"setting-up-the-server-context",level:2},{value:"/etc/nginx/conf.d/default.conf",id:"etcnginxconfddefaultconf",level:3},{value:"/etc/nginx/conf.d/header.conf",id:"etcnginxconfdheaderconf",level:3},{value:"Docker Compose",id:"docker-compose",level:2}],p={toc:s};function d(e){let{components:n,...r}=e;return(0,i.kt)("wrapper",(0,a.Z)({},p,r,{components:n,mdxType:"MDXLayout"}),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Victoria Harbour, Hong Kong",src:t(49129).Z,width:"1500",height:"509"})),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#nginx-configuration-overview"},"NGINX Configuration Overview")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#testing-configuration"},"Testing Configuration")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#location-context-modifier"},"Location Context Modifier"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#prefix"},"Prefix")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#exact-value"},"Exact Value")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#case-sensitive-regular-expression"},"Case Sensitive Regular Expression")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#case-insensitive-regular-expression"},"Case Insensitive Regular Expression")))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#try-files-directive"},"Try Files Directive")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#structuring-the-main-configuration-file"},"Structuring the Main Configuration File"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#etcnginxnginxconf"},"/etc/nginx/nginx.conf")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#etcnginxconfdbuffersconf"},"/etc/nginx/conf.d/buffers.conf")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#etcnginxconfdtimeoutsconf"},"/etc/nginx/conf.d/timeouts.conf")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#etcnginxconfdcacheconf"},"/etc/nginx/conf.d/cache.conf")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#etcnginxconfdgzipconf"},"/etc/nginx/conf.d/gzip.conf")))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#setting-up-the-server-context"},"Setting up the Server Context"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#etcnginxconfddefaultconf"},"/etc/nginx/conf.d/default.conf")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#etcnginxconfdheaderconf"},"/etc/nginx/conf.d/header.conf")))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#docker-compose"},"Docker Compose"))),(0,i.kt)("p",null,"I want to create a template configuration for the Alpine-based NGINX Docker image from DockerHub: ",(0,i.kt)("inlineCode",{parentName:"p"},"nginx:stable-alpine"),". The idea is to have folder with configuration files that I can modify - according to my project - and then mount as a volume into vanilla NGINX container to proxy my web applications:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"docker run -d -p 80:80 -v /opt/nginx_config:/etc/nginx/conf.d --name nginx nginx:stable-alpine\n")),(0,i.kt)("h2",{id:"nginx-configuration-overview"},"NGINX Configuration Overview"),(0,i.kt)("p",null,"The default NGINX configuration file is structured like this:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-cfg"},"# main\n...\nevents {\n    ...\n}\n\n\nhttp {\n    server {\n        location {\n            ...\n        }\n    }\n}\n")),(0,i.kt)("p",null,"Each ",(0,i.kt)("strong",{parentName:"p"},"Block")," in the configuration file:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-cfg"},"main {{events {http { server { location {}}}}}}\n")),(0,i.kt)("p",null,"Is called a ",(0,i.kt)("strong",{parentName:"p"},"Context"),". Each Context holds ",(0,i.kt)("strong",{parentName:"p"},"Directives")," which are parameter / value pairs like ",(0,i.kt)("inlineCode",{parentName:"p"},"server_name localhost;"),". Such blocks can be separated from the main configuration file and then included using the include keyword:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"include /etc/nginx/conf.d/*.conf;\n")),(0,i.kt)("h2",{id:"testing-configuration"},"Testing Configuration"),(0,i.kt)("p",null,"After make changes to your configuration file you can validate it in NGINX without having to reload your service:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"nginx -t\n")),(0,i.kt)("p",null,"To apply those changes you have to reload or restart the NGINX service. The restart will stop the service and start it again, while the reload will keep the original process running. In the latter case, if something goes wrong with the configuration update, it will simply be discarded and your server stays online with the old configuration:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"systemctl reload nginx\nsystemctl restart nginx\n")),(0,i.kt)("p",null,"However, since the Docker image does not use SystemD to run the service, you can test the configuration inside the NGINX docker container but then have to restart the container to have it take effect."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"docker exec -ti name-or-id-of-my-nginx-container nginx -t\n\nnginx: the configuration file /etc/nginx/nginx.conf syntax is ok\nnginx: configuration file /etc/nginx/nginx.conf test is successful\n")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"docker stop name-or-id-of-my-nginx-container\ndocker start name-or-id-of-my-nginx-container\n")),(0,i.kt)("h2",{id:"location-context-modifier"},"Location Context Modifier"),(0,i.kt)("p",null,"The location match defines what NGINX checks the incoming request against. How the match is applied can be influenced by a modifier:"),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"Modifier"),(0,i.kt)("th",{parentName:"tr",align:null},"Description"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"none"),(0,i.kt)("td",{parentName:"tr",align:null},"matched as prefix value")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"=")),(0,i.kt)("td",{parentName:"tr",align:null},"matched as an exact value")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"~")),(0,i.kt)("td",{parentName:"tr",align:null},"matched as case sensitive regular expression")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"~*")),(0,i.kt)("td",{parentName:"tr",align:null},"matched as case insensitive regular expression")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"^~")),(0,i.kt)("td",{parentName:"tr",align:null},"matched as prefix value with higher importance than a regular expression")))),(0,i.kt)("p",null,"The modifiers are processed in the following order:"),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"Order"),(0,i.kt)("th",{parentName:"tr",align:null},"Modifier"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"1"),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"="))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"2"),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"^~"))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"3"),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"~")," and ",(0,i.kt)("inlineCode",{parentName:"td"},"~*"))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"4"),(0,i.kt)("td",{parentName:"tr",align:null},"none")))),(0,i.kt)("h3",{id:"prefix"},"Prefix"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-cfg"},"location /de {\n\n}\n")),(0,i.kt)("p",null,"No modifier matches as a prefix example matches are:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"http://URL/de\nhttp://URL/de123\nhttp://URL/deutsch\netc.\n")),(0,i.kt)("h3",{id:"exact-value"},"Exact Value"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-cfg"},"location = /de {\n\n}\n")),(0,i.kt)("p",null,"Only an exact match will pass:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"http://URL/de\n")),(0,i.kt)("h3",{id:"case-sensitive-regular-expression"},"Case Sensitive Regular Expression"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-cfg"},"location ~ /de[0-9] {\n\n}\nlocation ~ /de[a-z] {\n\n}\n")),(0,i.kt)("p",null,"This regular expression expects that the ",(0,i.kt)("inlineCode",{parentName:"p"},"/de")," is either followed by numbers or by non-capital letters. Capital letters or mixed numbers and small letters will not match:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"http://URL/de122\nhttp://URL/deutsch\netc.\n")),(0,i.kt)("h3",{id:"case-insensitive-regular-expression"},"Case Insensitive Regular Expression"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-cfg"},"location ~ /de[0-9] {\n\n}\nlocation ~ /de[a-z] {\n\n}\n")),(0,i.kt)("p",null,"This regular expression expects that the ",(0,i.kt)("inlineCode",{parentName:"p"},"/de")," is either followed by numbers or by letters. Mixed numbers and small letters will not match:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"http://URL/de122\nhttp://URL/deutsch\nhttp://URL/deUTSCH\netc.\n")),(0,i.kt)("h2",{id:"try-files-directive"},"Try Files Directive"),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"try_files")," directive to match the incoming URL to different setups - for example to ",(0,i.kt)("inlineCode",{parentName:"p"},"$uri")," or ",(0,i.kt)("inlineCode",{parentName:"p"},"$uri/")," with a trailing backslash or to a static file:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-cfg"},"location / {\n    try_files $uri $uri/ /index.html;\n}\n")),(0,i.kt)("p",null,"NGINX will first try to find an exact match. Then try to add a trailing backslash. And lastly redirect you to the front page if no other fit was found."),(0,i.kt)("h2",{id:"structuring-the-main-configuration-file"},"Structuring the Main Configuration File"),(0,i.kt)("h3",{id:"etcnginxnginxconf"},"/etc/nginx/nginx.conf"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-cfg"},"user  nginx;\nworker_processes  auto;\nworker_rlimit_nofile  15000;\npid  /var/run/nginx.pid;\ninclude /usr/share/nginx/modules/*.conf;\n\n\nevents {\n    worker_connections  2048;\n    multi_accept on;\n    use epoll;\n}\n\n\nhttp {\n    default_type   application/octet-stream;\n    # access_log   /var/log/nginx/access.log;\n    # activate the server access log only when needed\n    access_log     off;\n    error_log      /var/log/nginx/error.log;\n    # don't display server version on error pages\n    server_tokens  off;\n    server_names_hash_bucket_size 64;\n    include        /etc/nginx/mime.types;\n    sendfile       on;\n    tcp_nopush     on;\n    tcp_nodelay    on;\n\n    charset utf-8;\n    source_charset utf-8;\n    charset_types text/xml text/plain text/vnd.wap.wml application/javascript application/rss+xml;\n\n    include /etc/nginx/conf.d/default.conf;\n    include /etc/nginx/conf.d/buffers.conf;\n    include /etc/nginx/conf.d/timeouts.conf;\n    # Only activate caching in production\n    # include /etc/nginx/conf.d/cache.conf;\n    include /etc/nginx/conf.d/gzip.conf;\n}\n")),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"Set SELinux policy to allow setrlimit (",(0,i.kt)("inlineCode",{parentName:"p"},"worker_rlimit_nofile"),"): ",(0,i.kt)("inlineCode",{parentName:"p"},"setsebool -P https_setrlimit 1"),". A low r limit might lead to an error message of too many open files under load.")),(0,i.kt)("p",null,"This configuration file is missing the server and location context. Both of them will reside in a separate file in the included ",(0,i.kt)("inlineCode",{parentName:"p"},"conf.d")," directory called ",(0,i.kt)("inlineCode",{parentName:"p"},"default.conf"),". Along side we also include a couple of configuration files:"),(0,i.kt)("h3",{id:"etcnginxconfdbuffersconf"},"/etc/nginx/conf.d/buffers.conf"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-cfg"},"client_body_buffer_size 10k;\nclient_header_buffer_size 1k;\nclient_max_body_size 8m;\nlarge_client_header_buffers 2                                   1k;\n# large_client_header_buffers directive needs to be increased\n# large_client_header_buffers                                   4 32k;\n")),(0,i.kt)("h3",{id:"etcnginxconfdtimeoutsconf"},"/etc/nginx/conf.d/timeouts.conf"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-cfg"},"client_header_timeout 3m;\nclient_body_timeout 3m;\nkeepalive_timeout 100;\nkeepalive_requests 1000;\nsend_timeout 3m;\n")),(0,i.kt)("h3",{id:"etcnginxconfdcacheconf"},"/etc/nginx/conf.d/cache.conf"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-cfg"},"open_file_cache max=1500 inactive=20s;\nopen_file_cache_valid 30s;\nopen_file_cache_min_uses 5;\nopen_file_cache_errors off;\n")),(0,i.kt)("h3",{id:"etcnginxconfdgzipconf"},"/etc/nginx/conf.d/gzip.conf"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-cfg"},'gzip on;\ngzip_disable "MSIE [1-6]\\.(?!.*SV1)";;\ngzip_vary on;\ngzip_proxied no-cache no-store private expired;\ngzip_comp_level 5;\ngzip_min_length 256;\ngzip_buffers 16 8k;\ngzip_http_version 1.1;\ngzip_types text/plain text/css application/json application/javascript\ntext/xml application/xml application/xml+rss text/javascript\nimage/svg+xml application/xhtml+xml application/atom+xml application/x-javascript;\n')),(0,i.kt)("h2",{id:"setting-up-the-server-context"},"Setting up the Server Context"),(0,i.kt)("p",null,"The application that I am serving has a path prefix to ",(0,i.kt)("inlineCode",{parentName:"p"},"/en/"),". That means I have to redirect all incoming traffic on ",(0,i.kt)("inlineCode",{parentName:"p"},"/")," to ",(0,i.kt)("inlineCode",{parentName:"p"},"/en/"),". The static HTML content that I am serving lies in ",(0,i.kt)("inlineCode",{parentName:"p"},"/opt/test-static/public")," and has to be set as the root directory for my server."),(0,i.kt)("h3",{id:"etcnginxconfddefaultconf"},"/etc/nginx/conf.d/default.conf"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-cfg"},"server {\n    listen       80 default_server;\n    listen       [::]:80 default_server;\n    server_name  localhost;\n    root         /opt/test-static/public;\n    index        index.html;\n\n    location = / {\n        rewrite   ^/(.*)$  /en/$1  permanent;\n    }\n\n    location /en/ {\n        try_files  $uri $uri/ $uri.html =404;\n        include    /etc/nginx/conf.d/header.conf;\n    }\n\n    location ~ /en/download_area/.* {\n        root /opt/downloads;\n        # deactivate autoindex to use try_files\n        # try_files $uri /en/download_area/morning.gif;\n        autoindex on;\n        autoindex_exact_size off;\n        autoindex_format html;\n        autoindex_localtime on;\n    }\n\n    error_page  404              /en/404.html;\n    error_page  500 502 503 504  /50x.html;\n    location = /50x.html {\n        root   /usr/share/nginx/html;\n    }\n}\n")),(0,i.kt)("h3",{id:"etcnginxconfdheaderconf"},"/etc/nginx/conf.d/header.conf"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-cfg"},'add_header                Cache-Control  "public, must-revalidate, proxy-revalidate, max-age=0";\nproxy_set_header          X-Forwarded-For $proxy_add_x_forwarded_for;\nproxy_set_header          X-NginX-Proxy true;\nproxy_set_header          X-Real-IP $remote_addr;\nproxy_set_header          X-Forwarded-Proto http;\nproxy_hide_header         X-Frame-Options;\nproxy_set_header          Accept-Encoding "";\nproxy_http_version        1.1;\nproxy_set_header          Upgrade $http_upgrade;\nproxy_set_header          Connection "upgrade";\nproxy_set_header          Host $host;\nproxy_cache_bypass        $http_upgrade;\nproxy_max_temp_file_size  0;\nproxy_redirect            off;\nproxy_read_timeout        240s;\n')),(0,i.kt)("h2",{id:"docker-compose"},"Docker Compose"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yml"},"version: '3.8'\nservices:\n  ingress:\n    image: nginx:stable-alpine\n    container_name: ingress\n    networks:\n      - gateway\n    ports:\n      - '80:80'\n      - '443:443'\n    restart: unless-stopped\n    volumes:\n      - /opt/docker-ingress/configuration/conf.d:/etc/nginx/conf.d\n      - /opt/docker-ingress/configuration/nginx.conf:/etc/nginx/nginx.conf\n      - /opt/test-static/public:/opt/test-static/public\n      - /opt/downloads:/opt/downloads\n\nnetworks:\n  gateway: {}\n")),(0,i.kt)("p",null,"Tree structure for the mounted download directory:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"/opt/downloads\n\u2514\u2500\u2500 en\n    \u2514\u2500\u2500 download_area\n        \u251c\u2500\u2500 morning.gif\n        \u2514\u2500\u2500 top-cat.png\n\n2 directories, 2 files\n")))}d.isMDXComponent=!0},49129:(e,n,t)=>{t.d(n,{Z:()=>a});const a=t.p+"assets/images/photo-kt443t6d_64hdh43hfh6dgjdfhg4_d-b57dcf7a42ddd712383aadde6d3ef4c8.jpg"}}]);