"use strict";(self.webpackChunkmikes_dev_notebook=self.webpackChunkmikes_dev_notebook||[]).push([[17312],{3905:(e,n,t)=>{t.d(n,{Zo:()=>d,kt:()=>m});var a=t(67294);function s(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function l(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?l(Object(t),!0).forEach((function(n){s(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):l(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function u(e,n){if(null==e)return{};var t,a,s=function(e,n){if(null==e)return{};var t,a,s={},l=Object.keys(e);for(a=0;a<l.length;a++)t=l[a],n.indexOf(t)>=0||(s[t]=e[t]);return s}(e,n);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)t=l[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(s[t]=e[t])}return s}var i=a.createContext({}),r=function(e){var n=a.useContext(i),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},d=function(e){var n=r(e.components);return a.createElement(i.Provider,{value:n},e.children)},c={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},p=a.forwardRef((function(e,n){var t=e.components,s=e.mdxType,l=e.originalType,i=e.parentName,d=u(e,["components","mdxType","originalType","parentName"]),p=r(t),m=s,h=p["".concat(i,".").concat(m)]||p[m]||c[m]||l;return t?a.createElement(h,o(o({ref:n},d),{},{components:t})):a.createElement(h,o({ref:n},d))}));function m(e,n){var t=arguments,s=n&&n.mdxType;if("string"==typeof e||s){var l=t.length,o=new Array(l);o[0]=p;var u={};for(var i in n)hasOwnProperty.call(n,i)&&(u[i]=n[i]);u.originalType=e,u.mdxType="string"==typeof e?e:s,o[1]=u;for(var r=2;r<l;r++)o[r]=t[r];return a.createElement.apply(null,o)}return a.createElement.apply(null,t)}p.displayName="MDXCreateElement"},37315:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>i,contentTitle:()=>o,default:()=>c,frontMatter:()=>l,metadata:()=>u,toc:()=>r});var a=t(87462),s=(t(67294),t(3905));const l={sidebar_position:9090,slug:"2020-06-15",title:"Salty DevOps",authors:"mpolinowski",tags:["LINUX","Salt"]},o=void 0,u={unversionedId:"DevOps/Salt/2020-06-15--salty-devops/index",id:"DevOps/Salt/2020-06-15--salty-devops/index",title:"Salty DevOps",description:"Shenzhen, China",source:"@site/docs/DevOps/Salt/2020-06-15--salty-devops/index.mdx",sourceDirName:"DevOps/Salt/2020-06-15--salty-devops",slug:"/DevOps/Salt/2020-06-15--salty-devops/2020-06-15",permalink:"/docs/DevOps/Salt/2020-06-15--salty-devops/2020-06-15",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/DevOps/Salt/2020-06-15--salty-devops/index.mdx",tags:[{label:"LINUX",permalink:"/docs/tags/linux"},{label:"Salt",permalink:"/docs/tags/salt"}],version:"current",sidebarPosition:9090,frontMatter:{sidebar_position:9090,slug:"2020-06-15",title:"Salty DevOps",authors:"mpolinowski",tags:["LINUX","Salt"]},sidebar:"tutorialSidebar",previous:{title:"Salt State",permalink:"/docs/DevOps/Salt/2020-06-16--salt-state/2020-06-16"},next:{title:"Install Salt on Ubuntu Server 20.04",permalink:"/docs/DevOps/Salt/2020-06-14--install-salt-on-ubuntu-20-04/2020-06-14"}},i={},r=[{value:"Execution Modules",id:"execution-modules",level:2},{value:"The TEST Module",id:"the-test-module",level:3},{value:"The PKG Module",id:"the-pkg-module",level:3},{value:"The USER Module",id:"the-user-module",level:3},{value:"The SERVICE Module",id:"the-service-module",level:3},{value:"The STATUS Module",id:"the-status-module",level:3},{value:"The CMD Module",id:"the-cmd-module",level:3},{value:"The GRAINS Module",id:"the-grains-module",level:3},{value:"Internal Execution Modules",id:"internal-execution-modules",level:2},{value:"The CP Module",id:"the-cp-module",level:3},{value:"The MATCH Module",id:"the-match-module",level:3},{value:"Minion Invocation",id:"minion-invocation",level:2}],d={toc:r};function c(e){let{components:n,...l}=e;return(0,s.kt)("wrapper",(0,a.Z)({},d,l,{components:n,mdxType:"MDXLayout"}),(0,s.kt)("p",null,(0,s.kt)("img",{alt:"Shenzhen, China",src:t(22244).Z,width:"1500",height:"491"})),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"#execution-modules"},"Execution Modules"),(0,s.kt)("ul",{parentName:"li"},(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"#the-test-module"},"The TEST Module")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"#the-pkg-module"},"The PKG Module")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"#the-user-module"},"The USER Module")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"#the-service-module"},"The SERVICE Module")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"#the-status-module"},"The STATUS Module")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"#the-cmd-module"},"The CMD Module")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"#the-grains-module"},"The GRAINS Module")))),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"#internal-execution-modules"},"Internal Execution Modules"),(0,s.kt)("ul",{parentName:"li"},(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"#the-cp-module"},"The CP Module")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"#the-match-module"},"The MATCH Module")))),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"#minion-invocation"},"Minion Invocation"))),(0,s.kt)("h2",{id:"execution-modules"},"Execution Modules"),(0,s.kt)("p",null,"The ",(0,s.kt)("a",{parentName:"p",href:"https://docs.saltstack.com/en/latest/salt-modindex.html"},"Salt Module Index")," lists ",(0,s.kt)("a",{parentName:"p",href:"https://docs.saltstack.com/en/latest/ref/modules/all/index.html"},"all available execution modules"),"."),(0,s.kt)("p",null,"To check all loaded modules or functions on a Minion:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"sudo salt ubuntuAsus sys.list_modules | less\nsudo salt ubuntuAsus sys.list_functions | less\n")),(0,s.kt)("h3",{id:"the-test-module"},"The TEST Module"),(0,s.kt)("p",null,"One module that we already used to see if our Minions were up was the ",(0,s.kt)("a",{parentName:"p",href:"https://docs.saltstack.com/en/latest/ref/modules/all/salt.modules.test.html#salt.modules.test.ping"},"Test Module"),"."),(0,s.kt)("p",null,"Salt abstracts the OS layer for you. For example the ",(0,s.kt)("strong",{parentName:"p"},"PKG")," command will automatically choose the correct way to install a software on your minions based on the operating system they are using."),(0,s.kt)("p",null,"Another way to see the module documentation is using the ",(0,s.kt)("inlineCode",{parentName:"p"},"sys.doc")," command:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"sudo salt ubuntuAsus sys.doc test.ping\n\ntest.ping:\n\n    Used to make sure the minion is up and responding. Not an ICMP ping.\n\n    Returns ``True``.\n\n    CLI Example:\n\n        salt '*' test.ping\n")),(0,s.kt)("p",null,"If you need an overview over all available test functions:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"sudo salt ubuntuAsus sys.doc test | less\n")),(0,s.kt)("p",null,"Check installed version of Salt and dependencies: "),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"sudo salt ubuntuAsus test.version\n\nsudo salt ubuntuAsus test.versions_report\n")),(0,s.kt)("h3",{id:"the-pkg-module"},"The PKG Module"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"sudo salt ubuntuAsus sys.doc pkg.list_pkgs\n\n\npkg.list_pkgs:\n\n    List the packages currently installed in a dict::\n\n        {'<package_name>': '<version>'}\n\n    removed\n        If ``True``, then only packages which have been removed (but not\n        purged) will be returned.\n\n    purge_desired\n        If ``True``, then only packages which have been marked to be purged,\n        but can't be purged due to their status as dependencies for other\n        installed packages, will be returned. Note that these packages will\n        appear in installed\n\n        Changed in version 2014.1.1\n\n            Packages in this state now correctly show up in the output of this\n            function.\n\n\n    CLI Example:\n\n        salt '*' pkg.list_pkgs\n        salt '*' pkg.list_pkgs versions_as_list=True\n")),(0,s.kt)("p",null,"List all installed packages on a minion:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"sudo salt ubuntuAsus pkg.list_pkgs | less\n\nsudo salt -L ubuntuAsus,ubuntuBrix pkg.list_pkgs | grep docker\n")),(0,s.kt)("p",null,"Verify a dependency is installed on all minions and install it where still missing:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"sudo salt '*' pkg.list_pkgs --out=txt | grep wget | cut -c -10\n\nsudo salt ubuntuAsus pkg.install wget\n")),(0,s.kt)("h3",{id:"the-user-module"},"The USER Module"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"sudo salt ubuntuAsus sys.doc user | less\n")),(0,s.kt)("p",null,"List all users on a Minion:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"sudo salt ubuntuAsus user.list_users\n")),(0,s.kt)("p",null,"Get Info for a spefic user:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"sudo salt ubuntuAsus user.info ubuntu\n\nubuntuAsus:\n    ----------\n    fullname:\n        ubuntu\n    gid:\n        1000\n    groups:\n        - adm\n        - cdrom\n        - dip\n        - lxd\n        - plugdev\n        - sudo\n        - ubuntu\n    home:\n        /home/ubuntu\n    homephone:\n    name:\n        ubuntu\n    other:\n    passwd:\n        x\n    roomnumber:\n    shell:\n        /usr/bin/zsh\n    uid:\n        1000\n    workphone:\n")),(0,s.kt)("h3",{id:"the-service-module"},"The SERVICE Module"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"sudo salt ubuntuAsus sys.doc service | less\n")),(0,s.kt)("p",null,"Get all running services on Minion:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"sudo salt ubuntuAsus service.get_running\n")),(0,s.kt)("p",null,"Restart a service:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"sudo salt ubuntuAsus service.restart salt-minion  // takes a while to restart\n\nsudo salt ubuntuAsus service.status salt-minion\n")),(0,s.kt)("h3",{id:"the-status-module"},"The STATUS Module"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"sudo salt ubuntuAsus sys.doc status | less\n")),(0,s.kt)("p",null,"Check logged in users and disk usage:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"sudo salt ubuntuAsus status.w\nsudo salt ubuntuAsus status.diskusage\n")),(0,s.kt)("h3",{id:"the-cmd-module"},"The CMD Module"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"sudo salt ubuntuAsus sys.doc cmd | less\n")),(0,s.kt)("p",null,"List content of directory and read files on Minions:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"sudo salt ubuntuAsus cmd.run 'ls -lh /home/ubuntu'\nsudo salt ubuntuAsus cmd.run 'cat /etc/salt/minion.d/local.conf'\n")),(0,s.kt)("h3",{id:"the-grains-module"},"The GRAINS Module"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"sudo salt ubuntuAsus sys.doc grains | less\n")),(0,s.kt)("p",null,"Get or set value of a Grain"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"sudo salt ubuntuAsus grains.get os\nsudo salt ubuntuAsus grains.get systemd:version\nsudo salt ubuntuAsus grains.set 'apps:port' 8888\nsudo salt ubuntuAsus grains.get apps\nsudo salt ubuntuAsus grains.setval apps '{'port':'7777'}'\nsudo salt ubuntuAsus grains.get apps\n\nsalt '*' grains.filter_by '{Debian: Debheads rule, RedHat: I love my hat}'\n")),(0,s.kt)("h2",{id:"internal-execution-modules"},"Internal Execution Modules"),(0,s.kt)("h3",{id:"the-cp-module"},"The CP Module"),(0,s.kt)("p",null,"Copying files between Master and Minion:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"sudo salt ubuntuAsus sys.doc cp | less\n")),(0,s.kt)("h3",{id:"the-match-module"},"The MATCH Module"),(0,s.kt)("p",null,"Copying files between Master and Minion:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"sudo salt ubuntuAsus sys.doc match | less\n")),(0,s.kt)("p",null,"Return True if the minion matches the given ",(0,s.kt)("inlineCode",{parentName:"p"},"grain_pcre")," target."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"sudo salt ubuntuAsus match.grain_pcre 'os:Ubuntu.*'\n")),(0,s.kt)("h2",{id:"minion-invocation"},"Minion Invocation"),(0,s.kt)("p",null,"The ",(0,s.kt)("inlineCode",{parentName:"p"},"salt-call")," function can be used to trigger the Salt API from the Minion server:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"sudo salt-call test.ping\nlocal:\n    True\n")),(0,s.kt)("p",null,"This can be used to debug a Salt module directly on your Minion:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"sudo salt-call network.netstat -l debug\n\n[DEBUG   ] Reading configuration from /etc/salt/minion\n[DEBUG   ] Including configuration from '/etc/salt/minion.d/_schedule.conf'\n[DEBUG   ] Reading configuration from /etc/salt/minion.d/_schedule.conf\n[DEBUG   ] Including configuration from '/etc/salt/minion.d/local.conf'\n[DEBUG   ] Reading configuration from /etc/salt/minion.d/local.conf\n[DEBUG   ] Configuration file path: /etc/salt/minion\n[WARNING ] Insecure logging configuration detected! Sensitive data may be logged.\n[DEBUG   ] Grains refresh requested. Refreshing grains.\n[DEBUG   ] Reading configuration from /etc/salt/minion\n[DEBUG   ] Including configuration from '/etc/salt/minion.d/_schedule.conf'\n[DEBUG   ] Reading configuration from /etc/salt/minion.d/_schedule.conf\n[DEBUG   ] Including configuration from '/etc/salt/minion.d/local.conf'\n[DEBUG   ] Reading configuration from /etc/salt/minion.d/local.conf\n[DEBUG   ] Elapsed time getting FQDNs: 0.017540931701660156 seconds\n[DEBUG   ] Loading static grains from /etc/salt/grains\n[DEBUG   ] LazyLoaded zfs.is_supported\n[DEBUG   ] Connecting to master. Attempt 1 of 1\n[DEBUG   ] Master URI: tcp://192.168.2.110:4506\n[DEBUG   ] Initializing new AsyncAuth for ('/etc/salt/pki/minion', 'ubuntuAsus', 'tcp://192.168.2.110:4506')\n[DEBUG   ] Generated random reconnect delay between '1000ms' and '11000ms' (10666)\n[DEBUG   ] Setting zmq_reconnect_ivl to '10666ms'\n[DEBUG   ] Setting zmq_reconnect_ivl_max to '11000ms'\n[DEBUG   ] Initializing new AsyncZeroMQReqChannel for ('/etc/salt/pki/minion', 'ubuntuAsus', 'tcp://192.168.2.110:4506', 'clear')\n[DEBUG   ] Connecting the Minion to the Master URI (for the return server): tcp://192.168.2.110:4506\n[DEBUG   ] Trying to connect to: tcp://192.168.2.110:4506\n[DEBUG   ] salt.crypt.get_rsa_pub_key: Loading public key\n[DEBUG   ] Decrypting the current master AES key\n[DEBUG   ] salt.crypt.get_rsa_key: Loading private key\n[DEBUG   ] salt.crypt._get_key_with_evict: Loading private key\n[DEBUG   ] Loaded minion key: /etc/salt/pki/minion/minion.pem\n[DEBUG   ] salt.crypt.get_rsa_pub_key: Loading public key\n[DEBUG   ] Closing AsyncZeroMQReqChannel instance\n[DEBUG   ] Connecting the Minion to the Master publish port, using the URI: tcp://192.168.2.110:4505\n[DEBUG   ] salt.crypt.get_rsa_key: Loading private key\n[DEBUG   ] Loaded minion key: /etc/salt/pki/minion/minion.pem\n[DEBUG   ] Determining pillar cache\n[DEBUG   ] Initializing new AsyncZeroMQReqChannel for ('/etc/salt/pki/minion', 'ubuntuAsus', 'tcp://192.168.2.110:4506', 'aes')\n[DEBUG   ] Initializing new AsyncAuth for ('/etc/salt/pki/minion', 'ubuntuAsus', 'tcp://192.168.2.110:4506')\n[DEBUG   ] Connecting the Minion to the Master URI (for the return server): tcp://192.168.2.110:4506\n[DEBUG   ] Trying to connect to: tcp://192.168.2.110:4506\n[DEBUG   ] salt.crypt.get_rsa_key: Loading private key\n[DEBUG   ] Loaded minion key: /etc/salt/pki/minion/minion.pem\n[DEBUG   ] Closing AsyncZeroMQReqChannel instance\n[DEBUG   ] LazyLoaded jinja.render\n[DEBUG   ] LazyLoaded yaml.render\n[DEBUG   ] LazyLoaded platform.is_windows\n[DEBUG   ] LazyLoaded network.netstat\n[DEBUG   ] LazyLoaded direct_call.execute\n[DEBUG   ] LazyLoaded path.which\n[DEBUG   ] LazyLoaded cmd.run\n[INFO    ] Executing command 'netstat -tulpnea' in directory '/root'\n[DEBUG   ] stdout: Active Internet connections (servers and established)\nProto Recv-Q Send-Q Local Address           Foreign Address         State       User       Inode      PID/Program name    \ntcp        0      0 127.0.0.1:1338          0.0.0.0:*               LISTEN      0          39195      780/containerd      \ntcp        0      0 127.0.0.1:10248         0.0.0.0:*               LISTEN      0          41215      790/kubelet         \ntcp        0      0 0.0.0.0:25000           0.0.0.0:*               LISTEN      0          39187      1668/python3        \ntcp        0      0 127.0.0.1:10249         0.0.0.0:*               LISTEN      0          40430      791/kube-proxy      \ntcp        0      0 127.0.0.1:10251         0.0.0.0:*               LISTEN      0          39190      800/kube-scheduler  \ntcp        0      0 127.0.0.1:10252         0.0.0.0:*               LISTEN      0          37783      787/kube-controller \ntcp        0      0 127.0.0.1:2380          0.0.0.0:*               LISTEN      0          37379      788/etcd            \ntcp        0      0 127.0.0.1:10256         0.0.0.0:*               LISTEN      0          40428      791/kube-proxy  \n[DEBUG   ] Initializing new AsyncZeroMQReqChannel for ('/etc/salt/pki/minion', 'ubuntuAsus', 'tcp://192.168.2.110:4506', 'aes')\n[DEBUG   ] Initializing new AsyncAuth for ('/etc/salt/pki/minion', 'ubuntuAsus', 'tcp://192.168.2.110:4506')\n[DEBUG   ] Connecting the Minion to the Master URI (for the return server): tcp://192.168.2.110:4506\n[DEBUG   ] Trying to connect to: tcp://192.168.2.110:4506\n[DEBUG   ] Closing AsyncZeroMQReqChannel instance\n[DEBUG   ] LazyLoaded nested.output\n")))}c.isMDXComponent=!0},22244:(e,n,t)=>{t.d(n,{Z:()=>a});const a=t.p+"assets/images/photo-kt443t6d_64hdh43hfh6dgjdfhg4_d-153442ba8fddbf9d54490e9d1ac9f245.jpg"}}]);