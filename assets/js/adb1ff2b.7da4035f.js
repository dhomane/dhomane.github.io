"use strict";(self.webpackChunkmikes_dev_notebook=self.webpackChunkmikes_dev_notebook||[]).push([[36558],{3905:(e,t,a)=>{a.d(t,{Zo:()=>d,kt:()=>k});var n=a(67294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var l=n.createContext({}),c=function(e){var t=n.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},d=function(e){var t=c(e.components);return n.createElement(l.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},u=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,o=e.originalType,l=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),u=c(a),k=r,m=u["".concat(l,".").concat(k)]||u[k]||p[k]||o;return a?n.createElement(m,i(i({ref:t},d),{},{components:a})):n.createElement(m,i({ref:t},d))}));function k(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=a.length,i=new Array(o);i[0]=u;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:r,i[1]=s;for(var c=2;c<o;c++)i[c]=a[c];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}u.displayName="MDXCreateElement"},69405:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>p,frontMatter:()=>o,metadata:()=>s,toc:()=>c});var n=a(87462),r=(a(67294),a(3905));const o={sidebar_position:5030,slug:"2022-10-16",title:"Provision OSticket with Docker",authors:"mpolinowski",tags:["LINUX","Docker","osTicket"],description:"Use Docker, Docker-Compose and Nomad to provide an OSTicket Service"},i=void 0,s={unversionedId:"DevOps/Provisioning/2022-10-16--os-ticket-docker/index",id:"DevOps/Provisioning/2022-10-16--os-ticket-docker/index",title:"Provision OSticket with Docker",description:"Use Docker, Docker-Compose and Nomad to provide an OSTicket Service",source:"@site/docs/DevOps/Provisioning/2022-10-16--os-ticket-docker/index.md",sourceDirName:"DevOps/Provisioning/2022-10-16--os-ticket-docker",slug:"/DevOps/Provisioning/2022-10-16--os-ticket-docker/2022-10-16",permalink:"/docs/DevOps/Provisioning/2022-10-16--os-ticket-docker/2022-10-16",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/DevOps/Provisioning/2022-10-16--os-ticket-docker/index.md",tags:[{label:"LINUX",permalink:"/docs/tags/linux"},{label:"Docker",permalink:"/docs/tags/docker"},{label:"osTicket",permalink:"/docs/tags/os-ticket"}],version:"current",sidebarPosition:5030,frontMatter:{sidebar_position:5030,slug:"2022-10-16",title:"Provision OSticket with Docker",authors:"mpolinowski",tags:["LINUX","Docker","osTicket"],description:"Use Docker, Docker-Compose and Nomad to provide an OSTicket Service"},sidebar:"tutorialSidebar",previous:{title:"OSticket REST API Calls",permalink:"/docs/DevOps/Provisioning/2022-10-27--os-ticket-rest-api/2022-10-27"},next:{title:"Bind9 Server Configuration",permalink:"/docs/DevOps/Provisioning/2022-01-27--bind9-configuration/2022-01-27"}},l={},c=[{value:"Installation using Docker",id:"installation-using-docker",level:2},{value:"Customize",id:"customize",level:2},{value:"Adding Plugins",id:"adding-plugins",level:3},{value:"Language Packs",id:"language-packs",level:3},{value:"Docker-Compose",id:"docker-compose",level:2},{value:"Build a customized OSTicket Image",id:"build-a-customized-osticket-image",level:2},{value:"Backup &amp; Restore",id:"backup--restore",level:2},{value:"Restore from MySQL Dump",id:"restore-from-mysql-dump",level:3},{value:"Create a MySQL Dump",id:"create-a-mysql-dump",level:3}],d={toc:c};function p(e){let{components:t,...o}=e;return(0,r.kt)("wrapper",(0,n.Z)({},d,o,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Shenzhen, China",src:a(34595).Z,width:"1500",height:"567"})),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#installation-using-docker"},"Installation using Docker")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#customize"},"Customize"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#adding-plugins"},"Adding Plugins")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#language-packs"},"Language Packs")))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#docker-compose"},"Docker-Compose")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#build-a-customized-osticket-image"},"Build a customized OSTicket Image")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#backup--restore"},"Backup \\& Restore"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#restore-from-mysql-dump"},"Restore from MySQL Dump")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#create-a-mysql-dump"},"Create a MySQL Dump"))))),(0,r.kt)("h2",{id:"installation-using-docker"},"Installation using Docker"),(0,r.kt)("p",null,"Pull ",(0,r.kt)("a",{parentName:"p",href:"https://docs.osticket.com/en/latest/Getting%20Started/Installation.html"},"osTicket")," Image from ",(0,r.kt)("a",{parentName:"p",href:"https://hub.docker.com/r/osticket/osticket/"},"hub.docker.com"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"docker pull osticket/osticket:latest\n")),(0,r.kt)("p",null,"Make sure you have a MySQL container running that osTicket can use to store its data:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"docker pull mariadb:latest\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"docker run --name osticket_mysql -d -e MYSQL_ROOT_PASSWORD=secret \\\n-e MYSQL_USER=osticket -e MYSQL_PASSWORD=secret -e MYSQL_DATABASE=osticket mariadb:latest\n")),(0,r.kt)("p",null,"Now run this image and link the MySQL container:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"docker run --name osticket -d --link osticket_mysql:mysql -p 8080:80 osticket/osticket\n")),(0,r.kt)("p",null,"Wait for the setup process to finish - this will download the latest version of OSticket and might take a while:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"docker logs osticket\nCloning into '.'...\n")),(0,r.kt)("p",null,"Once installation is completed then browse to your osTicket staff control panel at ",(0,r.kt)("inlineCode",{parentName:"p"},"http://localhost:8080/scp"),". Login with default admin user & password:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"username: ",(0,r.kt)("inlineCode",{parentName:"li"},"ostadmin"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"password: ",(0,r.kt)("inlineCode",{parentName:"li"},"Admin1"))))),(0,r.kt)("h2",{id:"customize"},"Customize"),(0,r.kt)("h3",{id:"adding-plugins"},"Adding Plugins"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"docker exec -ti osticket /bin/bash\n")),(0,r.kt)("p",null,"All plugins can be found in the following directory. Use a volume mount to add community plugins:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"ls -la /var/www/src/public/include/plugins\ntotal 2908\ndrwxr-xr-x 14 www-data www-data    4096 Oct 17 09:07 .\ndrwxr-xr-x 12 www-data www-data    4096 Oct 17 09:06 ..\ndrwxr-xr-x  8 www-data www-data    4096 Oct 17 09:06 .git\n-rw-r--r--  1 www-data www-data     364 Oct 17 09:06 .gitignore\n-rw-r--r--  1 www-data www-data       0 Oct 17 09:06 .keep\n-rw-r--r--  1 www-data www-data   18026 Oct 17 09:06 LICENSE\n-rw-r--r--  1 www-data www-data    1023 Oct 17 09:06 README.md\ndrwxr-xr-x  3 www-data www-data    4096 Oct 17 09:06 audit\ndrwxr-xr-x  3 www-data www-data    4096 Oct 17 09:07 auth-2fa\ndrwxr-xr-x  3 www-data www-data    4096 Oct 17 09:07 auth-cas\ndrwxr-xr-x  3 www-data www-data    4096 Oct 17 09:07 auth-ldap\ndrwxr-xr-x  3 www-data www-data    4096 Oct 17 09:07 auth-oauth2\ndrwxr-xr-x  2 www-data www-data    4096 Oct 17 09:06 auth-passthru\ndrwxr-xr-x  2 www-data www-data    4096 Oct 17 09:06 auth-password-policy\n-rw-r--r--  1 www-data www-data     228 Oct 17 09:06 composer.json\n-rw-r--r--  1 www-data www-data   41176 Oct 17 09:07 composer.lock\n-rw-r--r--  1 www-data www-data 2808725 Oct 17 09:07 composer.phar\ndrwxr-xr-x  2 www-data www-data    4096 Oct 17 09:06 doc\ndrwxr-xr-x 15 www-data www-data    4096 Oct 17 09:07 lib\n-rw-r--r--  1 www-data www-data   24618 Oct 17 09:06 make.php\ndrwxr-xr-x  2 www-data www-data    4096 Oct 17 09:06 storage-fs\ndrwxr-xr-x  3 www-data www-data    4096 Oct 17 09:07 storage-s3\n-rw-r--r--  1 www-data www-data    1194 Oct 17 09:06 updates.pem\n")),(0,r.kt)("p",null,"Install them from Manage/Plugins:"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Provision OSticket with Docker",src:a(38181).Z,width:"950",height:"254"})),(0,r.kt)("h3",{id:"language-packs"},"Language Packs"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://osticket.com/download/"},"Download the language files")," and place them into:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"ls -la /var/www/src/public/include/i18n/\ntotal 44\ndrwxr-xr-x  4 www-data www-data  4096 Oct 17 10:14 .\ndrwxr-xr-x 12 www-data www-data  4096 Oct 17 10:14 ..\n-rw-r--r--  1 www-data www-data  1097 Oct 17 10:14 README.md\ndrwxr-xr-x  4 www-data www-data  4096 Oct 17 10:14 en_US\n-rw-r--r--  1 www-data www-data 20586 Oct 17 10:14 langs.php\ndrwxr-xr-x  3 www-data www-data  4096 Oct 17 10:14 vendor\n")),(0,r.kt)("p",null,"by binding them into your container:"),(0,r.kt)("p",null,(0,r.kt)("em",{parentName:"p"},"docker-compose.yml")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yml"},"volumes:\n    - type: bind\n      source: ./src/include/i18n/de.phar\n      target: /var/www/src/public/include/i18n/de.phar\n      read_only: true\n")),(0,r.kt)("p",null,"And select them from the Admin panel:"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Provision OSticket with Docker",src:a(4474).Z,width:"955",height:"417"})),(0,r.kt)("h2",{id:"docker-compose"},"Docker-Compose"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yml"},"version: '3.8'\nservices:\n\n  osticket-app:\n    image: osticket/osticket:latest\n    container_name: osticket\n    volumes:\n      - type: bind\n        source: ./src/include/i18n/de.phar\n        target: /var/www/src/public/include/i18n/de.phar\n        read_only: true\n    environment:\n      - CONTAINER_NAME=osticket\n      - MYSQL_USER=osticket\n      - MYSQL_HOST=osticket-db\n      - MYSQL_PASSWORD=secret\n      - MYSQL_DATABASE=osticket\n    ports:\n      - 8080:80\n    depends_on:\n      - osticket-db\n    networks:\n      - services\n    links:\n      - osticket-db\n    restart: unless-stopped\n\n  osticket-db:\n    image: mariadb:latest\n    container_name: osticket-db\n    volumes:\n      - /opt/osticket/db:/var/lib/mysql\n    environment:\n      - MYSQL_ROOT_PASSWORD=secret\n      - MYSQL_USER=osticket\n      - MYSQL_PASSWORD=secret\n      - MYSQL_DATABASE=osticket\n      - CONTAINER_NAME=osticket-db\n    networks:\n      - services\n    restart: unless-stopped\n\nnetworks:\n  services:\n    external: false\n")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},(0,r.kt)("strong",{parentName:"p"},"Note"),": The volume mount ",(0,r.kt)("inlineCode",{parentName:"p"},"/opt/osticket/db:/var/lib/mysql")," makes sure that all data written to MariaDB will be persisted. Make sure the host path ",(0,r.kt)("inlineCode",{parentName:"p"},"/opt/osticket/db")," exists and can be written to ~ or just change it to a dir that fulfills the requirement.")),(0,r.kt)("h2",{id:"build-a-customized-osticket-image"},"Build a customized OSTicket Image"),(0,r.kt)("p",null,"The docker compose file contains a volume mount for the language file I added:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yml"},"volumes:\n  - type: bind\n    source: ./src/include/i18n/de.phar\n    target: /var/www/src/public/include/i18n/de.phar\n    read_only: true\n")),(0,r.kt)("p",null,'Actually, there are a lot more files that I need to mount - logos, styles and additional scripts. It makes sense for me to simply "bake" all of them into a customized image of OSTicket using the ',(0,r.kt)("inlineCode",{parentName:"p"},"docker build")," command."),(0,r.kt)("p",null,"Here I ran into a few issues with the official docker image and found this fork of it that is based on a ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/devinsolutions/docker-osticket/blob/master/Dockerfile"},"PHP8 Alpine Linux image")," that is much more suitable for my task. You can build this image of OSTicket with:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"docker build -t my/osticket .\n")),(0,r.kt)("p",null,"Now we can use this image to add our customizations with a ",(0,r.kt)("strong",{parentName:"p"},"Dockerfile")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-dockerfile"},"FROM instar/osticket:latest\n\n# add all your files here, e.g.\nCOPY ./src/include/staff/header.inc.php /var/www/html/include/staff/header.inc.php\n#...\n")),(0,r.kt)("p",null,"Now build this image and tag it according to your Docker Registry setup:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"docker build -t my.gitlab.com:12345/server_management/my-osticket:latest .\n")),(0,r.kt)("p",null,"When you pull this image you can still use the ",(0,r.kt)("inlineCode",{parentName:"p"},"docker-compose.yml")," file from above - but you no longer have to provide the volumen mounts and source files. Everything is baked in!"),(0,r.kt)("h2",{id:"backup--restore"},"Backup & Restore"),(0,r.kt)("p",null,"The database image uses a volume mount to persist all written data ",(0,r.kt)("inlineCode",{parentName:"p"},"/opt/osticket/db:/var/lib/mysql"),". You can use it to drop in an SQL dump to ",(0,r.kt)("inlineCode",{parentName:"p"},"/opt/osticket/db")," enter the MariaDB image:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"docker exec -ti osticket-db /bin/bash\n")),(0,r.kt)("p",null,"And restore your old OSTicket state:"),(0,r.kt)("h3",{id:"restore-from-mysql-dump"},"Restore from MySQL Dump"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"mysql -uosticket -p osticket < Ticketsystem_2022-10-20.sql\n")),(0,r.kt)("h3",{id:"create-a-mysql-dump"},"Create a MySQL Dump"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"mysqldump -uosticket -p osticket > backup-file.sql\nEnter password: secret\n")))}p.isMDXComponent=!0},38181:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/OSTicket_Docker_01-356106685fea9654593cbdf47b9676c9.png"},4474:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/OSTicket_Docker_02-b60bc54f63129d8be062ea36edb999e2.png"},34595:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/photo-kt443t6d_64hdh43hfh6dgjdfhg4_d-983e9af3d84f5fb9ebad02646e63767d.jpg"}}]);