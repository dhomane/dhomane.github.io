"use strict";(self.webpackChunkmikes_dev_notebook=self.webpackChunkmikes_dev_notebook||[]).push([[34515],{3905:(t,e,a)=>{a.d(e,{Zo:()=>h,kt:()=>d});var o=a(67294);function n(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}function r(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,o)}return a}function i(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?r(Object(a),!0).forEach((function(e){n(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}function l(t,e){if(null==t)return{};var a,o,n=function(t,e){if(null==t)return{};var a,o,n={},r=Object.keys(t);for(o=0;o<r.length;o++)a=r[o],e.indexOf(a)>=0||(n[a]=t[a]);return n}(t,e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);for(o=0;o<r.length;o++)a=r[o],e.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(t,a)&&(n[a]=t[a])}return n}var s=o.createContext({}),m=function(t){var e=o.useContext(s),a=e;return t&&(a="function"==typeof t?t(e):i(i({},e),t)),a},h=function(t){var e=m(t.components);return o.createElement(s.Provider,{value:e},t.children)},p={inlineCode:"code",wrapper:function(t){var e=t.children;return o.createElement(o.Fragment,{},e)}},c=o.forwardRef((function(t,e){var a=t.components,n=t.mdxType,r=t.originalType,s=t.parentName,h=l(t,["components","mdxType","originalType","parentName"]),c=m(a),d=n,k=c["".concat(s,".").concat(d)]||c[d]||p[d]||r;return a?o.createElement(k,i(i({ref:e},h),{},{components:a})):o.createElement(k,i({ref:e},h))}));function d(t,e){var a=arguments,n=e&&e.mdxType;if("string"==typeof t||n){var r=a.length,i=new Array(r);i[0]=c;var l={};for(var s in e)hasOwnProperty.call(e,s)&&(l[s]=e[s]);l.originalType=t,l.mdxType="string"==typeof t?t:n,i[1]=l;for(var m=2;m<r;m++)i[m]=a[m];return o.createElement.apply(null,i)}return o.createElement.apply(null,a)}c.displayName="MDXCreateElement"},39721:(t,e,a)=>{a.r(e),a.d(e,{assets:()=>s,contentTitle:()=>i,default:()=>p,frontMatter:()=>r,metadata:()=>l,toc:()=>m});var o=a(87462),n=(a(67294),a(3905));const r={sidebar_position:9030,slug:"2019-08-10",title:"MQTT Networks with Athom Homey",authors:"mpolinowski",tags:["MQTT","Smarthome","IoT"]},i=void 0,l={unversionedId:"IoT-and-Machine-Learning/MQTT/2019-08-10--mqtt-athom-homey/index",id:"IoT-and-Machine-Learning/MQTT/2019-08-10--mqtt-athom-homey/index",title:"MQTT Networks with Athom Homey",description:"Central, Hong Kong",source:"@site/docs/IoT-and-Machine-Learning/MQTT/2019-08-10--mqtt-athom-homey/index.mdx",sourceDirName:"IoT-and-Machine-Learning/MQTT/2019-08-10--mqtt-athom-homey",slug:"/IoT-and-Machine-Learning/MQTT/2019-08-10--mqtt-athom-homey/2019-08-10",permalink:"/docs/IoT-and-Machine-Learning/MQTT/2019-08-10--mqtt-athom-homey/2019-08-10",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/IoT-and-Machine-Learning/MQTT/2019-08-10--mqtt-athom-homey/index.mdx",tags:[{label:"MQTT",permalink:"/docs/tags/mqtt"},{label:"Smarthome",permalink:"/docs/tags/smarthome"},{label:"IoT",permalink:"/docs/tags/io-t"}],version:"current",sidebarPosition:9030,frontMatter:{sidebar_position:9030,slug:"2019-08-10",title:"MQTT Networks with Athom Homey",authors:"mpolinowski",tags:["MQTT","Smarthome","IoT"]},sidebar:"tutorialSidebar",previous:{title:"MQTT Networks with Home Assistant",permalink:"/docs/IoT-and-Machine-Learning/MQTT/2019-08-11--mqtt-home-assistant/2019-08-11"},next:{title:"MQTT Networks with homee",permalink:"/docs/IoT-and-Machine-Learning/MQTT/2019-08-09--mqtt-homee/2019-08-09"}},s={},m=[{value:"Adding the Homey MQTT Client",id:"adding-the-homey-mqtt-client",level:2},{value:"Sending a MQTT Command to your Camera",id:"sending-a-mqtt-command-to-your-camera",level:2}],h={toc:m};function p(t){let{components:e,...r}=t;return(0,n.kt)("wrapper",(0,o.Z)({},h,r,{components:e,mdxType:"MDXLayout"}),(0,n.kt)("p",null,(0,n.kt)("img",{alt:"Central, Hong Kong",src:a(28812).Z,width:"1500",height:"767"})),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"#adding-the-homey-mqtt-client"},"Adding the Homey MQTT Client")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"#sending-a-mqtt-command-to-your-camera"},"Sending a MQTT Command to your Camera"))),(0,n.kt)("p",null,"In this tutorial we want to connect an INSTAR Full HD camera through it's MQTT Interface with the ",(0,n.kt)("a",{parentName:"p",href:"https://www.athom.com/en/"},"Athom Homey Smarthome"),"."),(0,n.kt)("h2",{id:"adding-the-homey-mqtt-client"},"Adding the Homey MQTT Client"),(0,n.kt)("p",null,"Homey is a modular - that means that it is only set up with a limited amount of functionality out of the box. You can use the Homey App Store to load all kinds of kinds apps onto your gateway to personalize it's functionality. For the following we are going to need an MQTT client to be able to connect to the MQTT server on our camera."),(0,n.kt)("hr",null),(0,n.kt)("p",null,(0,n.kt)("img",{alt:"INSTAR MQTT Broker and Athom Homey",src:a(5285).Z,width:"1500",height:"667"})),(0,n.kt)("hr",null),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Start by launching your Homey App for ",(0,n.kt)("a",{parentName:"p",href:"https://apps.apple.com/us/app/homey/id1435800024"},"iOS")," or ",(0,n.kt)("a",{parentName:"p",href:"https://play.google.com/store/apps/details?id=app.homey&hl=en_US"},"Android")," and switch to the ",(0,n.kt)("strong",{parentName:"p"},"More")," App.")),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Open the Apps category.")),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"And click on the ",(0,n.kt)("strong",{parentName:"p"},"+")," icon in the top right to add a new app."))),(0,n.kt)("hr",null),(0,n.kt)("p",null,(0,n.kt)("img",{alt:"INSTAR MQTT Broker and Athom Homey",src:a(41693).Z,width:"1500",height:"667"})),(0,n.kt)("hr",null),(0,n.kt)("ol",{start:4},(0,n.kt)("li",{parentName:"ol"},"Type ",(0,n.kt)("inlineCode",{parentName:"li"},"mqtt")," into the search field and select the ",(0,n.kt)("strong",{parentName:"li"},"MQTT Client"),". I am also installing the MQTT Hub - ",(0,n.kt)("em",{parentName:"li"},"this is optional"),". The Hub App publishes Homey state variables through MQTT which comes in handy if you also use another smarthome solution that you want to interconnect with your Homey.")),(0,n.kt)("ol",{start:5},(0,n.kt)("li",{parentName:"ol"},"Once installed, click on the ",(0,n.kt)("strong",{parentName:"li"},"MQTT Client")," inside the Apps category.")),(0,n.kt)("ol",{start:6},(0,n.kt)("li",{parentName:"ol"},"Click on ",(0,n.kt)("strong",{parentName:"li"},"Configure App")," to connect the client to the INSTAR MQTT Server.")),(0,n.kt)("hr",null),(0,n.kt)("p",null,(0,n.kt)("img",{alt:"INSTAR MQTT Broker and Athom Homey",src:a(91538).Z,width:"1500",height:"667"})),(0,n.kt)("hr",null),(0,n.kt)("ol",{start:7},(0,n.kt)("li",{parentName:"ol"},"Start by entering the IP address of your camera (that is running your MQTT broker) - e.g. ",(0,n.kt)("inlineCode",{parentName:"li"},"192.168.2.116"),". We are going to use the Port ",(0,n.kt)("inlineCode",{parentName:"li"},"1883")," that allows us to connect to the MQTT broker without the SSL encryption (an encrypted connection can be established via the port ",(0,n.kt)("inlineCode",{parentName:"li"},"8883")," but requires a custom SSL certificate which I could not find out how to upload). The ",(0,n.kt)("strong",{parentName:"li"},"username")," and ",(0,n.kt)("strong",{parentName:"li"},"password")," for the MQTT broker is the one you set in the MQTT Menu.")),(0,n.kt)("ol",{start:8},(0,n.kt)("li",{parentName:"ol"},"If you installed the MQTT Hub earlier - ",(0,n.kt)("em",{parentName:"li"},"which is optional")," - enter it and click on ",(0,n.kt)("strong",{parentName:"li"},"Configure app"),".")),(0,n.kt)("ol",{start:9},(0,n.kt)("li",{parentName:"ol"},"Here you can set which information Homey should publish to our MQTT broker for use with other smarthome components.")),(0,n.kt)("h2",{id:"sending-a-mqtt-command-to-your-camera"},"Sending a MQTT Command to your Camera"),(0,n.kt)("hr",null),(0,n.kt)("p",null,(0,n.kt)("img",{alt:"INSTAR MQTT Broker and Athom Homey",src:a(24526).Z,width:"1500",height:"667"})),(0,n.kt)("hr",null),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},"Now switch to the ",(0,n.kt)("strong",{parentName:"li"},"Devices")," tab and check if you are able to add virtual devices. If you can't find them, the are still hidden as ",(0,n.kt)("em",{parentName:"li"},"experimental features"),".")),(0,n.kt)("ol",{start:2},(0,n.kt)("li",{parentName:"ol"},"Switch to the ",(0,n.kt)("strong",{parentName:"li"},"More")," tab and enter the ",(0,n.kt)("strong",{parentName:"li"},"Settings")," menu. Click on ",(0,n.kt)("strong",{parentName:"li"},"Experiments"),".")),(0,n.kt)("ol",{start:3},(0,n.kt)("li",{parentName:"ol"},"Activate ",(0,n.kt)("strong",{parentName:"li"},"Virtual Devices"),".")),(0,n.kt)("hr",null),(0,n.kt)("p",null,(0,n.kt)("img",{alt:"INSTAR MQTT Broker and Athom Homey",src:a(69085).Z,width:"1500",height:"667"})),(0,n.kt)("hr",null),(0,n.kt)("ol",{start:4},(0,n.kt)("li",{parentName:"ol"},"Back to ",(0,n.kt)("strong",{parentName:"li"},"Devices")," you should now be able to add a ",(0,n.kt)("strong",{parentName:"li"},"Virtual Button"),".")),(0,n.kt)("ol",{start:5},(0,n.kt)("li",{parentName:"ol"},"Click on ",(0,n.kt)("strong",{parentName:"li"},"Install")," to add the button to your devices.")),(0,n.kt)("ol",{start:6},(0,n.kt)("li",{parentName:"ol"},"Click ",(0,n.kt)("strong",{parentName:"li"},"Next")," to finish the installation.")),(0,n.kt)("hr",null),(0,n.kt)("p",null,(0,n.kt)("img",{alt:"INSTAR MQTT Broker and Athom Homey",src:a(6157).Z,width:"1500",height:"667"})),(0,n.kt)("hr",null),(0,n.kt)("ol",{start:7},(0,n.kt)("li",{parentName:"ol"},"You can ",(0,n.kt)("em",{parentName:"li"},"click and hold")," the virtual button to rename it.")),(0,n.kt)("ol",{start:8},(0,n.kt)("li",{parentName:"ol"},"Click on the cog wheel icon to enter the settings menu.")),(0,n.kt)("ol",{start:9},(0,n.kt)("li",{parentName:"ol"},"Add a name for your virtual button and add it to a zone.")),(0,n.kt)("hr",null),(0,n.kt)("p",null,(0,n.kt)("img",{alt:"INSTAR MQTT Broker and Athom Homey",src:a(65502).Z,width:"1500",height:"667"})),(0,n.kt)("hr",null),(0,n.kt)("ol",{start:10},(0,n.kt)("li",{parentName:"ol"},"Now we need to add some logic to made this button work. This can be done in the ",(0,n.kt)("strong",{parentName:"li"},"Flows")," tab.")),(0,n.kt)("ol",{start:11},(0,n.kt)("li",{parentName:"ol"},"Click on the ",(0,n.kt)("strong",{parentName:"li"},"+")," icon in the top right to add a new flow.")),(0,n.kt)("ol",{start:12},(0,n.kt)("li",{parentName:"ol"},"In the ",(0,n.kt)("strong",{parentName:"li"},"Create Flow")," menu click on ",(0,n.kt)("strong",{parentName:"li"},"Add card")," in the ",(0,n.kt)("em",{parentName:"li"},"When condition")," to assign an event that should trigger your flow.")),(0,n.kt)("hr",null),(0,n.kt)("p",null,(0,n.kt)("img",{alt:"INSTAR MQTT Broker and Athom Homey",src:a(34489).Z,width:"1500",height:"667"})),(0,n.kt)("hr",null),(0,n.kt)("ol",{start:13},(0,n.kt)("li",{parentName:"ol"},"Search for your virtual button under ",(0,n.kt)("strong",{parentName:"li"},"Devices")," and select it.")),(0,n.kt)("ol",{start:14},(0,n.kt)("li",{parentName:"ol"},"The button only has this one trigger - ",(0,n.kt)("em",{parentName:"li"},"When button has bee pressed"),". Select it and confirm.")),(0,n.kt)("ol",{start:15},(0,n.kt)("li",{parentName:"ol"},"Now swipe up the ",(0,n.kt)("strong",{parentName:"li"},"Then")," section of our flow to define what Homey should do when the flow was triggered.")),(0,n.kt)("hr",null),(0,n.kt)("p",null,(0,n.kt)("img",{alt:"INSTAR MQTT Broker and Athom Homey",src:a(53106).Z,width:"1500",height:"667"})),(0,n.kt)("hr",null),(0,n.kt)("ol",{start:16},(0,n.kt)("li",{parentName:"ol"},"Now click on ",(0,n.kt)("strong",{parentName:"li"},"Add card")," to add the ",(0,n.kt)("strong",{parentName:"li"},"Then")," condition for our flow.")),(0,n.kt)("ol",{start:17},(0,n.kt)("li",{parentName:"ol"},"Scroll down to the ",(0,n.kt)("strong",{parentName:"li"},"Apps")," section and select the ",(0,n.kt)("strong",{parentName:"li"},"MQTT Client"),".")),(0,n.kt)("ol",{start:18},(0,n.kt)("li",{parentName:"ol"},"And choose to ",(0,n.kt)("strong",{parentName:"li"},"Publish a message")," to the INSTAR MQTT server.")),(0,n.kt)("hr",null),(0,n.kt)("p",null,(0,n.kt)("img",{alt:"INSTAR MQTT Broker and Athom Homey",src:a(73454).Z,width:"1500",height:"667"})),(0,n.kt)("hr",null),(0,n.kt)("ol",{start:19},(0,n.kt)("li",{parentName:"ol"},"Now you can select a MQTT Topic from the INSTAR MQTT API that you want to update every time the button is pressed. Here I choose ",(0,n.kt)("inlineCode",{parentName:"li"},"alarm/pushalarm")," with a value of ",(0,n.kt)("inlineCode",{parentName:"li"},"{'val':'1'}")," to trigger an alarm on my camera. Note that if you have more than 1 camera connected to the MQTT server, you either have to add the MAC address in front of the MQTT topic to address a specific camera. Or add ",(0,n.kt)("inlineCode",{parentName:"li"},"all")," - ",(0,n.kt)("inlineCode",{parentName:"li"},"all/alarm/pushalarm")," - to address all connected cameras. By adding prefix ",(0,n.kt)("inlineCode",{parentName:"li"},"local"),", you only address the camera that is running the MQTT broker.")),(0,n.kt)("ol",{start:20},(0,n.kt)("li",{parentName:"ol"},"After you confirmed your edit click ",(0,n.kt)("strong",{parentName:"li"},"Test")," to verify that everything is working - your cameras System Log should show an ",(0,n.kt)("strong",{parentName:"li"},"Audio Alarm")," (Note that the Audio Alarm has a ",(0,n.kt)("strong",{parentName:"li"},"cool-down of 60s")," - so even if you hit the virtual button serveral times, you only get 1 alarm per minute). Now you can click on save to exit the setup window.")),(0,n.kt)("ol",{start:21},(0,n.kt)("li",{parentName:"ol"},"You now have a working button in the ",(0,n.kt)("strong",{parentName:"li"},"Devices")," window that can trigger an alarm on your camera. Try to add another button with the MQTT topic ",(0,n.kt)("inlineCode",{parentName:"li"},"features/ptz/preset")," and a value of ",(0,n.kt)("inlineCode",{parentName:"li"},"{'val':'0'}")," - ",(0,n.kt)("inlineCode",{parentName:"li"},"{'val':'7'}")," to have your camera pan&tilt between its preset positions.")))}p.isMDXComponent=!0},5285:(t,e,a)=>{a.d(e,{Z:()=>o});const o=a.p+"assets/images/INSTAR_MQTT_with_Athom_Homey_01-a41f12c085cf9b9d4aaae0f4c7dc9806.png"},41693:(t,e,a)=>{a.d(e,{Z:()=>o});const o=a.p+"assets/images/INSTAR_MQTT_with_Athom_Homey_02-8b1f79544a3422cd7fb7598b58d38628.png"},91538:(t,e,a)=>{a.d(e,{Z:()=>o});const o=a.p+"assets/images/INSTAR_MQTT_with_Athom_Homey_03-4b790504ad398c58f339fbaa9d02f39c.png"},24526:(t,e,a)=>{a.d(e,{Z:()=>o});const o=a.p+"assets/images/INSTAR_MQTT_with_Athom_Homey_04-ef7b775a6fc517651fb8e2f34bfe31f2.png"},69085:(t,e,a)=>{a.d(e,{Z:()=>o});const o=a.p+"assets/images/INSTAR_MQTT_with_Athom_Homey_05-9da1b4d505f57b73b4b4af6fa9e474ea.png"},6157:(t,e,a)=>{a.d(e,{Z:()=>o});const o=a.p+"assets/images/INSTAR_MQTT_with_Athom_Homey_06-22bc2026f08d59171063c2871fd35dab.png"},65502:(t,e,a)=>{a.d(e,{Z:()=>o});const o=a.p+"assets/images/INSTAR_MQTT_with_Athom_Homey_07-69034be79f6f184d1aa2edc609ff6661.png"},34489:(t,e,a)=>{a.d(e,{Z:()=>o});const o=a.p+"assets/images/INSTAR_MQTT_with_Athom_Homey_08-fd7b16440ad608d4c086c43d09c5b19b.png"},53106:(t,e,a)=>{a.d(e,{Z:()=>o});const o=a.p+"assets/images/INSTAR_MQTT_with_Athom_Homey_09-4fdb129dd20261877a16acc257ab4f7e.png"},73454:(t,e,a)=>{a.d(e,{Z:()=>o});const o=a.p+"assets/images/INSTAR_MQTT_with_Athom_Homey_10-80bb315c83d387a2da515009ff2e7c21.png"},28812:(t,e,a)=>{a.d(e,{Z:()=>o});const o=a.p+"assets/images/photo-kt456d_645dhfh6dgjkhg4_d-8b5c60bbcc2db25972d20542ef91688c.jpg"}}]);