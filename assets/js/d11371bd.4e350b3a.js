"use strict";(self.webpackChunkmikes_dev_notebook=self.webpackChunkmikes_dev_notebook||[]).push([[67629],{3905:(e,t,a)=>{a.d(t,{Zo:()=>c,kt:()=>m});var n=a(67294);function l(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){l(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,n,l=function(e,t){if(null==e)return{};var a,n,l={},r=Object.keys(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||(l[a]=e[a]);return l}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(l[a]=e[a])}return l}var p=n.createContext({}),o=function(e){var t=n.useContext(p),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},c=function(e){var t=o(e.components);return n.createElement(p.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},d=n.forwardRef((function(e,t){var a=e.components,l=e.mdxType,r=e.originalType,p=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),d=o(a),m=l,k=d["".concat(p,".").concat(m)]||d[m]||u[m]||r;return a?n.createElement(k,i(i({ref:t},c),{},{components:a})):n.createElement(k,i({ref:t},c))}));function m(e,t){var a=arguments,l=t&&t.mdxType;if("string"==typeof e||l){var r=a.length,i=new Array(r);i[0]=d;var s={};for(var p in t)hasOwnProperty.call(t,p)&&(s[p]=t[p]);s.originalType=e,s.mdxType="string"==typeof e?e:l,i[1]=s;for(var o=2;o<r;o++)i[o]=a[o];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}d.displayName="MDXCreateElement"},19298:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>p,contentTitle:()=>i,default:()=>u,frontMatter:()=>r,metadata:()=>s,toc:()=>o});var n=a(87462),l=(a(67294),a(3905));const r={sidebar_position:9060,slug:"2016-08-11",title:"Node Express Static",authors:"mpolinowski",tags:["Javascript","Node","Express"]},i=void 0,s={unversionedId:"Development/Javascript/2016-08-11--node-express-static-wiki/index",id:"Development/Javascript/2016-08-11--node-express-static-wiki/index",title:"Node Express Static",description:"Siem Reap, Cambodia",source:"@site/docs/Development/Javascript/2016-08-11--node-express-static-wiki/index.mdx",sourceDirName:"Development/Javascript/2016-08-11--node-express-static-wiki",slug:"/Development/Javascript/2016-08-11--node-express-static-wiki/2016-08-11",permalink:"/docs/Development/Javascript/2016-08-11--node-express-static-wiki/2016-08-11",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/Development/Javascript/2016-08-11--node-express-static-wiki/index.mdx",tags:[{label:"Javascript",permalink:"/docs/tags/javascript"},{label:"Node",permalink:"/docs/tags/node"},{label:"Express",permalink:"/docs/tags/express"}],version:"current",sidebarPosition:9060,frontMatter:{sidebar_position:9060,slug:"2016-08-11",title:"Node Express Static",authors:"mpolinowski",tags:["Javascript","Node","Express"]},sidebar:"tutorialSidebar",previous:{title:"Random Password Generator",permalink:"/docs/Development/Javascript/2017-07-04--random-password-generator/2017-07-04"},next:{title:"Node/Express with MongoDB",permalink:"/docs/Development/Javascript/2016-06-01--node-express-mongodb/2016-06-01"}},p={},o=[{value:"Node/Express Wiki/Knowledgebase",id:"nodeexpress-wikiknowledgebase",level:2},{value:"1 Install Node.js and Express.js to develop our Web Application",id:"1-install-nodejs-and-expressjs-to-develop-our-web-application",level:3},{value:"2 Preparing the Site Structure",id:"2-preparing-the-site-structure",level:3},{value:"3 Install and Configure Gulp.js",id:"3-install-and-configure-gulpjs",level:3},{value:"4 Install NGINX on a CentOS 7 web server",id:"4-install-nginx-on-a-centos-7-web-server",level:3},{value:"5 Install Node.js on a CentOS 7 web server",id:"5-install-nodejs-on-a-centos-7-web-server",level:3},{value:"6 Clone Repo from Git",id:"6-clone-repo-from-git",level:3},{value:"7 Run the app as a service (PM2)",id:"7-run-the-app-as-a-service-pm2",level:3},{value:"8 Install Java",id:"8-install-java",level:3},{value:"Public Signing Key",id:"public-signing-key",level:4},{value:"Install Java 8",id:"install-java-8",level:4},{value:"9 Install Elasticsearch",id:"9-install-elasticsearch",level:3},{value:"Public Signing Key",id:"public-signing-key-1",level:4},{value:"Install Elasticsearch",id:"install-elasticsearch",level:4},{value:"Access-Control-Allow-Origin",id:"access-control-allow-origin",level:4},{value:"Set-up Elasticsearch Service",id:"set-up-elasticsearch-service",level:4},{value:"10 Install Kibana",id:"10-install-kibana",level:3},{value:"Create and edit a new yum repository file for Kibana",id:"create-and-edit-a-new-yum-repository-file-for-kibana",level:4},{value:"Install Kibana with this command:",id:"install-kibana-with-this-command",level:4},{value:"Set Elasticsearch Connection URL",id:"set-elasticsearch-connection-url",level:4},{value:"Install Kibana Service",id:"install-kibana-service",level:4},{value:"Secure Kibana with NGINX",id:"secure-kibana-with-nginx",level:4},{value:"Securing Kibana in a Nginx server block",id:"securing-kibana-in-a-nginx-server-block",level:4},{value:"Install Sense",id:"install-sense",level:4}],c={toc:o};function u(e){let{components:t,...r}=e;return(0,l.kt)("wrapper",(0,n.Z)({},c,r,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("p",null,(0,l.kt)("img",{alt:"Siem Reap, Cambodia",src:a(4199).Z,width:"1500",height:"659"})),(0,l.kt)("h2",{id:"nodeexpress-wikiknowledgebase"},"Node/Express Wiki/Knowledgebase"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"Bootstrap/Accelerated Mobile Pages")),(0,l.kt)("p",null,"This code is part of a training in web development with ",(0,l.kt)("strong",{parentName:"p"},"Node.js")," and ",(0,l.kt)("strong",{parentName:"p"},"Express /Generator"),". Goal of this course is to quickly set up a node/express environment to serve static HTML/CSS/JS content."),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#nodeexpress-wikiknowledgebase"},"Node/Express Wiki/Knowledgebase"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#1-install-nodejs-and-expressjs-to-develop-our-web-application"},"1 Install Node.js and Express.js to develop our Web Application")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#2-preparing-the-site-structure"},"2 Preparing the Site Structure")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#3-install-and-configure-gulpjs"},"3 Install and Configure Gulp.js")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#4-install-nginx-on-a-centos-7-web-server"},"4 Install NGINX on a CentOS 7 web server")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#5-install-nodejs-on-a-centos-7-web-server"},"5 Install Node.js on a CentOS 7 web server")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#6-clone-repo-from-git"},"6 Clone Repo from Git")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#7-run-the-app-as-a-service-pm2"},"7 Run the app as a service (PM2)")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#8-install-java"},"8 Install Java"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#public-signing-key"},"Public Signing Key")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#install-java-8"},"Install Java 8")))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#9-install-elasticsearch"},"9 Install Elasticsearch"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#public-signing-key-1"},"Public Signing Key")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#install-elasticsearch"},"Install Elasticsearch")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#access-control-allow-origin"},"Access-Control-Allow-Origin")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#set-up-elasticsearch-service"},"Set-up Elasticsearch Service")))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#10-install-kibana"},"10 Install Kibana"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#create-and-edit-a-new-yum-repository-file-for-kibana"},"Create and edit a new yum repository file for Kibana")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#install-kibana-with-this-command"},"Install Kibana with this command:")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#set-elasticsearch-connection-url"},"Set Elasticsearch Connection URL")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#install-kibana-service"},"Install Kibana Service")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#secure-kibana-with-nginx"},"Secure Kibana with NGINX")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#securing-kibana-in-a-nginx-server-block"},"Securing Kibana in a Nginx server block")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#install-sense"},"Install Sense"))))))),(0,l.kt)("p",null,(0,l.kt)("img",{alt:"Express.js Website Tutorial",src:a(75113).Z,width:"1000",height:"738"})),(0,l.kt)("h3",{id:"1-install-nodejs-and-expressjs-to-develop-our-web-application"},"1 Install Node.js and Express.js to develop our Web Application"),(0,l.kt)("hr",null),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Install ",(0,l.kt)("a",{parentName:"li",href:"https://nodejs.org/en/download/"},"Node.js"),"."),(0,l.kt)("li",{parentName:"ul"},"Install express-generator globally to set up our node/express scaffolding: ",(0,l.kt)("em",{parentName:"li"},"npm install -g express-generator")),(0,l.kt)("li",{parentName:"ul"},"Apply the generator with the EJS templating engine (",(0,l.kt)("em",{parentName:"li"},"-e"),") and give your app an name (",(0,l.kt)("em",{parentName:"li"},"e.g. express-static"),"): ",(0,l.kt)("em",{parentName:"li"},"express -e express-static")),(0,l.kt)("li",{parentName:"ul"},"Switch to the created express-static folder and install dependencies: ",(0,l.kt)("em",{parentName:"li"},"cd express-static && npm install")),(0,l.kt)("li",{parentName:"ul"},"Start the app with: DEBUG=my-application ./bin/www")),(0,l.kt)("h3",{id:"2-preparing-the-site-structure"},"2 Preparing the Site Structure"),(0,l.kt)("hr",null),(0,l.kt)("p",null,"The following folders and files will be created in the ",(0,l.kt)("strong",{parentName:"p"},"dev")," folder. Later ",(0,l.kt)("a",{parentName:"p",href:"#4-install-and-configure-gulpjs"},"Gulp.js")," will be used to create a distilled version ready for deployment in the ",(0,l.kt)("strong",{parentName:"p"},"build")," folder."),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Add ",(0,l.kt)("em",{parentName:"li"},"partials/content")," to the ",(0,l.kt)("em",{parentName:"li"},"views")," folder"),(0,l.kt)("li",{parentName:"ul"},"Add ",(0,l.kt)("em",{parentName:"li"},"partials/template")," to views and add ",(0,l.kt)("em",{parentName:"li"},"head.ejs"),", ",(0,l.kt)("em",{parentName:"li"},"header.ejs"),", ",(0,l.kt)("em",{parentName:"li"},"footer.ejs")," and ",(0,l.kt)("em",{parentName:"li"},"jsdefaults.ejs")),(0,l.kt)("li",{parentName:"ul"},"Copy content from the ",(0,l.kt)("em",{parentName:"li"},"head")," section of your web site (",(0,l.kt)("em",{parentName:"li"},"index.ejs"),") to ",(0,l.kt)("em",{parentName:"li"},"head.ejs")),(0,l.kt)("li",{parentName:"ul"},"Reference the ",(0,l.kt)("em",{parentName:"li"},"head.ejs")," file inside the ",(0,l.kt)("em",{parentName:"li"},"head")," section of index.ejs: ",(0,l.kt)("em",{parentName:"li"},"<% include partials/template/head.ejs %>")),(0,l.kt)("li",{parentName:"ul"},"Add ",(0,l.kt)("em",{parentName:"li"},(0,l.kt)("script",{src:"/javascrip/scrip.js"}))," to ",(0,l.kt)("em",{parentName:"li"},"jsdefaults.ejs")," and reference it in ",(0,l.kt)("em",{parentName:"li"},"index.ejs")," at the end of body: ",(0,l.kt)("em",{parentName:"li"},"<% include partials/template/jsdefaults.ejs %>")),(0,l.kt)("li",{parentName:"ul"},"Copy all JS script tags to ",(0,l.kt)("em",{parentName:"li"},"jsdefaults.ejs")),(0,l.kt)("li",{parentName:"ul"},"Copy content from the ",(0,l.kt)("em",{parentName:"li"},"footer")," section of your web site (",(0,l.kt)("em",{parentName:"li"},"index.ejs"),") to ",(0,l.kt)("em",{parentName:"li"},"footer.ejs")),(0,l.kt)("li",{parentName:"ul"},"Reference the ",(0,l.kt)("em",{parentName:"li"},"footer.ejs")," file inside the ",(0,l.kt)("em",{parentName:"li"},"footer")," section of index.ejs: ",(0,l.kt)("em",{parentName:"li"},"<% include partials/template/footer.ejs %>")),(0,l.kt)("li",{parentName:"ul"},"Repeat with other partials that you might want to reuse on other pages!"),(0,l.kt)("li",{parentName:"ul"},"Copy all your websites (EJS files) pages into the content folder")),(0,l.kt)("br",null),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"Now lets try to build this:")),(0,l.kt)("p",null,(0,l.kt)("img",{alt:"INSTAR Wiki Knowledgebase",src:a(75113).Z,width:"1000",height:"738"})),(0,l.kt)("h3",{id:"3-install-and-configure-gulpjs"},"3 Install and Configure Gulp.js"),(0,l.kt)("hr",null),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"Step One")," \u2014 Install ",(0,l.kt)("a",{parentName:"li",href:"https://github.com/gulpjs/gulp/blob/master/docs/getting-started.md"},"Gulp")," globally:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"npm install --global gulp-cli\n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"Step Two")," \u2014 Install ",(0,l.kt)("a",{parentName:"li",href:"https://github.com/gulpjs/gulp/tree/4.0"},"Gulp 4")," into your Project - cd to project directory and:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"npm install --save-dev gulpjs/gulp#4.0\n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"Step Three")," \u2014 Create a gulpfile.babel.js at the root of your project:")),(0,l.kt)("p",null,"Node already supports a lot of ES2015, to avoid compatibility problem we suggest to install Babel and rename your gulpfile.js as gulpfile.babel.js."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"npm install --save-dev babel-register babel-preset-es2015\n")),(0,l.kt)("p",null,"Then create a .babelrc file with the preset configuration."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"{\n  'presets': [ 'es2015' ]\n}\n")),(0,l.kt)("p",null,"Now install all Gulp dependencies that you want to use"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"npm install --save-dev gulp-babel gulp-uglify gulp-rename gulp-clean-css gulp-htmlclean gulp-newer gulp-imagemin del\n")),(0,l.kt)("p",null,"Now write the gulpfile.babel.js and import all gulp dependencies..."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-javascript"},"import gulp from 'gulp';\nimport babel from 'gulp-babel';\nimport uglify from 'gulp-uglify';\nimport rename from 'gulp-rename';\nimport cleanCSS from 'gulp-clean-css';\nimport cleanHTML from 'gulp-htmlclean';\nimport newer from 'gulp-newer';\nimport imagemin from 'gulp-imagemin';\nimport del from 'del';\n")),(0,l.kt)("p",null,"... and write your Gulp Tasks."),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"Step Four")," \u2014 Define your source and destination directories:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-javascript"},"const paths = {\n  views: {\n    src: 'dev/views/**/*.ejs',\n    dest: 'build/views/',\n  },\n  images: {\n    src: 'dev/public/images/**/*.{jpg,jpeg,png}',\n    dest: 'build/public/images/',\n  },\n  styles: {\n    src: 'dev/public/stylesheets/**/*.css',\n    dest: 'build/public/stylesheets/',\n  },\n  scripts: {\n    src: 'dev/public/javascripts/**/*.js',\n    dest: 'build/public/javascripts/',\n  },\n};\n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"Step Five")," \u2014 Add a Gulp Task ",(0,l.kt)("a",{parentName:"li",href:"https://www.npmjs.com/package/gulp-imagemin"},"using imagemin")," to compress your images:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-javascript"},"export function images() {\n  return gulp.src(paths.images.src)\n    .pipe(newer(paths.images.dest))\n    // Pass through newer files only\n    .pipe(imagemin())\n    .pipe(gulp.dest(paths.images.dest));\n}\n")),(0,l.kt)("p",null,"Run the task with:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"gulp images\n")),(0,l.kt)("p",null,"to compress all images in ./dev/public/images and save them in ./build/public/images."),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"Step Six")," \u2014 Add a Gulp Task to minify CSS, EJS/HTML and JS:")),(0,l.kt)("p",null,"Now we have to create minify jobs for each file type - (add more tasks if needed):"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-javascript"},"// Minify EJS files\nexport function views() {\n  return gulp.src(paths.views.src)\n    .pipe(newer(paths.views.dest))\n    // Pass through newer files only\n    .pipe(cleanHTML())\n    .pipe(gulp.dest(paths.views.dest));\n}\n\n// Minify CSS files\nexport function styles() {\n  return gulp.src(paths.styles.src)\n    .pipe(newer(paths.styles.dest))\n    // Pass through newer files only\n    .pipe(cleanCSS())\n    // Pass in options to the stream\n    .pipe(rename({\n      basename: 'main',\n      suffix: '.min',\n    }))\n    .pipe(gulp.dest(paths.styles.dest));\n}\n\n// Minify JS files\nexport function scripts() {\n  return gulp.src(paths.routes.src, { sourcemaps: true })\n    .pipe(newer(paths.routes.dest))\n    // Pass through newer files only\n    .pipe(babel())\n    .pipe(uglify())\n    .pipe(gulp.dest(paths.routes.dest));\n}\n\n// Minify routes\ngulp.task('routes', function() {\n  return gulp.src(routes.in)\n    .pipe(newer(routes.out))\n    .pipe(uglify())\n    .pipe(gulp.dest(routes.out))\n});\n")),(0,l.kt)("p",null,"All those tasks can be triggered individually - e.g.:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"gulp views\n")),(0,l.kt)("p",null,"But to make it more convenient, we will create a combined task - that will also watch for changes:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-javascript"},"export function watch() {\n  gulp.watch(paths.views.src, views);\n  gulp.watch(paths.images.src, images);\n}\n")),(0,l.kt)("p",null,"You can create a build task to create a fresh build:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-javascript"},"Const build = gulp.series(clean, gulp.parallel(views, images, styles, scripts));\nexport { build };\n")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"gulp build\n")),(0,l.kt)("p",null,"This task will grab all files from the dev folder, minify/compress them and save them in the build folder."),(0,l.kt)("h3",{id:"4-install-nginx-on-a-centos-7-web-server"},"4 Install NGINX on a CentOS 7 web server"),(0,l.kt)("hr",null),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"Step One")," \u2014 Add Nginx Repository")),(0,l.kt)("p",null,"Step One\u2014Add Nginx Repository\nTo add the CentOS 7 EPEL repository, open terminal and use the following command:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"}," sudo yum install epel-release\n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"Step Two")," \u2014 Install Nginx")),(0,l.kt)("p",null,"Now that the Nginx repository is installed on your server, install Nginx using the following yum command:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"}," sudo yum install nginx\n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"Step Three")," \u2014 Start Nginx")),(0,l.kt)("p",null,"Nginx does not start on its own. To get Nginx running, type:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"}," sudo systemctl start nginx\n")),(0,l.kt)("p",null,"Test:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"http://server_domain_name_or_IP/\n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"Step Four")," \u2014 Nginx as a Service")),(0,l.kt)("p",null,"To enable Nginx to start when your system boots, enter the following command:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"}," sudo systemctl enable nginx\n")),(0,l.kt)("p",null,"Always test your config after changes:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"nginx -t\n")),(0,l.kt)("p",null,"And try to reload instead of restarting - reload will fail but old config keeps running in case of error"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"service nginx reload\n")),(0,l.kt)("p",null,"To restart the Nginx service, enter the following command:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"}," service nginx restart\n")),(0,l.kt)("h3",{id:"5-install-nodejs-on-a-centos-7-web-server"},"5 Install Node.js on a CentOS 7 web server"),(0,l.kt)("hr",null),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"Step One")," \u2014 Download the Node.js Source")),(0,l.kt)("p",null,"Choose your version and download the source:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"}," curl --silent --location https://rpm.nodesource.com/setup_7.x | bash -\n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"Step Two")," \u2014 Install Node.js")),(0,l.kt)("p",null,"Then install, as root:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"}," sudo yum -y install nodejs\n")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"}," sudo yum install -y gcc-c++ make\n")),(0,l.kt)("h3",{id:"6-clone-repo-from-git"},"6 Clone Repo from Git"),(0,l.kt)("hr",null),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"Step One")," \u2014 Install Git")),(0,l.kt)("p",null,"After this line you will have Git installed on your CentOS server:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"}," sudo yum install -y git\n")),(0,l.kt)("p",null,"Putting your Git code on your server:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"}," cd /opt/\n sudo mkdir apps\n sudo chown your_app_user_name app\n git clone https://github.com/INSTAR-Deutschland/express-static.git apps\n cd apps\n npm install\n")),(0,l.kt)("p",null,"Update an existing repo by cd into directory and:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"}," git pull origin master\n")),(0,l.kt)("h3",{id:"7-run-the-app-as-a-service-pm2"},"7 Run the app as a service (PM2)"),(0,l.kt)("hr",null),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"Step One")," \u2014 Demonization")),(0,l.kt)("p",null,"Now we will install PM2, which is a process manager for Node.js applications. PM2 provides an easy way to manage and daemonize applications (run them as a service)."),(0,l.kt)("p",null,"We will use Node Packaged Modules (NPM), which is basically a package manager for Node modules that installs with Node.js, to install PM2 on our app server. Use this command to install PM2:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"}," sudo npm install pm2@latest -g\n")),(0,l.kt)("p",null,"To update PM2 to the latest version and update version in memory"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"}," sudo npm install pm2@latest -g\n\n pm2 update\n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"Step Two")," \u2014 Manage Application with PM2")),(0,l.kt)("p",null,"The first thing you will want to do is use the pm2 start command to run your application, app.js, in the background. With node Node apps the entry point is the app.js (or index.js). In case you used Express-Generator to do your app scaffolding, use the www file in the /bin directory instead :"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"}," pm2 start app.js\n")),(0,l.kt)("p",null,"This also adds your application to PM2's process list, which is outputted every time you start an application:"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"App name"),(0,l.kt)("th",{parentName:"tr",align:"center"},"id"),(0,l.kt)("th",{parentName:"tr",align:"center"},"mode"),(0,l.kt)("th",{parentName:"tr",align:"center"},"pid"),(0,l.kt)("th",{parentName:"tr",align:"center"},"status"),(0,l.kt)("th",{parentName:"tr",align:"center"},"restart"),(0,l.kt)("th",{parentName:"tr",align:"center"},"uptime"),(0,l.kt)("th",{parentName:"tr",align:"center"},"mem"),(0,l.kt)("th",{parentName:"tr",align:"right"},"watching"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"app"),(0,l.kt)("td",{parentName:"tr",align:"center"},"0"),(0,l.kt)("td",{parentName:"tr",align:"center"},"fork"),(0,l.kt)("td",{parentName:"tr",align:"center"},"9495"),(0,l.kt)("td",{parentName:"tr",align:"center"},"online"),(0,l.kt)("td",{parentName:"tr",align:"center"},"0"),(0,l.kt)("td",{parentName:"tr",align:"center"},"0s"),(0,l.kt)("td",{parentName:"tr",align:"center"},"36.4 MB"),(0,l.kt)("td",{parentName:"tr",align:"right"},"disabled")))),(0,l.kt)("p",null,"Repeat for all your node apps and save:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"}," pm2 save\n")),(0,l.kt)("p",null,"Applications that are running under PM2 will be restarted automatically if the application crashes or is killed, but an additional step needs to be taken to get the application to launch on system startup (boot or reboot). Luckily, PM2 provides an easy way to do this, the startup subcommand."),(0,l.kt)("p",null,"Once you started all apps, type the following to make sure that they restart after a server restart. You must also specify the init system you are running on, which is centos, in our case:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"}," pm2 startup [ubuntu | ubuntu14 | ubuntu12 | centos | centos6 | arch | oracle | amazon | macos | darwin | freesd | systemd | systemv | upstart | launchd | rcd]\n")),(0,l.kt)("p",null,"The startup subcommand generates and configures a startup script to launch PM2 and its managed processes on server boots. We won\xb4t specify our OS and let pm2 decide what to do:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"}," sudo pm2 startup\n")),(0,l.kt)("p",null,"Bring back previously saved processes (via pm2 save):"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"}," pm2 save\n")),(0,l.kt)("p",null,"Disabling startup system"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"pm2 resurrect\n")),(0,l.kt)("p",null,"Disabling startup system"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"pm2 unstartup\n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"Step Three")," \u2014 Other PM2 Commands (Optional)")),(0,l.kt)("p",null,"Stop an application with this command (specify the PM2 App name or id):"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"}," sudo pm2 stop app\n")),(0,l.kt)("p",null,"Restart an application with this command (specify the PM2 App name or id):"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"}," sudo pm2 restart app\n")),(0,l.kt)("p",null,"Will 0s downtime reload (for NETWORKED apps):"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"}," sudo pm2 reload all\n")),(0,l.kt)("p",null,"Will remove process 0 from pm2 list:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"}," pm2 delete 0\n")),(0,l.kt)("p",null,"The list of applications currently managed by PM2 can also be looked up with the list subcommand:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"}," pm2 list\n")),(0,l.kt)("p",null,"More information about a specific application can be found by using the info subcommand (specify the PM2 App name or id):"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"}," pm2 info app\n")),(0,l.kt)("p",null,"The PM2 process monitor can be pulled up with the monit subcommand. This displays the application status, CPU, and memory usage:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"}," pm2 monit\n")),(0,l.kt)("h3",{id:"8-install-java"},"8 Install Java"),(0,l.kt)("hr",null),(0,l.kt)("h4",{id:"public-signing-key"},"Public Signing Key"),(0,l.kt)("p",null,"Download the Oracle Java 8:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"}," cd ~\n wget --no-cookies --no-check-certificate --header 'Cookie: gpw_e24=http%3A%2F%2Fwww.oracle.com%2F; oraclelicense=accept-securebackup-cookie' 'http://download.oracle.com/otn-pub/java/jdk/8u73-b02/jdk-8u73-linux-x64.rpm'\n")),(0,l.kt)("h4",{id:"install-java-8"},"Install Java 8"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"sudo yum -y localinstall jdk-8u73-linux-x64.rpm\n")),(0,l.kt)("p",null,"Now Java should be installed at /usr/java/jdk1.8.0_73/jre/bin/java, and linked from /usr/bin/java. u may delete the archive file that you downloaded earlier:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"rm ~/jdk-8u*-linux-x64.rpm\n")),(0,l.kt)("h3",{id:"9-install-elasticsearch"},"9 Install Elasticsearch"),(0,l.kt)("h4",{id:"public-signing-key-1"},"Public Signing Key"),(0,l.kt)("p",null,"Download and install the public signing key:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"}," rpm --import https://packages.elastic.co/GPG-KEY-elasticsearch\n")),(0,l.kt)("p",null,"Add the following in your /etc/yum.repos.d/ directory in a file with a .repo suffix, for example elasticsearch.repo"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"[elasticsearch-5.x]\nname=Elasticsearch repository for 5.x packages\nbaseurl=https://artifacts.elastic.co/packages/5.x/yum\ngpgcheck=1\ngpgkey=https://artifacts.elastic.co/GPG-KEY-elasticsearch\nenabled=1\nautorefresh=1\ntype=rpm-md\n")),(0,l.kt)("h4",{id:"install-elasticsearch"},"Install Elasticsearch"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"sudo yum install elasticsearch\n")),(0,l.kt)("h4",{id:"access-control-allow-origin"},"Access-Control-Allow-Origin"),(0,l.kt)("p",null,"Restrict outside access to your Elasticsearch instance (port 9200)"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"sudo vi /etc/elasticsearch/elasticsearch.yml\n\n-> network.host: localhost\n")),(0,l.kt)("p",null,"To get rid of the following Error:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"Failed to load http://localhost:9200/: No 'Access-Control-Allow-Origin' header is present on the requested resource. Origin 'http://localhost:8000' is therefore not allowed access.\n")),(0,l.kt)("p",null,"Add the following line to elasticsearch.yml"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"http.cors:\n  enabled: true\n  allow-origin: /https?:\\/\\/localhost(:[0-9]+)?/\n")),(0,l.kt)("h4",{id:"set-up-elasticsearch-service"},"Set-up Elasticsearch Service"),(0,l.kt)("p",null,"To configure Elasticsearch to start automatically when the system boots up, run the following commands:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"sudo /bin/systemctl daemon-reload\nsudo /bin/systemctl enable elasticsearch.service\n")),(0,l.kt)("p",null,"Elasticsearch can be started and stopped as follows:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"sudo systemctl start elasticsearch.service\nsudo systemctl stop elasticsearch.service\n")),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Type"),(0,l.kt)("th",{parentName:"tr",align:"center"},"Description"),(0,l.kt)("th",{parentName:"tr",align:"right"},"Location RHEL/CentOS"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"home"),(0,l.kt)("td",{parentName:"tr",align:"center"},"Home of elasticsearch installation."),(0,l.kt)("td",{parentName:"tr",align:"right"},"/usr/share/elasticsearch")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"bin"),(0,l.kt)("td",{parentName:"tr",align:"center"},"Binary scripts including elasticsearch to start a node."),(0,l.kt)("td",{parentName:"tr",align:"right"},"/usr/share/elasticsearch/bin")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"conf"),(0,l.kt)("td",{parentName:"tr",align:"center"},"Configuration files elasticsearch.yml and logging.yml."),(0,l.kt)("td",{parentName:"tr",align:"right"},"/etc/elasticsearch")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"conf"),(0,l.kt)("td",{parentName:"tr",align:"center"},"Environment variables including heap size, file descriptors."),(0,l.kt)("td",{parentName:"tr",align:"right"},"/etc/sysconfig/elasticsearch")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"data"),(0,l.kt)("td",{parentName:"tr",align:"center"},"The location of the data files of each index / shard allocated on the node."),(0,l.kt)("td",{parentName:"tr",align:"right"},"/var/lib/elasticsearch")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"logs"),(0,l.kt)("td",{parentName:"tr",align:"center"},"Log files location"),(0,l.kt)("td",{parentName:"tr",align:"right"},"/var/log/elasticsearch")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"plugins"),(0,l.kt)("td",{parentName:"tr",align:"center"},"Plugin files location. Each plugin will be contained in a subdirectory."),(0,l.kt)("td",{parentName:"tr",align:"right"},"/usr/share/elasticsearch/plugins")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"repo"),(0,l.kt)("td",{parentName:"tr",align:"center"},"Shared file system repository locations."),(0,l.kt)("td",{parentName:"tr",align:"right"},"Not configured")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"script"),(0,l.kt)("td",{parentName:"tr",align:"center"},"Location of script files."),(0,l.kt)("td",{parentName:"tr",align:"right"},"/etc/elasticsearch/scripts")))),(0,l.kt)("h3",{id:"10-install-kibana"},"10 Install Kibana"),(0,l.kt)("hr",null),(0,l.kt)("h4",{id:"create-and-edit-a-new-yum-repository-file-for-kibana"},"Create and edit a new yum repository file for Kibana"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"}," sudo vi /etc/yum.repos.d/kibana.repo\n")),(0,l.kt)("p",null,"Add the following repository configuration:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"[kibana-5.x]\nname=Kibana repository for 5.x packages\nbaseurl=https://artifacts.elastic.co/packages/5.x/yum\ngpgcheck=1\ngpgkey=https://artifacts.elastic.co/GPG-KEY-elasticsearch\nenabled=1\nautorefresh=1\ntype=rpm-md\n")),(0,l.kt)("h4",{id:"install-kibana-with-this-command"},"Install Kibana with this command:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"sudo yum install kibana\n")),(0,l.kt)("h4",{id:"set-elasticsearch-connection-url"},"Set Elasticsearch Connection URL"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"sudo vi /opt/kibana/config/kibana.yml\n\n-> elasticsearch.url: 'http://localhost:9200'\n")),(0,l.kt)("h4",{id:"install-kibana-service"},"Install Kibana Service"),(0,l.kt)("p",null,"To configure Kibana to start automatically when the system boots up, run the following commands:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"sudo /bin/systemctl daemon-reload\nsudo /bin/systemctl enable kibana.service\n")),(0,l.kt)("p",null,"Kibana can be started and stopped as follows:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"sudo systemctl start kibana.service\nsudo systemctl stop kibana.service\n")),(0,l.kt)("h4",{id:"secure-kibana-with-nginx"},"Secure Kibana with NGINX"),(0,l.kt)("p",null,"Use NGINX to securely access Kibana and use htpasswd to create an admin user:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"sudo yum -y install httpd-tools\nsudo htpasswd -c /etc/nginx/htpasswd.users admin\n")),(0,l.kt)("p",null,"Add your password."),(0,l.kt)("h4",{id:"securing-kibana-in-a-nginx-server-block"},"Securing Kibana in a Nginx server block"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"sudo vi /etc/nginx/nginx.conf\n")),(0,l.kt)("p",null,"Find the default server block (starts with server {), the last configuration block in the file, and delete it. When you are done, the last two lines in the file should look like this:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"include /etc/nginx/conf.d/*.conf;\n}\n")),(0,l.kt)("p",null,"Now we will create an Nginx server block in a new file:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"sudo vi /etc/nginx/conf.d/kibana.conf\n")),(0,l.kt)("p",null,"Paste the following code block into the file. Be sure to update the server_name to match your server's name:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"server {\n    listen 80;\n\n    server_name example.com;\n\n    auth_basic 'Restricted Access';\n    auth_basic_user_file /etc/nginx/htpasswd.users;\n\n    location / {\n        proxy_pass http://localhost:5601;\n        proxy_http_version 1.1;\n        proxy_set_header Upgrade $http_upgrade;\n        proxy_set_header Connection 'upgrade';\n        proxy_set_header Host $host;\n        proxy_cache_bypass $http_upgrade;        \n    }\n}\n")),(0,l.kt)("p",null,"Now start and enable Nginx to put our changes into effect:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"sudo systemctl start nginx\nsudo systemctl enable nginx\n")),(0,l.kt)("h4",{id:"install-sense"},"Install Sense"),(0,l.kt)("p",null,"Once Kibana is installed, you can install Sense running the following command from your /opt/kibana folder:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"./bin/kibana plugin --install elastic/sense\n")),(0,l.kt)("p",null,"You will now need to start Kibana:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"./bin/kibana\n")),(0,l.kt)("p",null,"The apps are now available via:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"http://localhost:5601/app/kibana\nhttp://localhost:5601/app/sense\n")),(0,l.kt)("p",null,"Use Sense to feed Elasticsearch with mappings/postings (see wiki-data.json)"))}u.isMDXComponent=!0},75113:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/node-express-static_01-fae26f40f5037f3a2816bcdb490e166b.png"},4199:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/photo-11626620916_804d27ae54_o-4eb00991e239f8ffb936730d9584e439.png"}}]);