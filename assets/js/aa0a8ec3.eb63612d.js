"use strict";(self.webpackChunkmikes_dev_notebook=self.webpackChunkmikes_dev_notebook||[]).push([[67583],{3905:(e,a,t)=>{t.d(a,{Zo:()=>l,kt:()=>d});var n=t(67294);function r(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function i(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);a&&(n=n.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),t.push.apply(t,n)}return t}function o(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?arguments[a]:{};a%2?i(Object(t),!0).forEach((function(a){r(e,a,t[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))}))}return e}function s(e,a){if(null==e)return{};var t,n,r=function(e,a){if(null==e)return{};var t,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)t=i[n],a.indexOf(t)>=0||(r[t]=e[t]);return r}(e,a);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)t=i[n],a.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var c=n.createContext({}),m=function(e){var a=n.useContext(c),t=a;return e&&(t="function"==typeof e?e(a):o(o({},a),e)),t},l=function(e){var a=m(e.components);return n.createElement(c.Provider,{value:a},e.children)},u={inlineCode:"code",wrapper:function(e){var a=e.children;return n.createElement(n.Fragment,{},a)}},p=n.forwardRef((function(e,a){var t=e.components,r=e.mdxType,i=e.originalType,c=e.parentName,l=s(e,["components","mdxType","originalType","parentName"]),p=m(t),d=r,g=p["".concat(c,".").concat(d)]||p[d]||u[d]||i;return t?n.createElement(g,o(o({ref:a},l),{},{components:t})):n.createElement(g,o({ref:a},l))}));function d(e,a){var t=arguments,r=a&&a.mdxType;if("string"==typeof e||r){var i=t.length,o=new Array(i);o[0]=p;var s={};for(var c in a)hasOwnProperty.call(a,c)&&(s[c]=a[c]);s.originalType=e,s.mdxType="string"==typeof e?e:r,o[1]=s;for(var m=2;m<i;m++)o[m]=t[m];return n.createElement.apply(null,o)}return n.createElement.apply(null,t)}p.displayName="MDXCreateElement"},53020:(e,a,t)=>{t.r(a),t.d(a,{assets:()=>c,contentTitle:()=>o,default:()=>u,frontMatter:()=>i,metadata:()=>s,toc:()=>m});var n=t(87462),r=(t(67294),t(3905));const i={sidebar_position:6970,slug:"2022-10-18",title:"Run Camera.UI with Docker-Compose",authors:"mpolinowski",tags:["IoT","Docker"],description:"camera.ui is a NVR like PWA to control your RTSP capable cameras with."},o=void 0,s={unversionedId:"IoT-and-Machine-Learning/Home_Automation/2022-10-18-camera-ui-docker/index",id:"IoT-and-Machine-Learning/Home_Automation/2022-10-18-camera-ui-docker/index",title:"Run Camera.UI with Docker-Compose",description:"camera.ui is a NVR like PWA to control your RTSP capable cameras with.",source:"@site/docs/IoT-and-Machine-Learning/Home_Automation/2022-10-18-camera-ui-docker/index.md",sourceDirName:"IoT-and-Machine-Learning/Home_Automation/2022-10-18-camera-ui-docker",slug:"/IoT-and-Machine-Learning/Home_Automation/2022-10-18-camera-ui-docker/2022-10-18",permalink:"/docs/IoT-and-Machine-Learning/Home_Automation/2022-10-18-camera-ui-docker/2022-10-18",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/IoT-and-Machine-Learning/Home_Automation/2022-10-18-camera-ui-docker/index.md",tags:[{label:"IoT",permalink:"/docs/tags/io-t"},{label:"Docker",permalink:"/docs/tags/docker"}],version:"current",sidebarPosition:6970,frontMatter:{sidebar_position:6970,slug:"2022-10-18",title:"Run Camera.UI with Docker-Compose",authors:"mpolinowski",tags:["IoT","Docker"],description:"camera.ui is a NVR like PWA to control your RTSP capable cameras with."},sidebar:"tutorialSidebar",previous:{title:"Convert RTSP to HLS using FFmpeg",permalink:"/docs/IoT-and-Machine-Learning/Home_Automation/2022-12-15--rtsp-to-hls-ffmpeg/2022-12-15"},next:{title:"MQTT Auto-Discovery - Use Node-RED to register Smarthome Devices",permalink:"/docs/IoT-and-Machine-Learning/Home_Automation/2022-07-17-node-red-for-mqtt-autodiscovery/2022-07-17"}},c={},m=[{value:"Setup",id:"setup",level:2},{value:"Docker-Compose",id:"docker-compose",level:3},{value:"Adding a Camera",id:"adding-a-camera",level:2},{value:"Alarmserver",id:"alarmserver",level:2},{value:"HTTP",id:"http",level:3},{value:"MQTT",id:"mqtt",level:3}],l={toc:m};function u(e){let{components:a,...i}=e;return(0,r.kt)("wrapper",(0,n.Z)({},l,i,{components:a,mdxType:"MDXLayout"}),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Guangzhou, China",src:t(80235).Z,width:"1500",height:"526"})),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#setup"},"Setup"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#docker-compose"},"Docker-Compose")))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#adding-a-camera"},"Adding a Camera")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#alarmserver"},"Alarmserver"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#http"},"HTTP")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#mqtt"},"MQTT"))))),(0,r.kt)("h2",{id:"setup"},"Setup"),(0,r.kt)("h3",{id:"docker-compose"},"Docker-Compose"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yml"},'version: \'3.8\'\n\nservices:\n  camera.ui:\n    container_name: camera.ui\n    image: nexryai/camera.ui:latest\n    ports:\n     - "8081:8081"\n     - "1883:1883"\n     - "7272:7272"\n    volumes:\n      - ./data:/.camera.ui:rw\n    networks:\n      - services\n    restart: unless-stopped\n\nnetworks:\n  services:\n    external: false\n')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'docker-compose pull\nPulling camera.ui ... done\n\ndocker-compose up\nCreating network "camera-ui-docker_default" with the default driver\nCreating camera.ui ... done\nAttaching to camera.ui\ncamera.ui    | [10/18/2022, 4:54:52 AM] [camera.ui] camera.ui v1.1.17 is listening on port 8081 (http)\n')),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Run Camera.UI with Docker-Compose",src:t(30558).Z,width:"1045",height:"537"})),(0,r.kt)("h2",{id:"adding-a-camera"},"Adding a Camera"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Run Camera.UI with Docker-Compose",src:t(50679).Z,width:"991",height:"884"})),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'"cameras": [\n  {\n      "name": "IN-9408 2k+ WQHD",\n      "motionTimeout": 15,\n      "recordOnMovement": null,\n      "prebuffering": null,\n      "videoConfig": {\n        "source": "-i rtsp://admin:instar@192.168.2.120:554/livestream/11",\n        "stillImageSource": "-i http://admin:instar@192.168.2.120/snap.cgi?chn=12",\n        "stimeout": 10,\n        "audio": null,\n        "debug": null,\n        "subSource": "-i rtsp://admin:instar@192.168.2.120:554/livestream/12",\n        "rtspTransport": "tcp",\n        "vcodec": "copy",\n        "acodec": "libfdk_aac"\n      }\n]\n')),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Run Camera.UI with Docker-Compose",src:t(48689).Z,width:"1059",height:"883"})),(0,r.kt)("h2",{id:"alarmserver"},"Alarmserver"),(0,r.kt)("h3",{id:"http"},"HTTP"),(0,r.kt)("p",null,"The HTTP alarmserver can be activated to trigger or reset a movement by a simple call of a link."),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Run Camera.UI with Docker-Compose",src:t(50062).Z,width:"1021",height:"476"})),(0,r.kt)("p",null,"If the HTTP server is activated, a movement can be triggered by e.g. the following link and our camera name ",(0,r.kt)("inlineCode",{parentName:"p"},"IN-9408 2k+ WQHD"),":"),(0,r.kt)("p",null,"http://localhost:7272/motion?IN-9408%202k+%20WQHD"),(0,r.kt)("p",null,"And reset via"),(0,r.kt)("p",null,"http://localhost:7272/motion/reset?IN-9408%202k+%20WQHD"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Run Camera.UI with Docker-Compose",src:t(80815).Z,width:"928",height:"191"})),(0,r.kt)("p",null,"But there is an issue with cameras that append a value to their query key:"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},(0,r.kt)("inlineCode",{parentName:"p"},"[camera.ui]  WARNING  IN-9408 2k+ WQHD=1: Camera 'IN-9408 2k+ WQHD=1' not found"))),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Run Camera.UI with Docker-Compose",src:t(80815).Z,width:"928",height:"191"})),(0,r.kt)("h3",{id:"mqtt"},"MQTT"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Run Camera.UI with Docker-Compose",src:t(67008).Z,width:"1122",height:"731"})),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Missing configuration - I cannot add a MQTT broker login:")),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Run Camera.UI with Docker-Compose",src:t(5134).Z,width:"1122",height:"469"})),(0,r.kt)("p",null,"The missing configuration can be added manually - since we mounted the configuration directory to ",(0,r.kt)("inlineCode",{parentName:"p"},"./data")," all the configuration files can now be found inside this folder next to our ",(0,r.kt)("inlineCode",{parentName:"p"},"docker-compose.yml")," file. Alternatively, just edit the directly inside the container:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"docker exec -ti camera.ui nano .camera.ui/config.json\n")),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Run Camera.UI with Docker-Compose",src:t(93716).Z,width:"896",height:"431"})),(0,r.kt)("p",null,"And while we are in here, we can also add the Camera MQTT alarmserver:"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Run Camera.UI with Docker-Compose",src:t(26522).Z,width:"896",height:"426"})),(0,r.kt)("p",null,"After a restart the MQTT broker is now connected:"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Run Camera.UI with Docker-Compose",src:t(59268).Z,width:"1116",height:"518"})),(0,r.kt)("p",null,"And I can see that the software is now listening for the alarmserver topic of my camera:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'camera.ui    | [10/18/2022, 6:48:47 AM] [camera.ui] MQTT: New message: Topic: cameras/120/status/alarm/triggered - Data: {"val":"1"} - Type: string\ncamera.ui    | [10/18/2022, 6:48:52 AM] [camera.ui] MQTT: New message: Topic: cameras/120/status/alarm/triggered - Data: {"val":"0"} - Type: string\ncamera.ui    | [10/18/2022, 6:48:52 AM] [camera.ui]  WARNING  The incoming MQTT message ({"val":"0"}) for the topic (cameras/120/status/alarm/triggered) was not the same as set in config.json ({"val":"1"}). Skip...\ncamera.ui    | [10/18/2022, 6:49:51 AM] [camera.ui] MQTT: New message: Topic: cameras/120/status/alarm/triggered - Data: {"val":"1"} - Type: string\ncamera.ui    | [10/18/2022, 6:49:52 AM] [camera.ui] MQTT: New message: Topic: cameras/120/status/alarm/triggered - Data: {"val":"1"} - Type: string\ncamera.ui    | [10/18/2022, 6:49:57 AM] [camera.ui] MQTT: New message: Topic: cameras/120/status/alarm/triggered - Data: {"val":"0"} - Type: string\ncamera.ui    | [10/18/2022, 6:49:57 AM] [camera.ui]  WARNING  The incoming MQTT message ({"val":"0"}) for the topic (cameras/120/status/alarm/triggered) was not the same as set in config.json ({"val":"1"}). Skip...\ncamera.ui    | [10/18/2022, 6:51:31 AM] [camera.ui] MQTT: New message: Topic: cameras/120/status/alarm/triggered - Data: {"val":"1"} - Type: string\ncamera.ui    | [10/18/2022, 6:51:32 AM] [camera.ui] MQTT: New message: Topic: cameras/120/status/alarm/triggered - Data: {"val":"1"} - Type: string\ncamera.ui    | [10/18/2022, 6:51:37 AM] [camera.ui] MQTT: New message: Topic: cameras/120/status/alarm/triggered - Data: {"val":"0"} - Type: string\ncamera.ui    | [10/18/2022, 6:51:37 AM] [camera.ui]  WARNING  The incoming MQTT message ({"val":"0"}) for the topic (cameras/120/status/alarm/triggered) was not the same as set in config.json ({"val":"1"}). Skip...\n')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "logLevel": "info",\n  "port": 8081,\n  "atHomeSwitch": false,\n  "options": {\n    "videoProcessor": "/usr/lib/node_modules/camera.ui/node_modules/ffmpeg-for-homebridge/ffmpeg"\n  },\n  "ssl": {\n    "active": false\n  },\n  "http": {\n    "active": true,\n    "port": 7272,\n    "localhttp": false\n  },\n  "smtp": {\n    "active": false,\n    "port": 2727,\n    "space_replace": "+"\n  },\n  "ftp": {\n    "active": false,\n    "useFile": false,\n    "port": 5050\n  },\n  "mqtt": {\n    "active": true,\n    "tls": false,\n    "host": "192.168.2.120",\n    "port": 1883,\n    "username": "admin",\n    "password": "instar"\n  },\n  "cameras": [\n    {\n      "name": "IN-9408 2k+ WQHD",\n      "motionTimeout": 15,\n      "recordOnMovement": null,\n      "prebuffering": null,\n      "videoConfig": {\n        "source": "-i rtsp://admin:instar@192.168.2.120:554/livestream/11",\n        "stillImageSource": "-i http://admin:instar@192.168.2.120/snap.cgi?chn=12",\n        "stimeout": 10,\n        "audio": null,\n        "debug": null,\n        "subSource": "-i rtsp://admin:instar@192.168.2.120:554/livestream/12",\n        "rtspTransport": "tcp",\n        "vcodec": "copy",\n        "acodec": "libfdk_aac"\n      },\n      "mqtt": {\n        "motionTopic": "cameras/120/status/alarm/triggered",\n        "motionMessage": "{\\"val\\":\\"1\\"}",\n        "motionResetTopic": "cameras/120/status/alarm/triggered",\n        "motionResetMessage": "{\\"val\\":\\"0\\"}"\n      },\n      "smtp": {\n        "email": "IN-9408 2k+ WQHD"\n      },\n      "videoanalysis": {\n        "active": false\n      },\n      "prebufferLength": 4\n    }\n  ]\n}\n')))}u.isMDXComponent=!0},30558:(e,a,t)=>{t.d(a,{Z:()=>n});const n=t.p+"assets/images/camera-ui-docker_01-004c93a3721b79549afbf4924564de83.png"},50679:(e,a,t)=>{t.d(a,{Z:()=>n});const n=t.p+"assets/images/camera-ui-docker_02-4e77e9582d4db603810d0c440ecd598b.png"},48689:(e,a,t)=>{t.d(a,{Z:()=>n});const n=t.p+"assets/images/camera-ui-docker_03-cd3ab1ea5aa12a47cd06661ca510255f.png"},50062:(e,a,t)=>{t.d(a,{Z:()=>n});const n=t.p+"assets/images/camera-ui-docker_04-72fadf7bd9081b3e8f80f8828c4606a8.png"},67008:(e,a,t)=>{t.d(a,{Z:()=>n});const n=t.p+"assets/images/camera-ui-docker_05-69b437c07052b3367a20e9eb75a8275f.png"},5134:(e,a,t)=>{t.d(a,{Z:()=>n});const n=t.p+"assets/images/camera-ui-docker_06-6327c2d8c57d1518de5b1d0b85c672d8.png"},93716:(e,a,t)=>{t.d(a,{Z:()=>n});const n=t.p+"assets/images/camera-ui-docker_07-d3296f413e3ab708e7ac0ee2f98e01fe.png"},26522:(e,a,t)=>{t.d(a,{Z:()=>n});const n=t.p+"assets/images/camera-ui-docker_08-49906656e25ac8a00d57ed88a8586e95.png"},59268:(e,a,t)=>{t.d(a,{Z:()=>n});const n=t.p+"assets/images/camera-ui-docker_09-bc04b9037961ad791c02a8acc6519663.png"},80815:(e,a,t)=>{t.d(a,{Z:()=>n});const n=t.p+"assets/images/camera-ui-docker_10-23497c3b4c14ab5c380eda52ca07533f.png"},80235:(e,a,t)=>{t.d(a,{Z:()=>n});const n=t.p+"assets/images/photo-kt443t6d_64hdh43hfh6dgjdfhg4_d-98d71e33f881256303c68773a2ed92ba.jpg"}}]);