"use strict";(self.webpackChunkmikes_dev_notebook=self.webpackChunkmikes_dev_notebook||[]).push([[85806],{3905:(e,n,t)=>{t.d(n,{Zo:()=>c,kt:()=>k});var i=t(67294);function o(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function r(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,i)}return t}function a(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?r(Object(t),!0).forEach((function(n){o(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,i,o=function(e,n){if(null==e)return{};var t,i,o={},r=Object.keys(e);for(i=0;i<r.length;i++)t=r[i],n.indexOf(t)>=0||(o[t]=e[t]);return o}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(i=0;i<r.length;i++)t=r[i],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var s=i.createContext({}),p=function(e){var n=i.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):a(a({},n),e)),t},c=function(e){var n=p(e.components);return i.createElement(s.Provider,{value:n},e.children)},d={inlineCode:"code",wrapper:function(e){var n=e.children;return i.createElement(i.Fragment,{},n)}},u=i.forwardRef((function(e,n){var t=e.components,o=e.mdxType,r=e.originalType,s=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),u=p(t),k=o,m=u["".concat(s,".").concat(k)]||u[k]||d[k]||r;return t?i.createElement(m,a(a({ref:n},c),{},{components:t})):i.createElement(m,a({ref:n},c))}));function k(e,n){var t=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var r=t.length,a=new Array(r);a[0]=u;var l={};for(var s in n)hasOwnProperty.call(n,s)&&(l[s]=n[s]);l.originalType=e,l.mdxType="string"==typeof e?e:o,a[1]=l;for(var p=2;p<r;p++)a[p]=t[p];return i.createElement.apply(null,a)}return i.createElement.apply(null,t)}u.displayName="MDXCreateElement"},79911:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>s,contentTitle:()=>a,default:()=>d,frontMatter:()=>r,metadata:()=>l,toc:()=>p});var i=t(87462),o=(t(67294),t(3905));const r={sidebar_position:8010,slug:"2020-06-07",title:"Developing WikiJS in Docker",authors:"mpolinowski",tags:["Databases","Docker"]},a=void 0,l={unversionedId:"DevOps/Provisioning/2020-06-07--setting-up-wikijs-in-docker/index",id:"DevOps/Provisioning/2020-06-07--setting-up-wikijs-in-docker/index",title:"Developing WikiJS in Docker",description:"Central, Hong Kong",source:"@site/docs/DevOps/Provisioning/2020-06-07--setting-up-wikijs-in-docker/index.mdx",sourceDirName:"DevOps/Provisioning/2020-06-07--setting-up-wikijs-in-docker",slug:"/DevOps/Provisioning/2020-06-07--setting-up-wikijs-in-docker/2020-06-07",permalink:"/docs/DevOps/Provisioning/2020-06-07--setting-up-wikijs-in-docker/2020-06-07",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/DevOps/Provisioning/2020-06-07--setting-up-wikijs-in-docker/index.mdx",tags:[{label:"Databases",permalink:"/docs/tags/databases"},{label:"Docker",permalink:"/docs/tags/docker"}],version:"current",sidebarPosition:8010,frontMatter:{sidebar_position:8010,slug:"2020-06-07",title:"Developing WikiJS in Docker",authors:"mpolinowski",tags:["Databases","Docker"]},sidebar:"tutorialSidebar",previous:{title:"Infrastructure as Code",permalink:"/docs/DevOps/Provisioning/2020-07-13--infrastructure-as-code/2020-07-13"},next:{title:"Vanilla Forums Installation on Debian",permalink:"/docs/DevOps/Provisioning/2019-09-16--installing-vanilla-forum/2019-09-16"}},s={},p=[{value:"Preparations",id:"preparations",level:2},{value:"Dockerfile",id:"dockerfile",level:3},{value:"config.yml",id:"configyml",level:3},{value:"docker-compose.yml",id:"docker-composeyml",level:3},{value:"Spinning up Docker",id:"spinning-up-docker",level:2},{value:"Running the App",id:"running-the-app",level:3},{value:"Stopping the App",id:"stopping-the-app",level:3},{value:"Building production assets",id:"building-production-assets",level:2},{value:"Running the official Wiki.js Build",id:"running-the-official-wikijs-build",level:2}],c={toc:p};function d(e){let{components:n,...r}=e;return(0,o.kt)("wrapper",(0,i.Z)({},c,r,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"Central, Hong Kong",src:t(2405).Z,width:"1500",height:"542"})),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#preparations"},"Preparations"),(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#dockerfile"},"Dockerfile")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#configyml"},"config.yml")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#docker-composeyml"},"docker-compose.yml")))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#spinning-up-docker"},"Spinning up Docker"),(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#running-the-app"},"Running the App")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#stopping-the-app"},"Stopping the App")))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#building-production-assets"},"Building production assets"))),(0,o.kt)("h2",{id:"preparations"},"Preparations"),(0,o.kt)("p",null,"Based on the official ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/Requarks/wiki/tree/dev/dev/containers"},"WikiJS Docker Sample"),"."),(0,o.kt)("p",null,"Start by cloning the ",(0,o.kt)("a",{parentName:"p",href:"https://codeload.github.com/Requarks/wiki/zip/dev"},"WikiJS Repository")," into a folder called ",(0,o.kt)("inlineCode",{parentName:"p"},"wiki-source"),". Continue by creating the following 3 files next to this folder:"),(0,o.kt)("h3",{id:"dockerfile"},"Dockerfile"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-dockerfile"},'FROM node:12\nLABEL maintainer "mpolinowski@gmail.com"\n\nRUN apt-get update && \\\n    apt-get install -y bash curl git python make g++ nano openssh-server gnupg && \\\n    mkdir -p /wiki\n\nWORKDIR /wiki\n\nENV dockerdev 1\nENV DEVDB postgres\n\nEXPOSE 3000\n\nCMD ["tail", "-f", "/dev/null"]\n')),(0,o.kt)("hr",null),(0,o.kt)("h3",{id:"configyml"},"config.yml"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yml"},"port: 3000\nbindIP: 0.0.0.0\ndb:\n  type: postgres\n  host: db\n  port: 5432\n  user: wikijs\n  pass: wikijsrocks\n  db: wiki\nlogLevel: info\n")),(0,o.kt)("hr",null),(0,o.kt)("h3",{id:"docker-composeyml"},"docker-compose.yml"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yml"},'version: "3"\nservices:\n  db:\n    container_name: wiki-db\n    image: postgres:9-alpine\n    environment:\n      POSTGRES_DB: wiki\n      POSTGRES_PASSWORD: wikijsrocks\n      POSTGRES_USER: wikijs\n    logging:\n      driver: "none"\n    volumes:\n      - db-data:/var/lib/postgresql/data\n    ports:\n      - "15432:5432"\n\n  adminer:\n    container_name: wiki-adminer\n    image: adminer:latest\n    logging:\n      driver: "none"\n    ports:\n      - "3001:8080"\n\n  wiki:\n    container_name: wiki-app\n    build:\n      context: ./wiki-source\n      dockerfile: ../Dockerfile\n    depends_on:\n      - db\n    ports:\n      - "3000:3000"\n    volumes:\n      - ./wiki-source:/wiki\n      - /wiki/node_modules\n      - /wiki/.git\n\n\nvolumes:\n  db-data:\n')),(0,o.kt)("hr",null),(0,o.kt)("h2",{id:"spinning-up-docker"},"Spinning up Docker"),(0,o.kt)("p",null,"Run the build command to pull / build your images:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"sudo docker-compose build\n")),(0,o.kt)("h3",{id:"running-the-app"},"Running the App"),(0,o.kt)("p",null,"Run the following commands:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"docker-compose -f docker-compose.yml up -d\ndocker exec wiki-app npm install   # only necessary the first time\ndocker exec wiki-app npm run dev\n")),(0,o.kt)("p",null,"This will start Wiki.js in dev mode. Client assets are compiled first (using Webpack), then the server will start automatically. Wait for this process to complete before loading the app!"),(0,o.kt)("p",null,"See ",(0,o.kt)("a",{parentName:"p",href:"#building-production-assets"},"how to build for production")," below."),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"Run Wiki.js in Docker",src:t(7298).Z,width:"881",height:"536"})),(0,o.kt)("p",null,"Browse to the site, using the configuration you defined in config.yml. For example, if using port 3000 on your local machine, you would browse to ",(0,o.kt)("inlineCode",{parentName:"p"},"http://localhost:3000/"),"."),(0,o.kt)("p",null,"The first time you load the wiki, you'll get greeted with the setup wizard. Complete all the steps to finish the installation."),(0,o.kt)("h3",{id:"stopping-the-app"},"Stopping the App"),(0,o.kt)("p",null,"Run the following to shut down the app"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"docker-compose -f docker-compose.yml stop\n")),(0,o.kt)("p",null,"To completely remove the containers run:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"docker-compose -f docker-compose.yml down\n")),(0,o.kt)("p",null,"To wipe the database as well, use:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"docker-compose -f docker-compose.yml down --volumes\n")),(0,o.kt)("h2",{id:"building-production-assets"},"Building production assets"),(0,o.kt)("p",null,"Once you're ready to deploy your changes, you need to build the client assets into a production optimized bundle:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"docker exec wiki-app npm run build\ndocker exec wiki-app npm run start\n")),(0,o.kt)("h2",{id:"running-the-official-wikijs-build"},"Running the official Wiki.js Build"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"wikijs-docker-compose.yaml")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yml"},'version: "3"\nservices:\n\n  db:\n    image: postgres:11-alpine\n    environment:\n      POSTGRES_DB: wiki\n      POSTGRES_PASSWORD: wikijsrocks\n      POSTGRES_USER: wikijs\n    logging:\n      driver: "none"\n    restart: unless-stopped\n    volumes:\n      - db-data:/var/lib/postgresql/data\n\n  wiki:\n    image: requarks/wiki:2\n    depends_on:\n      - db\n    environment:\n      DB_TYPE: postgres\n      DB_HOST: db\n      DB_PORT: 5432\n      DB_USER: wikijs\n      DB_PASS: wikijsrocks\n      DB_NAME: wiki\n    restart: unless-stopped\n    ports:\n      - "80:3000"\n\nvolumes:\n  db-data:\n')),(0,o.kt)("p",null,"Build with:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"sudo docker-compose -f wikijs-docker-compose.yaml up -d\n")))}d.isMDXComponent=!0},7298:(e,n,t)=>{t.d(n,{Z:()=>i});const i=t.p+"assets/images/Wikijs_Docker_01-728a7772f2d77d2d01d869f74f61d5a7.png"},2405:(e,n,t)=>{t.d(n,{Z:()=>i});const i=t.p+"assets/images/photo-kt443t6d_64hdh43hfh6dgjdfhg4_d-072d216b41518884adc06d90cec9a075.jpg"}}]);