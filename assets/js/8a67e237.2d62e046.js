"use strict";(self.webpackChunkmikes_dev_notebook=self.webpackChunkmikes_dev_notebook||[]).push([[17320],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>m});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=a.createContext({}),c=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},p=function(e){var t=c(e.components);return a.createElement(l.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),u=c(n),m=r,h=u["".concat(l,".").concat(m)]||u[m]||d[m]||i;return n?a.createElement(h,o(o({ref:t},p),{},{components:n})):a.createElement(h,o({ref:t},p))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,o=new Array(i);o[0]=u;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:r,o[1]=s;for(var c=2;c<i;c++)o[c]=n[c];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},8961:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>o,default:()=>d,frontMatter:()=>i,metadata:()=>s,toc:()=>c});var a=n(87462),r=(n(67294),n(3905));const i={sidebar_position:9050,slug:"2020-07-29",title:"Securing Webservers - Apache and NGINX",authors:"mpolinowski",tags:["LINUX","Security","Apache","NGINX"]},o=void 0,s={unversionedId:"DevOps/NGINX/2020-07-29--securing-apache-and-nginx/index",id:"DevOps/NGINX/2020-07-29--securing-apache-and-nginx/index",title:"Securing Webservers - Apache and NGINX",description:"Central, Hong Kong",source:"@site/docs/DevOps/NGINX/2020-07-29--securing-apache-and-nginx/index.md",sourceDirName:"DevOps/NGINX/2020-07-29--securing-apache-and-nginx",slug:"/DevOps/NGINX/2020-07-29--securing-apache-and-nginx/2020-07-29",permalink:"/docs/DevOps/NGINX/2020-07-29--securing-apache-and-nginx/2020-07-29",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/DevOps/NGINX/2020-07-29--securing-apache-and-nginx/index.md",tags:[{label:"LINUX",permalink:"/docs/tags/linux"},{label:"Security",permalink:"/docs/tags/security"},{label:"Apache",permalink:"/docs/tags/apache"},{label:"NGINX",permalink:"/docs/tags/nginx"}],version:"current",sidebarPosition:9050,frontMatter:{sidebar_position:9050,slug:"2020-07-29",title:"Securing Webservers - Apache and NGINX",authors:"mpolinowski",tags:["LINUX","Security","Apache","NGINX"]},sidebar:"tutorialSidebar",previous:{title:"NGINX Docker Setup",permalink:"/docs/DevOps/NGINX/2020-08-26--nginx-docker-setup/2020-08-26"},next:{title:"Adding an OBS Stream to your Website",permalink:"/docs/DevOps/NGINX/2019-11-08--nginx-rtmp-website/2019-11-08"}},l={},c=[{value:"Apache on CentOS",id:"apache-on-centos",level:2},{value:"Installing Mod_Security and Mod_evasive",id:"installing-mod_security-and-mod_evasive",level:3},{value:"Configuring Mod_Security",id:"configuring-mod_security",level:3},{value:"Configuring Mod_Evasive",id:"configuring-mod_evasive",level:3},{value:"Apache on Debian",id:"apache-on-debian",level:2},{value:"NGINX",id:"nginx",level:2}],p={toc:c};function d(e){let{components:t,...i}=e;return(0,r.kt)("wrapper",(0,a.Z)({},p,i,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Central, Hong Kong",src:n(10849).Z,width:"1500",height:"614"})),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#apache-on-centos"},"Apache on CentOS"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#installing-mod_security-and-mod_evasive"},"Installing Mod_Security and Mod_evasive")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#configuring-mod_security"},"Configuring Mod_Security")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#configuring-mod_evasive"},"Configuring Mod_Evasive")))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#apache-on-debian"},"Apache on Debian")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#nginx"},"NGINX"))),(0,r.kt)("h2",{id:"apache-on-centos"},"Apache on CentOS"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"mod","_","security")," (",(0,r.kt)("a",{parentName:"p",href:"https://www.modsecurity.org"},"open-source intrusion detection and prevention engine for web applications")," that integrates seamlessly with the webserver) and ",(0,r.kt)("strong",{parentName:"p"},"mod","_","evasive")," are two very important tools that can be used to protect a web server against brute force or (D)DoS attacks."),(0,r.kt)("h3",{id:"installing-mod_security-and-mod_evasive"},"Installing Mod_Security and Mod_evasive"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"--------------- CentOS/RHEL 7 --------------- \nyum update && yum install mod_security mod_evasive\n\n--------------- CentOS/RHEL 8 --------------- \ndnf install https://pkgs.dyn.su/el8/base/x86_64/raven-release-1.0-1.el8.noarch.rpm\ndnf --enablerepo=raven-extras install mod_evasive\n")),(0,r.kt)("p",null,"When the installation is complete, you will find the configuration files for both tools in ",(0,r.kt)("inlineCode",{parentName:"p"},"/etc/httpd/conf.d"),". In order to integrate these two modules with Apache and have it load them when it starts, make sure the following lines appear in the top-level section of ",(0,r.kt)("inlineCode",{parentName:"p"},"mod_evasive.conf")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"mod_security.conf"),", respectively:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"LoadModule evasive20_module modules/mod_evasive24.so\nLoadModule security2_module modules/mod_security2.so\n")),(0,r.kt)("p",null,"Then restart Apache and verify that it loads mod_evasive and mod_security:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"systemctl restart httpd\n")),(0,r.kt)("p",null,"Dump a list of loaded Static and Shared Modules."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"httpd -M | grep -Ei '(evasive|security)'\n")),(0,r.kt)("h3",{id:"configuring-mod_security"},"Configuring Mod_Security"),(0,r.kt)("p",null,"A Core Rule Set provides the web server with instructions on how to behave under certain conditions. The developer firm of ",(0,r.kt)("strong",{parentName:"p"},"mod_security")," provides a free set called OWASP (",(0,r.kt)("a",{parentName:"p",href:"https://www.owasp.org/index.php/Category:OWASP_ModSecurity_Core_Rule_Set_Project"},"Open Web Application Security Project"),") ModSecurity CRS:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"mkdir /etc/httpd/crs && cd /etc/httpd/crs\nwget -c https://github.com/SpiderLabs/owasp-modsecurity-crs/archive/v3.2.0.tar.gz -O master\n\ntar xzf master\nmv owasp-modsecurity-crs-3.2.0 owasp\n\ncd owasp/\ncp crs-setup.conf.example crs-setup.conf\n")),(0,r.kt)("p",null,"tell Apache to use this file along with the module by inserting the following lines in the web server\u2019s main configuration file ",(0,r.kt)("inlineCode",{parentName:"p"},"/etc/httpd/conf/httpd.conf")," file:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-html"},"<IfModule security2_module>\n        Include crs/owasp/crs-setup.conf\n        Include crs/owasp/rules/*.conf\n</IfModule>\n")),(0,r.kt)("p",null,"Create your own configuration file within the ",(0,r.kt)("inlineCode",{parentName:"p"},"/etc/httpd/modsecurity.d")," directory where you can place ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/SpiderLabs/ModSecurity/wiki/Reference-Manual#Configuration_Directives"},"customized directives")," instead of modifying the CRS files directly ",(0,r.kt)("inlineCode",{parentName:"p"},"nano /etc/httpd/modsecurity.d/instar.conf"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-html"},"<IfModule mod_security2.c>\n    SecRuleEngine On\n    SecRequestBodyAccess On\n    SecResponseBodyAccess On \n    SecResponseBodyMimeType text/plain text/html text/xml application/octet-stream \n    SecDataDir /tmp\n</IfModule>\n")),(0,r.kt)("h3",{id:"configuring-mod_evasive"},"Configuring Mod_Evasive"),(0,r.kt)("p",null,"mod_evasive is configured using directives in ",(0,r.kt)("inlineCode",{parentName:"p"},"/etc/httpd/conf.d/mod_evasive.conf"),". The default ",(0,r.kt)("inlineCode",{parentName:"p"},"mod_evasive.conf")," file has the following directives enabled:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-html"},"<IfModule mod_evasive24.c>\n    DOSHashTableSize    3097\n    DOSPageCount        2\n    DOSSiteCount        50\n    DOSPageInterval     1\n    DOSSiteInterval     1\n    DOSBlockingPeriod   10\n</IfModule>\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"DOSHashTableSize"),": This directive specifies the size of the hash table that is used to keep track of activity on a per-IP address basis. Increasing this number will provide a faster lookup of the sites that the client has visited in the past, but may impact overall performance if it is set too high."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"DOSPageCount"),": Legitimate number of identical requests to a specific URI (for example, any file that is being served by Apache) that can be made by a visitor over the ",(0,r.kt)("strong",{parentName:"li"},"DOSPageInterval")," interval."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"DOSSiteCount"),": Similar to ",(0,r.kt)("strong",{parentName:"li"},"DOSPageCount"),", but refers to how many overall requests can be made to the entire site over the DOSSiteInterval interval."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"DOSBlockingPeriod"),": If a visitor exceeds the limits set by DOSSPageCount or DOSSiteCount, his source IP address will be blacklisted during the DOSBlockingPeriod amount of time. During DOSBlockingPeriod, any requests coming from that IP address will encounter a 403 Forbidden error.")),(0,r.kt)("h2",{id:"apache-on-debian"},"Apache on Debian"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://www.yourhowto.net/installing-mod_security-and-mod_evasive-on-debian/"},"https://www.yourhowto.net/installing-mod_security-and-mod_evasive-on-debian/")),(0,r.kt)("h2",{id:"nginx"},"NGINX"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://nginx.org/en/docs/http/ngx_http_limit_req_module.html"},"https://nginx.org/en/docs/http/ngx_http_limit_req_module.html")))}d.isMDXComponent=!0},10849:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/photo-kt443t6d_64hdh43hfh6dgjdfhg4_d-be28477133089bc5ae151be9db38fab6.jpg"}}]);