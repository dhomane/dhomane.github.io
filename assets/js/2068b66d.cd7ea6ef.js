"use strict";(self.webpackChunkmikes_dev_notebook=self.webpackChunkmikes_dev_notebook||[]).push([[72650],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>d});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},s=Object.keys(e);for(a=0;a<s.length;a++)n=s[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)n=s[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var p=a.createContext({}),i=function(e){var t=a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},u=function(e){var t=i(e.components);return a.createElement(p.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,s=e.originalType,p=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),m=i(n),d=r,h=m["".concat(p,".").concat(d)]||m[d]||c[d]||s;return n?a.createElement(h,o(o({ref:t},u),{},{components:n})):a.createElement(h,o({ref:t},u))}));function d(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var s=n.length,o=new Array(s);o[0]=m;var l={};for(var p in t)hasOwnProperty.call(t,p)&&(l[p]=t[p]);l.originalType=e,l.mdxType="string"==typeof e?e:r,o[1]=l;for(var i=2;i<s;i++)o[i]=n[i];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},61797:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>o,default:()=>c,frontMatter:()=>s,metadata:()=>l,toc:()=>i});var a=n(87462),r=(n(67294),n(3905));const s={sidebar_position:8070,slug:"2017-12-09",title:"Next.js Server Side Rendering",authors:"mpolinowski",tags:["Javascript","React","Next"]},o=void 0,l={unversionedId:"Development/Javascript/2017-12-09--next-start/index",id:"Development/Javascript/2017-12-09--next-start/index",title:"Next.js Server Side Rendering",description:"Tanna Island, Vanuatu",source:"@site/docs/Development/Javascript/2017-12-09--next-start/index.mdx",sourceDirName:"Development/Javascript/2017-12-09--next-start",slug:"/Development/Javascript/2017-12-09--next-start/2017-12-09",permalink:"/docs/Development/Javascript/2017-12-09--next-start/2017-12-09",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/Development/Javascript/2017-12-09--next-start/index.mdx",tags:[{label:"Javascript",permalink:"/docs/tags/javascript"},{label:"React",permalink:"/docs/tags/react"},{label:"Next",permalink:"/docs/tags/next"}],version:"current",sidebarPosition:8070,frontMatter:{sidebar_position:8070,slug:"2017-12-09",title:"Next.js Server Side Rendering",authors:"mpolinowski",tags:["Javascript","React","Next"]},sidebar:"tutorialSidebar",previous:{title:"Gatsby.js Knowledgebase",permalink:"/docs/Development/Javascript/2017-12-14--gatsby-wiki/2017-12-14"},next:{title:"React Router 4",permalink:"/docs/Development/Javascript/2017-12-07--react-router-4/2017-12-07"}},p={},i=[{value:"On my way to figure out to find the best way to deploy a React App",id:"on-my-way-to-figure-out-to-find-the-best-way-to-deploy-a-react-app",level:2},{value:"01 Basic Setup",id:"01-basic-setup",level:2},{value:"02 Styling",id:"02-styling",level:2},{value:"Example",id:"example",level:2},{value:"03 Bootstrap 4",id:"03-bootstrap-4",level:2},{value:"04 Advanced Routing",id:"04-advanced-routing",level:2}],u={toc:i};function c(e){let{components:t,...s}=e;return(0,r.kt)("wrapper",(0,a.Z)({},u,s,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Tanna Island, Vanuatu",src:n(36617).Z,width:"1500",height:"597"})),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/mpolinowski/next-start"},"Github")),(0,r.kt)("h1",{id:"nextjs"},"Next.js"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#nextjs"},"Next.js"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#on-my-way-to-figure-out-to-find-the-best-way-to-deploy-a-react-app"},"On my way to figure out to find the best way to deploy a React App")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#01-basic-setup"},"01 Basic Setup")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#02-styling"},"02 Styling")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#example"},"Example")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#03-bootstrap-4"},"03 Bootstrap 4")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#04-advanced-routing"},"04 Advanced Routing"))))),(0,r.kt)("h2",{id:"on-my-way-to-figure-out-to-find-the-best-way-to-deploy-a-react-app"},"On my way to figure out to find the best way to deploy a React App"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/mpolinowski/react-router-4"},"create-react-app")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/mpolinowski/gatsby-wiki"},"GatsbyJS")),(0,r.kt)("li",{parentName:"ol"},"Next.js")),(0,r.kt)("p",null,"Today I want to try out ",(0,r.kt)("a",{parentName:"p",href:"https://zeit.co/docs/examples/next"},"Next.js")," (",(0,r.kt)("a",{parentName:"p",href:"https://github.com/zeit/next.js"},"Github"),"). More specifically the new ",(0,r.kt)("a",{parentName:"p",href:"https://zeit.co/blog/next4"},"Next4")," release that includes ",(0,r.kt)("a",{parentName:"p",href:"https://reactjs.org/blog/2017/09/26/react-v16.0.html"},"React16")," and ",(0,r.kt)("a",{parentName:"p",href:"https://zeit.co/blog/next4"},"React Router 4")," - as I already gathered some ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/mpolinowski/react-router-4"},"positive experiences")," with those. There is also an update to ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/zeit/styled-jsx/releases/tag/2.0.1"},"Styled JSX 2"),", that now allows us to ",(0,r.kt)("strong",{parentName:"p"},"prop"),"-up our styles, to avoid having to overwrite defaults inline inside components - here the documented example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"export default ({ color }) => (\n    <div>\n      Hello there <span>my friend</span>\n      <style jsx>{`\n        /* this style only applies to the span within lexical scope */\n        span { color: ${color}; }\n      `}</style>\n    </div>\n  )\n")),(0,r.kt)("p",null,"There are many different ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/zeit/next.js/tree/master/examples"},"examples available")," to start building your App. All righty, lets go then!"),(0,r.kt)("hr",null),(0,r.kt)("p",null,(0,r.kt)("img",{src:n(19704).Z,width:"1257",height:"833"}),"\nThe final Application"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"TOC")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#nextjs"},"Next.js"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#on-my-way-to-figure-out-to-find-the-best-way-to-deploy-a-react-app"},"On my way to figure out to find the best way to deploy a React App")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#01-basic-setup"},"01 Basic Setup")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#02-styling"},"02 Styling")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#example"},"Example")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#03-bootstrap-4"},"03 Bootstrap 4")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#04-advanced-routing"},"04 Advanced Routing"))))),(0,r.kt)("h2",{id:"01-basic-setup"},"01 Basic Setup"),(0,r.kt)("p",null,"First create a directory for our app and ",(0,r.kt)("em",{parentName:"p"},"npm init -y")," it - then install Next.js and React:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"npm install next@latest react@latest react-dom@latest --save\n")),(0,r.kt)("p",null,"We can add the following npm scripts to the ",(0,r.kt)("strong",{parentName:"p"},"package.json")," file to make things easier:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},"'scripts': {\n    'dev': 'next',\n    'build': 'next build',\n    'start': 'next start'\n  }\n")),(0,r.kt)("p",null,"After that, the file-system is the main API. Every .js file becomes a route that gets automatically processed and rendered."),(0,r.kt)("p",null,"Populate ",(0,r.kt)("em",{parentName:"p"},"./pages/index.js")," inside your project:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"export default () => <div>Welcome to next.js!</div>\n")),(0,r.kt)("p",null,"and then just run npm run dev and go to http://localhost:3000. To use another port, you can run npm run dev -- -p 'your port here'."),(0,r.kt)("p",null,"So far, we get:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Automatic transpilation and bundling (with webpack and babel)"),(0,r.kt)("li",{parentName:"ul"},"Hot code reloading"),(0,r.kt)("li",{parentName:"ul"},"Server rendering and indexing of ./pages"),(0,r.kt)("li",{parentName:"ul"},"Static file serving. ./static/ is mapped to /static/"),(0,r.kt)("li",{parentName:"ul"},"Automatic code splitting - Every import you declare gets bundled and served with each page. That means pages never load unnecessary code!")),(0,r.kt)("h2",{id:"02-styling"},"02 Styling"),(0,r.kt)("p",null,"Next.js 4 bundles styled-jsx 2 to provide support for isolated scoped CSS - the ",(0,r.kt)("a",{parentName:"p",href:"https://www.npmjs.com/package/styled-jsx"},"documentation can be found here"),". A few examples are:"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"isolated scoped CSS")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"export default () => (\n  <div>\n    <p>only this paragraph will get the style :)</p>\n\n    { /* you can include <Component />s here that include\n         other <p>s that don't get unexpected styles! */ }\n\n    <style jsx>{`\n      p {\n        color: red;\n      }\n    `}</style>\n  </div>\n)\n")),(0,r.kt)("p",null,"Styles can be defined in separate JavaScript modules by tagging with css any template literal that contain CSS. css must be imported from styled-jsx/css:"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Keeping CSS in separate files")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"/* styles.js */\nimport css from 'styled-jsx/css'\n\nexport const button = css`button { color: purple; }`\nexport default css`div { color: teal; }`\n")),(0,r.kt)("p",null,"and imported as regular strings:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"import styles, { button } from './styles'\n\nexport default () => (\n  <div>\n    <button>styled-jsx</button>\n    <style jsx>{styles}</style>\n    <style jsx>{button}</style>\n  </div>\n)\n")),(0,r.kt)("p",null,"in this example all 'potential' \\<div",">","'s inside the components JSX - as well as the enclosing root \\<div",">"," is targeted by {styles}. If you just want to target the root:"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Targeting The Root")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"export default () => (\n  <div className='root'>\n    <style jsx>{`\n      .root {\n        color: green;\n      }\n    `}</style>\n  </div>\n)\n")),(0,r.kt)("p",null,"To skip scoping entirely, you can make the global-ness of your styles explicit by adding global:"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Global styles")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"export default () => (\n  <div>\n    <style jsx global>{`\n      body {\n        background: red\n      }\n    `}</style>\n  </div>\n)\n")),(0,r.kt)("p",null,"You can also use modifiers for your CSS classes to create components that can be called in different 'versions', e.g. \\<Button",">","Hi\\</Button",">"," or \\<Button large",">","Big\\</Button",">","."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"className toggling")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"const Button = (props) => (\n  <button className={ 'large' in props && 'large' }>\n     { props.children }\n     <style jsx>{`\n        button {\n          padding: 20px;\n          background: #eee;\n          color: #999\n        }\n        .large {\n          padding: 50px\n        }\n     `}</style>\n  </button>\n)\n")),(0,r.kt)("p",null,"You can override the CSS you configure via inline-styles:"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"inline style")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"const Button = ({ padding, children }) => (\n  <button style={{ padding }}>\n     { children }\n     <style jsx>{`\n        button {\n          padding: 20px;\n          background: #eee;\n          color: #999\n        }\n     `}</style>\n  </button>\n)\n")),(0,r.kt)("p",null,"In this example, the padding defaults to the one set in \\<style",">"," (20), but the user can pass a custom one via \\Button padding={30}","."),(0,r.kt)("p",null,"It is possible to use constants like so:"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Constants")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"import { colors, spacing } from '../theme'\nimport { invertColor } from '../theme/utils'\n\nconst Button = ({ children }) => (\n  <button>\n     { children }\n     <style jsx>{`\n        button {\n          padding: ${ spacing.medium };\n          background: ${ colors.primary };\n          color: ${ invertColor(colors.primary) };\n        }\n     `}</style>\n  </button>\n)\n")),(0,r.kt)("p",null,"or to pass them down by Props:"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Dynamic styles")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"const Button = (props) => (\n  <button>\n     { props.children }\n     <style jsx>{`\n        button {\n          padding: ${ 'large' in props ? '50' : '20' }px;\n          background: ${props.theme.background};\n          color: #999;\n          display: inline-block;\n          font-size: 1em;\n        }\n     `}</style>\n  </button>\n)\n")),(0,r.kt)("h2",{id:"example"},"Example"),(0,r.kt)("p",null,(0,r.kt)("em",{parentName:"p"},"./pages/index.js")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"import styles, { hipsterum, imagefloat } from './styles/hipsterum'\n\nexport default () =>\n  <div>\n\n    <h1>Welcome to next.js!</h1>\n    <h3>The awesome World of Server-side Rendering</h3>\n    <h5>lets see what this is all about</h5>\n    <img src='/static/test.png' className='imagefloat'/>\n    <p className='hipsterum'>\n      [ipsum...]\n    </p>\n\n    <style jsx>{`\n      h1, h5 {\n        color: white;\n      }\n      @media (max-width: 600px) {\n        h1, h5 {\n          color: black;\n        }\n      }\n    `}</style>\n\n    <style global jsx>{`\n      body {\n        background: black;\n      }\n      @media (max-width: 600px) {\n        body {\n          background-image: url('/static/test.png');\n        }\n      }\n    `}</style>\n\n    <style jsx>{styles}</style>\n    <style jsx>{imagefloat}</style>\n    <style jsx>{hipsterum}</style>\n\n  </div>\n")),(0,r.kt)("p",null,(0,r.kt)("em",{parentName:"p"},"./pages/styles/hipsterum.js")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"import css from 'styled-jsx/css'\n\nexport const hipsterum = css`.hipsterum {\n    color: blue;\n    text-align: justify;\n  }`\n\nexport const imagefloat = css`.imagefloat {\n    float:right;\n    margin-left:10px;\n  }`\n\nexport default css`h3 { color: red; }`\n")),(0,r.kt)("p",null,"This leads you to an style abomination that will make you cringe :) but uses all the important features of Style-JSX:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\\@media queries for responsive designs"),(0,r.kt)("li",{parentName:"ul"},"usage of static assets for your designs from the ",(0,r.kt)("em",{parentName:"li"},"./static")," folder"),(0,r.kt)("li",{parentName:"ul"},"inline css and separated css styles in their own files"),(0,r.kt)("li",{parentName:"ul"},"separation of styles into their own functions to allow you to import only necessary styles")),(0,r.kt)("h2",{id:"03-bootstrap-4"},"03 Bootstrap 4"),(0,r.kt)("p",null,"Trying to figure out the best way to add Bootstrap to the Mix - for now I will just add the CDN links to the layout Component in ",(0,r.kt)("em",{parentName:"p"},"./components/layout"),". This works just like the template component with React-Helmet in create-react-app:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"import Link from 'next/link'\nimport Head from 'next/head'\nimport NavBar from './navbar'\n\n\nexport default ({ children, title = 'This is the default title' }) => (\n  <div>\n    <Head>\n      <title>{ title }</title>\n      <meta charSet='utf-8' />\n      <meta name='viewport' content='initial-scale=1.0, width=device-width' />\n      <link rel='stylesheet' href='https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css' integrity='sha384-PsH8R72JQ3SOdhVi3uxftmaW6Vc51MKb0q5P2rRUpPvrszuE4W1povHYgTpBfshb' crossOrigin='anonymous' />\n    </Head>\n    <header>\n      <NavBar />\n    </header>\n\n      <div className='container'>\n        <div className='row'>\n          <br/><br/><br/><br/>\n          { children }\n        </div>\n      </div>\n\n    <footer>\n      {'I`m a Footer Component'}\n      <script src='https://code.jquery.com/jquery-3.2.1.slim.min.js' integrity='sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN' crossOrigin='anonymous' />\n      <script src='https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.3/umd/popper.min.js' integrity='sha384-vFJXuSJphROIrBnz7yo7oB41mKfc8JzQZiCq4NCceLEaO4IHwicKwpJf9c9IpFgh' crossOrigin='anonymous' />\n      <script src='https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/js/bootstrap.min.js' integrity='sha384-alpBpkh1PFOepccYVYDB4do5UnbKysX5WZXm3XxPqe5iKTfUKjNkCk9SaVuEZflJ' crossOrigin='anonymous' />\n    </footer>\n  </div>\n)\n")),(0,r.kt)("p",null,"As a first bootstrap component, I added the ",(0,r.kt)("strong",{parentName:"p"},"Bootstrap 4 Navbar")," we ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/mpolinowski/react-router-4/blob/master/src/index.js"},"created earlier")," and imported it into the header area above:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"import Link from 'next/link'\n\nconst NavBar = () => (\n  <div>\n    <nav className='navbar navbar-expand-md navbar-dark bg-dark fixed-top mb'>\n      <Link href='/'><a className='nav-item nav-link'><img src='/static/logo.svg' alt='INSTAR Wiki' /></a></Link>\n\n      <button className='navbar-toggler' type='button' data-toggle='collapse' data-target='#TopNavbar' aria-controls='navbarsExampleDefault' aria-expanded='false' aria-label='Toggle navigation'>\n        <span className='navbar-toggler-icon'></span>\n      </button>\n\n      <div className='collapse navbar-collapse' id='TopNavbar'>\n        <ul className='navbar-nav mr-auto'>\n          <li className='nav-item'>\n            <Link href='/page-1'><a className='nav-item nav-link'>Page 1</a></Link>\n          </li>\n          <li className='nav-item'>\n            <Link href='/page-2'><a className='nav-item nav-link'>Page 2</a></Link>\n          </li>\n          <li className='nav-item'>\n            <Link href='/nested-routes'><a className='nav-item nav-link'>Nested Routes</a></Link>\n          </li>\n        </ul>\n      </div>\n    </nav>\n  </div>\n)\n\nexport default NavBar\n")),(0,r.kt)("h2",{id:"04-advanced-routing"},"04 Advanced Routing"),(0,r.kt)("p",null,"As we already see, Next.js builds routes for each component it finds inside the ",(0,r.kt)("em",{parentName:"p"},"./pages")," directory. So our index component shows up at the root URL, without us having to do anything - sweet. But what if we need nested routes for our components - say ",(0,r.kt)("em",{parentName:"p"},"page01")," is a child of ",(0,r.kt)("em",{parentName:"p"},"chapter01")," and we want it to appear when we type in ",(0,r.kt)("em",{parentName:"p"},"localhost:3000/chapter01/page01")," ? There are two ways that I found so far:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"next-routes: a neat little ",(0,r.kt)("a",{parentName:"li",href:"https://www.npmjs.com/package/next-routes"},"npm module")," from also featured as an ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/zeit/next.js/tree/master/examples/with-next-routes"},"Example @Zeit"),"."),(0,r.kt)("li",{parentName:"ul"},"Using an Express.js webserver as featured ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/zeit/next.js/tree/master/examples/custom-server-express"},"@Zeit")," and ",(0,r.kt)("a",{parentName:"li",href:"https://medium.com/@diamondgfx/nextjs-lessons-learned-part-2-f1781237cf5c"},"@Medium"))),(0,r.kt)("p",null,(0,r.kt)("del",{parentName:"p"},"Lets try out ",(0,r.kt)("strong",{parentName:"del"},"next-routes")," for this example:")),(0,r.kt)("p",null,(0,r.kt)("del",{parentName:"p"},"npm install next-routes --save")," ","[...]"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Ok, this basically wrecked the whole application")),(0,r.kt)("p",null,"I will copy the code to ",(0,r.kt)("em",{parentName:"p"},"./next-routes-wtf")," and - maybe - try it again later... The result is very inconsistent. You can click on a link and the page loads just fine. If you click on the same link again, or just reload the page, or copy it's URL into another browser, you are very likely to end up seeing the 404 page."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Update")," It might just have been the way I linked components - the solution, that is coming up below, showed a similar behaviour, when you forget the 'as=' attribute in a link tag."),(0,r.kt)("p",null,"Ok - so lets try Express.js now, since I wanted to use it for deployment anyhow. ",(0,r.kt)("a",{parentName:"p",href:"https://medium.com/@diamondgfx/nextjs-lessons-learned-part-2-f1781237cf5c"},"Brandon Richey")," says, that he ran into the same problems I had with ",(0,r.kt)("em",{parentName:"p"},"next-routes"),", when using the ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/zeit/next.js/tree/master/examples"},"official documentation")," for the ",(0,r.kt)("em",{parentName:"p"},"custom server.js")," setup. So I will stay away from it for now and try his version."),(0,r.kt)("p",null,"First install ",(0,r.kt)("a",{parentName:"p",href:"http://expressjs.com"},"Express.js")," from npm:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"npm install --save express\n")),(0,r.kt)("p",null,"then create ",(0,r.kt)("em",{parentName:"p"},"./server.js"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"const express = require('express');\nconst { parse } = require('url');\nconst next = require('next');\n\nconst dev = process.env.NODE_ENV !== 'production';\nconst app = next({ dev });\nconst handle = app.getRequestHandler();\n\napp.prepare().then(() => {\n  const server = express();\n\n  // CUSTOM ROUTES GO HERE\n  server.get('/Products/:slug', (req, res) => {\n    const mergedQuery = Object.assign({}, req.query, req.params);\n    return app.render(req, res, '/Products', mergedQuery);\n  });\n\n  // THIS IS THE DEFAULT ROUTE, DON'T EDIT THIS\n  server.get('*', (req, res) => {\n    return handle(req, res);\n  });\n\n  const port = process.env.PORT || 3000;\n\n  server.listen(port, err => {\n    if (err) throw err;\n    console.log(`> Ready on port ${port}...`);\n  });\n});\n\n")),(0,r.kt)("p",null,"This will give you a param that gets sent to your blog.js component inside of your pages/ directory and give you the custom routing that you want! The client-side linking, assuming we have the route setup above /products/:slug, your links to specific slugs would need to be structure using next/link\u2019s Link component via the following:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"<Link href={`/base?slug=${slug}`} as={`/base/${slug}`} prefetch>\n  ...\n</Link>\n")),(0,r.kt)("p",null,"e.g."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"<Link href={`/Products?slug=${'Outdoor_Cameras'}`} as={`/Products/${'Outdoor_Cameras'}`} prefetch>\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"as")," is what the user will see in their browser, but ",(0,r.kt)("strong",{parentName:"p"},"href")," is what next.js will interpret to figure out how things need to get routed. ",(0,r.kt)("em",{parentName:"p"},"Both of these steps are required to make the link behavior and routing behavior behave the same no matter where the page is rendered from!")),(0,r.kt)("p",null,"Now create a Product component in ",(0,r.kt)("em",{parentName:"p"},"./pages/Products.js"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"import React from 'react'\n\nimport Layout from '../components/layout'\n\nconst posts = [\n  { slug: 'Indoor_Cameras', title: 'Indoor Cameras' },\n  { slug: 'Outdoor_Cameras', title: 'Outdoor Cameras' }\n]\n\nexport default class extends React.Component {\n  static async getInitialProps ({ query, res }) {\n    const post = posts.find(post => post.slug === query.slug)\n\n    if (!post && res) {\n      res.statusCode = 404\n    }\n\n    return { post }\n  }\n\n  render () {\n    const { post } = this.props\n\n    if (!post) return <Layout><h1>Products</h1></Layout>\n\n    return <Layout><h1>{post.title}</h1></Layout>\n  }\n}\n")),(0,r.kt)("p",null,"This will load the corresponding posts when you add the right slugs for it - ",(0,r.kt)("em",{parentName:"p"},"/Products/Outdoor_Cameras")," or ",(0,r.kt)("em",{parentName:"p"},"/Products/Indoor_Cameras")," or defaults to whatever you add here: ",(0,r.kt)("em",{parentName:"p"},"if (!post) return \\<Layout",">","\\<h1",">","Products\\</h1",">","\\</Layout",">")," in case that no match is found."),(0,r.kt)("p",null,"Finally, you\u2019ll need to modify your package.json file to include everything so that next.js knows how to run the server.js file:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},"'scripts': {\n  'build': 'next build',\n  'start': 'node server.js',\n}\n")),(0,r.kt)("p",null,"Now you can continue to run your dev server with npm run dev and you can build/start your production server as well!"))}c.isMDXComponent=!0},19704:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/next_01-c72355e5caf4ba73307188a90c410288.png"},36617:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/photo-34221454260_1d42dbe06f_o-395c2d2ad3e310ce338caa5e8314ebe8.png"}}]);