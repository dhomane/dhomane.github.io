"use strict";(self.webpackChunkmikes_dev_notebook=self.webpackChunkmikes_dev_notebook||[]).push([[50171],{3905:(e,t,a)=>{a.d(t,{Zo:()=>u,kt:()=>d});var n=a(67294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function s(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?s(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):s(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function p(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},s=Object.keys(e);for(n=0;n<s.length;n++)a=s[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(n=0;n<s.length;n++)a=s[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var i=n.createContext({}),l=function(e){var t=n.useContext(i),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},u=function(e){var t=l(e.components);return n.createElement(i.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},h=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,s=e.originalType,i=e.parentName,u=p(e,["components","mdxType","originalType","parentName"]),h=l(a),d=r,k=h["".concat(i,".").concat(d)]||h[d]||c[d]||s;return a?n.createElement(k,o(o({ref:t},u),{},{components:a})):n.createElement(k,o({ref:t},u))}));function d(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var s=a.length,o=new Array(s);o[0]=h;var p={};for(var i in t)hasOwnProperty.call(t,i)&&(p[i]=t[i]);p.originalType=e,p.mdxType="string"==typeof e?e:r,o[1]=p;for(var l=2;l<s;l++)o[l]=a[l];return n.createElement.apply(null,o)}return n.createElement.apply(null,a)}h.displayName="MDXCreateElement"},90709:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>i,contentTitle:()=>o,default:()=>c,frontMatter:()=>s,metadata:()=>p,toc:()=>l});var n=a(87462),r=(a(67294),a(3905));const s={sidebar_position:7090,slug:"2021-08-11",title:"Hashicorp Consul Refresher - Backups",authors:"mpolinowski",tags:["Consul","Linux"]},o=void 0,p={unversionedId:"DevOps/Hashicorp/2021-08-11--hashicorp-consul-backups/index",id:"DevOps/Hashicorp/2021-08-11--hashicorp-consul-backups/index",title:"Hashicorp Consul Refresher - Backups",description:"Shenzhen, China",source:"@site/docs/DevOps/Hashicorp/2021-08-11--hashicorp-consul-backups/index.md",sourceDirName:"DevOps/Hashicorp/2021-08-11--hashicorp-consul-backups",slug:"/DevOps/Hashicorp/2021-08-11--hashicorp-consul-backups/2021-08-11",permalink:"/docs/DevOps/Hashicorp/2021-08-11--hashicorp-consul-backups/2021-08-11",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/DevOps/Hashicorp/2021-08-11--hashicorp-consul-backups/index.md",tags:[{label:"Consul",permalink:"/docs/tags/consul"},{label:"Linux",permalink:"/docs/tags/linux"}],version:"current",sidebarPosition:7090,frontMatter:{sidebar_position:7090,slug:"2021-08-11",title:"Hashicorp Consul Refresher - Backups",authors:"mpolinowski",tags:["Consul","Linux"]},sidebar:"tutorialSidebar",previous:{title:"Hashicorp Consul Refresher - Service Mesh",permalink:"/docs/DevOps/Hashicorp/2021-08-12--hashicorp-consul-service-mesh/2021-08-12"},next:{title:"Hashicorp Consul Refresher - Key Value Store",permalink:"/docs/DevOps/Hashicorp/2021-08-10--hashicorp-consul-key-value-store/2021-08-10"}},i={},l=[{value:"Backup and Restoring through the CLI",id:"backup-and-restoring-through-the-cli",level:2},{value:"Backup",id:"backup",level:3},{value:"Inspect",id:"inspect",level:3},{value:"Restore",id:"restore",level:3},{value:"Snapshot HTTP Endpoint",id:"snapshot-http-endpoint",level:2},{value:"Backup",id:"backup-1",level:3},{value:"Restore",id:"restore-1",level:3}],u={toc:l};function c(e){let{components:t,...s}=e;return(0,r.kt)("wrapper",(0,n.Z)({},u,s,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Shenzhen, China",src:a(80882).Z,width:"1500",height:"392"})),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#backup-and-restoring-through-the-cli"},"Backup and Restoring through the CLI"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#backup"},"Backup")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#inspect"},"Inspect")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#restore"},"Restore")))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#snapshot-http-endpoint"},"Snapshot HTTP Endpoint"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#backup-1"},"Backup")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#restore-1"},"Restore"))))),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://www.consul.io/api-docs/snapshot"},"Consul Snapshots")," are exposed as gzipped tar archives which internally contain the Raft metadata required to restore, as well as a binary serialized version of the Consul server state. The contents are covered internally by SHA-256 hashes. These hashes are verified during snapshot restore operations. The structure of the archive is internal to Consul and not intended to be used other than for restore operations. The archives are not designed to be modified before a restore."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Snapshot Include"),":"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Key/Value entries"),(0,r.kt)("li",{parentName:"ul"},"Service catalogue"),(0,r.kt)("li",{parentName:"ul"},"Prepared queries"),(0,r.kt)("li",{parentName:"ul"},"Sessions"),(0,r.kt)("li",{parentName:"ul"},"ACLs")),(0,r.kt)("h2",{id:"backup-and-restoring-through-the-cli"},"Backup and Restoring through the CLI"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"consul snapshot")," command:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"inspect"),": View metadata of existing snapshot "),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"restore"),": Restore state from existing snapshot"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"save"),": Create new snapshot")),(0,r.kt)("p",null,"If you have ACLs enabled you need to provide your Consul token:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"export CONSUL_HTTP_TOKEN=sfsdfg-agdsf23-fszdsd-234sdgfv\n")),(0,r.kt)("h3",{id:"backup"},"Backup"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"consul snapshot save backup.snap\nSaved and verified snapshot to index 12749\n")),(0,r.kt)("h3",{id:"inspect"},"Inspect"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"consul snapshot inspect backup.snap\nID           290-12749-1630854104373\nSize         16350\nIndex        12749\nTerm         290\nVersion      1\n")),(0,r.kt)("h3",{id:"restore"},"Restore"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"consul snapshot restore backup.snap\nRestored snapshot\n")),(0,r.kt)("h2",{id:"snapshot-http-endpoint"},"Snapshot HTTP Endpoint"),(0,r.kt)("p",null,"The ",(0,r.kt)("a",{parentName:"p",href:"https://www.consul.io/api-docs/snapshot"},"/snapshot endpoint")," save and restore the state of the Consul servers for disaster recovery."),(0,r.kt)("h3",{id:"backup-1"},"Backup"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'curl --header "X-Consul-Token: sfsdfg-agdsf23-fszdsd-234sdgfv" http://192.168.2.110:8500/v1/snapshot?dc=instaryun -o snapshot.tgz\n')),(0,r.kt)("h3",{id:"restore-1"},"Restore"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'curl \\\n    --header "X-Consul-Token: sfsdfg-agdsf23-fszdsd-234sdgfv" \\\n    --request PUT \\\n    --data-binary @snapshot.tgz \\\n    http://192.168.2.110:8500/v1/snapshot\n')))}c.isMDXComponent=!0},80882:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/photo-kt443t6d_64hdh43hfh6dgjdfhg4_d-321f9c0c55e91eac633fc2998de5be4e.jpg"}}]);