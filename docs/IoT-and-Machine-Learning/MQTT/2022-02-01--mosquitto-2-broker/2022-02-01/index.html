<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-IoT-and-Machine-Learning/MQTT/2022-02-01--mosquitto-2-broker/index">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.2.0">
<title data-rh="true">Mosquitto v2 MQTT Broker on Debian Bullseye | Mike Polinowski</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://mpolinowski.github.io/docs/IoT-and-Machine-Learning/MQTT/2022-02-01--mosquitto-2-broker/2022-02-01"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Mosquitto v2 MQTT Broker on Debian Bullseye | Mike Polinowski"><meta data-rh="true" name="description" content="TST, Hong Kong"><meta data-rh="true" property="og:description" content="TST, Hong Kong"><link data-rh="true" rel="icon" href="/img/icons/favicon-32x32.png"><link data-rh="true" rel="canonical" href="https://mpolinowski.github.io/docs/IoT-and-Machine-Learning/MQTT/2022-02-01--mosquitto-2-broker/2022-02-01"><link data-rh="true" rel="alternate" href="https://mpolinowski.github.io/docs/IoT-and-Machine-Learning/MQTT/2022-02-01--mosquitto-2-broker/2022-02-01" hreflang="en"><link data-rh="true" rel="alternate" href="https://mpolinowski.github.io/docs/IoT-and-Machine-Learning/MQTT/2022-02-01--mosquitto-2-broker/2022-02-01" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Mike Polinowski RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Mike Polinowski Atom Feed">




<link rel="icon" href="/img/angular_momentum.png">
<link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="rgb(37,194,160)">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#000">
<link rel="apple-touch-icon" href="/img/angular_momentum.png">
<link rel="mask-icon" href="/img/angular_momentum.png" color="rgb(33,33,33)">
<meta name="msapplication-TileImage" content="/img/angular_momentum.png">
<meta name="msapplication-TileColor" content="#000">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-P74BDWF0C6"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-P74BDWF0C6",{})</script><link rel="stylesheet" href="/assets/css/styles.714c4925.css">
<link rel="preload" href="/assets/js/runtime~main.23698315.js" as="script">
<link rel="preload" href="/assets/js/main.2d20e69f.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/angular_momentum.png" alt="Mike Polinowski :: Dev Notebook" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/angular_momentum.png" alt="Mike Polinowski :: Dev Notebook" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Mike Polinowski</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/intro">Docs</a><a class="navbar__item navbar__link" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/docs/tags">Tags</a><a class="navbar__item navbar__link" href="/Search">Search</a><a href="https://mpolinowski.github.io/Personal" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">About<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/mpolinowski" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently dark mode)" aria-label="Switch between dark and light mode (currently dark mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/development">Development</a><button aria-label="Toggle the collapsible sidebar category &#x27;Development&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/devops">DevOps</a><button aria-label="Toggle the collapsible sidebar category &#x27;DevOps&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/category/internet-of-things--machine-learning">Internet-of-Things &amp; Machine Learning</a><button aria-label="Toggle the collapsible sidebar category &#x27;Internet-of-Things &amp; Machine Learning&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/machine-learning">Machine Learning</a><button aria-label="Toggle the collapsible sidebar category &#x27;Machine Learning&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/aiops">AIOps</a><button aria-label="Toggle the collapsible sidebar category &#x27;AIOps&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/home-automation">Home Automation</a><button aria-label="Toggle the collapsible sidebar category &#x27;Home Automation&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/docs/category/mqtt">MQTT</a><button aria-label="Toggle the collapsible sidebar category &#x27;MQTT&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/IoT-and-Machine-Learning/MQTT/2022-07-24-mosquitto-broker-cross-compilation/2022-07-24">Mosquitto Broker Docker Cross-Compile</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/IoT-and-Machine-Learning/MQTT/2022-07-23-mosquitto-broker-compilation/2022-07-23">Mosquitto Broker from Source</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/IoT-and-Machine-Learning/MQTT/2022-07-22-go-hello-world/2022-07-22">Go - MQTT Hello World</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/IoT-and-Machine-Learning/MQTT/2022-07-21-rust-hello-world/2022-07-21">Rust - MQTT Hello World</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/IoT-and-Machine-Learning/MQTT/2022-06-23-instar-mqtt-python-part-I/2022-06-23">INSTAR MQTTv5 with Python - Client Connection</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/IoT-and-Machine-Learning/MQTT/2022-03-30--mqtt-with-rabbit-mq/2022-03-30">MQTT with RabbitMQ</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/IoT-and-Machine-Learning/MQTT/2022-03-28--mqtt-message-server/2022-03-28">MQTT Message Server and Angular Frontend</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/IoT-and-Machine-Learning/MQTT/2022-03-27--build-mosquitto-from-source/2022-03-27">Building Eclipse Mosquitto v2 from Source</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/IoT-and-Machine-Learning/MQTT/2022-03-26--mqtt-clients/2022-03-26">MQTT Clients</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/IoT-and-Machine-Learning/MQTT/2022-02-01--mosquitto-2-broker/2022-02-01">Mosquitto v2 MQTT Broker on Debian Bullseye</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/IoT-and-Machine-Learning/MQTT/2021-09-12--golang-paho-mqtt/2021-09-12">Go Paho MQTT Client</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/IoT-and-Machine-Learning/MQTT/2019-08-11--mqtt-home-assistant/2019-08-11">MQTT Networks with Home Assistant</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/IoT-and-Machine-Learning/MQTT/2019-08-10--mqtt-athom-homey/2019-08-10">MQTT Networks with Athom Homey</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/IoT-and-Machine-Learning/MQTT/2019-08-09--mqtt-homee/2019-08-09">MQTT Networks with homee</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/IoT-and-Machine-Learning/MQTT/2019-08-08--mqtt-homematic/2019-08-08">MQTT Networks with Homematic</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/IoT-and-Machine-Learning/MQTT/2019-08-07--mqtt-iobroker/2019-08-07">MQTT Networks with ioBroker</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/IoT-and-Machine-Learning/MQTT/2019-08-06--mqtt-node-red/2019-08-06">MQTT Networks with Node-RED</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/IoT-and-Machine-Learning/MQTT/2019-08-05--mqtt-openhab2/2019-08-05">MQTT Networks with OpenHAB 2</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/IoT-and-Machine-Learning/MQTT/2019-08-04--mqtt-android-dashboards/2019-08-04">MQTT Android Dashboards</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/IoT-and-Machine-Learning/MQTT/2019-08-03--mqtt-debugging/2019-08-03">Debugging MQTT Sensor Networks</a></li></ul></li></ul></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/internet-of-things--machine-learning"><span itemprop="name">Internet-of-Things &amp; Machine Learning</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/mqtt"><span itemprop="name">MQTT</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Mosquitto v2 MQTT Broker on Debian Bullseye</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Mosquitto v2 MQTT Broker on Debian Bullseye</h1></header><p><img loading="lazy" alt="TST, Hong Kong" src="/assets/images/photo-kt443t6d_64hdh43hfh6dgjdfhg4_d-027d6cb82627f4093030484d7bfca6fd.jpg" width="2385" height="978" class="img_ev3q"></p><ul><li><a href="#install-mosquitto-on-debian-bullseye">Install Mosquitto on Debian Bullseye</a></li><li><a href="#configure-mosquitto">Configure Mosquitto</a></li><li><a href="#verify-that-the-broker-is-working">Verify that the Broker is working</a><ul><li><a href="#mosquitto-cli-tools">Mosquitto CLI Tools</a></li><li><a href="#connecting-clients">Connecting Clients</a></li></ul></li><li><a href="#websockets">Websockets</a><ul><li><a href="#mqtt-explorer">MQTT Explorer</a></li><li><a href="#mqttjs-web-client">MQTT.js Web Client</a></li></ul></li><li><a href="#mosquitto-webserver">Mosquitto Webserver</a></li><li><a href="#adding-encryption">Adding Encryption</a><ul><li><a href="#creating-self-signed-certificates">Creating Self-Signed Certificates</a><ul><li><a href="#ca-certificates">CA Certificates</a></li><li><a href="#server-certificates">Server Certificates</a></li><li><a href="#mosquitto-server-configuration">Mosquitto Server Configuration</a></li><li><a href="#testing-the-connection">Testing the Connection</a></li><li><a href="#client-certificates">Client Certificates</a></li><li><a href="#creating-a-client-certificate">Creating a client certificate</a></li><li><a href="#update-the-mosquitto-server-configuration">Update the Mosquitto Server Configuration</a></li><li><a href="#testing-the-connection-1">Testing the Connection</a></li></ul></li></ul></li><li><a href="#connect-your-instar-ip-camera">Connect your INSTAR IP Camera</a></li></ul><p>Mosquitto is a message broker that implements the MQTT protocol. Mosquitto is an open-source project developed by Eclipse. MQTT protocol uses a publish/subscribe model. Client can publish message to a broker and other clients can subscribe to the topic of that message. A broker is a central component that receives all messages from the clients and then publishes the messages to all subscribed clients.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="install-mosquitto-on-debian-bullseye">Install Mosquitto on Debian Bullseye<a class="hash-link" href="#install-mosquitto-on-debian-bullseye" title="Direct link to heading">​</a></h2><blockquote><p>Check <a href="/docs/IoT-and-Machine-Learning/MQTT/2022-03-27--build-mosquitto-from-source/2022-03-27">Building Eclipse Mosquitto v2 from Source</a> for building the broker from it&#x27;s source code under Arch Linux.</p></blockquote><p>Add the Mosquitto repository:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">wget</span><span class="token plain"> http://repo.mosquitto.org/debian/mosquitto-repo.gpg.key</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> apt-key </span><span class="token function" style="color:rgb(80, 250, 123)">add</span><span class="token plain"> mosquitto-repo.gpg.key</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">cd</span><span class="token plain"> /etc/apt/sources.list.d/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">wget</span><span class="token plain"> http://repo.mosquitto.org/debian/mosquitto-bullseye.list</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Install Mosquitto broker:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">apt</span><span class="token plain"> update</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">apt</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">install</span><span class="token plain"> mosquitto</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Check Mosquitto version:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">mosquitto -h </span><span class="token operator">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">grep</span><span class="token plain"> version</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">mosquitto version </span><span class="token number">2.0</span><span class="token plain">.14</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Check if Mosquitto service is running:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">service</span><span class="token plain"> mosquitto status                                                                                              </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">● mosquitto.service - Mosquitto MQTT Broker</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     Loaded: loaded </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">/lib/systemd/system/mosquitto.service</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> enabled</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> vendor preset: enabled</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     Active: active </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">running</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> since Sat </span><span class="token number">2022</span><span class="token plain">-02-05 </span><span class="token number">14</span><span class="token plain">:06:50 HKT</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> 25min ago</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">       Docs: man:mosquitto.conf</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">5</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">             man:mosquitto</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">8</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    Process: </span><span class="token number">574</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">ExecStartPre</span><span class="token operator">=</span><span class="token plain">/bin/mkdir -m </span><span class="token number">740</span><span class="token plain"> -p /var/log/mosquitto </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">code</span><span class="token operator">=</span><span class="token plain">exited, </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">status</span><span class="token operator">=</span><span class="token number">0</span><span class="token plain">/SUCCESS</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    Process: </span><span class="token number">586</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">ExecStartPre</span><span class="token operator">=</span><span class="token plain">/bin/chown mosquitto /var/log/mosquitto </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">code</span><span class="token operator">=</span><span class="token plain">exited, </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">status</span><span class="token operator">=</span><span class="token number">0</span><span class="token plain">/SUCCESS</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    Process: </span><span class="token number">593</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">ExecStartPre</span><span class="token operator">=</span><span class="token plain">/bin/mkdir -m </span><span class="token number">740</span><span class="token plain"> -p /run/mosquitto </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">code</span><span class="token operator">=</span><span class="token plain">exited, </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">status</span><span class="token operator">=</span><span class="token number">0</span><span class="token plain">/SUCCESS</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    Process: </span><span class="token number">598</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">ExecStartPre</span><span class="token operator">=</span><span class="token plain">/bin/chown mosquitto /run/mosquitto </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">code</span><span class="token operator">=</span><span class="token plain">exited, </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">status</span><span class="token operator">=</span><span class="token number">0</span><span class="token plain">/SUCCESS</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   Main PID: </span><span class="token number">599</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">mosquitto</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      Tasks: </span><span class="token number">1</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">limit: </span><span class="token number">9357</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     Memory: </span><span class="token number">3</span><span class="token plain">.6M</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        CPU: </span><span class="token number">1</span><span class="token plain">.184s</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     CGroup: /system.slice/mosquitto.service</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">             └─599 /usr/sbin/mosquitto -c /etc/mosquitto/mosquitto.conf</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Feb 05 </span><span class="token number">14</span><span class="token plain">:06:49 nomad-minion systemd</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain">: Starting Mosquitto MQTT Broker</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Feb 05 </span><span class="token number">14</span><span class="token plain">:06:50 nomad-minion mosquitto</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">599</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain">: </span><span class="token number">1644041210</span><span class="token plain">: Loading config </span><span class="token function" style="color:rgb(80, 250, 123)">file</span><span class="token plain"> /etc/mosquitto/conf.d/custom.conf</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Feb 05 </span><span class="token number">14</span><span class="token plain">:06:50 nomad-minion systemd</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain">: Started Mosquitto MQTT Broker.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Here I can see that the Mosquitto binary was installed in <code>/usr/sbin</code> and it is being started with a default configuration file in <code>/etc/mosquitto/mosquitto.conf</code>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="configure-mosquitto">Configure Mosquitto<a class="hash-link" href="#configure-mosquitto" title="Direct link to heading">​</a></h2><p>Mosquitto installs 5 further tools that we can use with our broker:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">ls</span><span class="token plain"> -la /usr/bin </span><span class="token operator">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">grep</span><span class="token plain"> mosquitto</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-rwxr-xr-x  </span><span class="token number">1</span><span class="token plain"> root root        </span><span class="token number">60448</span><span class="token plain"> Jun  </span><span class="token number">9</span><span class="token plain">  </span><span class="token number">2021</span><span class="token plain"> mosquitto_ctrl</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-rwxr-xr-x  </span><span class="token number">1</span><span class="token plain"> root root        </span><span class="token number">31456</span><span class="token plain"> Jun  </span><span class="token number">9</span><span class="token plain">  </span><span class="token number">2021</span><span class="token plain"> mosquitto_passwd</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-rwxr-xr-x  </span><span class="token number">1</span><span class="token plain"> root root        </span><span class="token number">60296</span><span class="token plain"> Jun  </span><span class="token number">9</span><span class="token plain">  </span><span class="token number">2021</span><span class="token plain"> mosquitto_pub</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-rwxr-xr-x  </span><span class="token number">1</span><span class="token plain"> root root        </span><span class="token number">64608</span><span class="token plain"> Jun  </span><span class="token number">9</span><span class="token plain">  </span><span class="token number">2021</span><span class="token plain"> mosquitto_rr</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-rwxr-xr-x  </span><span class="token number">1</span><span class="token plain"> root root        </span><span class="token number">64608</span><span class="token plain"> Jun  </span><span class="token number">9</span><span class="token plain">  </span><span class="token number">2021</span><span class="token plain"> mosquitto_sub</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Password file can be created using <code>mosquitto_passwd</code> tool:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">mosquitto_passwd -c /etc/mosquitto/password_file admin</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Password: instar</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Reenter password: instar</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>First argument is path to a file, second argument is username. The <code>-c</code> option means that new password file will be created. Run the following command and enter a password for the user.</p><p>Next, open Mosquitto configuration file:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">cat</span><span class="token plain"> /etc/mosquitto/mosquitto.conf</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Place your local configuration in /etc/mosquitto/conf.d/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># A full description of the configuration file is at</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># /usr/share/doc/mosquitto/examples/mosquitto.conf.example</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">pid_file /run/mosquitto/mosquitto.pid</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">persistence </span><span class="token boolean">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">persistence_location /var/lib/mosquitto/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">log_dest </span><span class="token function" style="color:rgb(80, 250, 123)">file</span><span class="token plain"> /var/log/mosquitto/mosquitto.log</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">include_dir /etc/mosquitto/conf.d</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Here I can see that the &quot;actual&quot; configuration file, the one that I need to edit, must be located in <code>/etc/mosquitto/conf.d</code>. So let&#x27;s take a look:</p><p><strong>/etc/mosquitto/conf.d/custom.conf</strong></p><div class="language-conf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-conf codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># =================================================================</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># General configuration</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># =================================================================</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># per_listener_settings false</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># allow_zero_length_clientid true</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">auto_id_prefix zeroid-</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># check_retain_source true</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#max_inflight_bytes 0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#max_inflight_messages 20</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#max_keepalive 65535</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#max_packet_size 0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#max_queued_bytes 0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#max_qos 2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#max_queued_messages 1000</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#memory_limit 0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#message_size_limit 0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">persistent_client_expiration 7d</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># pid_file /var/run/mosquitto/mosquitto.pid</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">queue_qos0_messages true</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#retain_available true</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#set_tcp_nodelay false</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#sys_interval 10</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#upgrade_outgoing_qos false</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#user mosquitto</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># =================================================================</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Listeners</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># =================================================================</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">listener 1883</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">protocol mqtt</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">listener 1885</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">protocol websockets</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#socket_domain</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#bind_interface</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#http_dir</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#max_connections -1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#mount_point</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#use_username_as_clientid</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#websockets_headers_size</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># -----------------------------------------------------------------</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Certificate based SSL/TLS support</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># -----------------------------------------------------------------</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#certfile</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#keyfile</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#ciphers</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#ciphers_tls1.3</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#crlfile</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#dhparamfile</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#require_certificate false</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#cafile</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#capath</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#use_identity_as_username false</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># -----------------------------------------------------------------</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Pre-shared-key based SSL/TLS support</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># -----------------------------------------------------------------</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#psk_hint</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#ciphers</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#use_identity_as_username false</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># =================================================================</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Persistence</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># =================================================================</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#autosave_interval 1800</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#autosave_on_changes false</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#persistence false</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#persistence_file mosquitto.db</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#persistence_location</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># =================================================================</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Logging</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># =================================================================</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#log_dest stderr</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">log_type error</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">log_type warning</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">log_type notice</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">log_type information</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">connection_messages true</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#log_facility</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">log_timestamp true</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">log_timestamp_format %Y-%m-%dT%H:%M:%S</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#websockets_log_level 0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># =================================================================</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Security</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># =================================================================</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#clientid_prefixes</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">allow_anonymous false</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># -----------------------------------------------------------------</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Default authentication and topic access control</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># -----------------------------------------------------------------</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">password_file /etc/mosquitto/passwordfile</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">acl_file /etc/mosquitto/acl.file</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># -----------------------------------------------------------------</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># External authentication and topic access plugin options</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># -----------------------------------------------------------------</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># auth_plugin</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># auth_opt_db_host</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># auth_opt_db_port</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># auth_opt_db_username</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># auth_opt_db_password</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># =================================================================</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Bridges</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># =================================================================</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#connection &lt;name&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#address &lt;host&gt;[:&lt;port&gt;] [&lt;host&gt;[:&lt;port&gt;]]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#topic &lt;topic&gt; [[[out | in | both] qos-level] local-prefix remote-prefix]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#bridge_bind_address</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#bridge_attempt_unsubscribe true</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#bridge_protocol_version mqttv311</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#idle_timeout 60</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#keepalive_interval 60</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#local_clientid</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#notifications true</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#notification_topic</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#remote_clientid</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#remote_password</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#remote_username</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># restart_timeout 20</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># restart_timeout 10 30</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#restart_timeout 5 30</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#round_robin false</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#start_type automatic</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#threshold 10</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#try_private true</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#bridge_outgoing_retain true</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#bridge_max_packet_size 0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># -----------------------------------------------------------------</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Certificate based SSL/TLS support</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># -----------------------------------------------------------------</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#bridge_cafile</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#bridge_capath</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#bridge_alpn</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#bridge_insecure false</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#bridge_certfile</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#bridge_keyfile</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># -----------------------------------------------------------------</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># PSK based SSL/TLS support</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># -----------------------------------------------------------------</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#bridge_identity</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#bridge_psk</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># =================================================================</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># External config files</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># =================================================================</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#include_dir</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Make changes as needed and restart the Mosquitto service with:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">service</span><span class="token plain"> mosquitto restart </span><span class="token operator">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">service</span><span class="token plain"> mosquitto status</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="verify-that-the-broker-is-working">Verify that the Broker is working<a class="hash-link" href="#verify-that-the-broker-is-working" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="mosquitto-cli-tools">Mosquitto CLI Tools<a class="hash-link" href="#mosquitto-cli-tools" title="Direct link to heading">​</a></h3><p>Verify that the broker is working using the Mosquitto subscription and publication tools:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">mosquitto_sub  -h localhost -p </span><span class="token number">1883</span><span class="token plain"> -u admin -P instar -v -t </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;$SYS/broker/uptime&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$SYS</span><span class="token plain">/broker/uptime </span><span class="token number">1089</span><span class="token plain"> seconds</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$SYS</span><span class="token plain">/broker/uptime </span><span class="token number">1100</span><span class="token plain"> seconds</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$SYS</span><span class="token plain">/broker/uptime </span><span class="token number">1111</span><span class="token plain"> seconds</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Subscribing to <code>$SYS/broker/uptime</code> will give you the broker uptime in an 10s interval (interval can be adjusted in the mosquitto config).</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="connecting-clients">Connecting Clients<a class="hash-link" href="#connecting-clients" title="Direct link to heading">​</a></h3><p>And to something more exciting - I will connect an INSTAR IP camera:</p><p><img loading="lazy" alt="Mosquitto2 MQTT Broker" src="/assets/images/Mosquitto2_Broker_01-5ae8f61bf9ebcd9af6fad332db059338.png" width="1133" height="714" class="img_ev3q"></p><p>And send an update to switch the <em>privacy area 1</em> on and off again using the command topic:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">mosquitto_pub -h </span><span class="token number">192.168</span><span class="token plain">.2.111 -p </span><span class="token number">1883</span><span class="token plain"> -u admin -P instar -t </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;cameras/117/multimedia/privacy/region1/enable&#x27;</span><span class="token plain"> -m </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;{&quot;val&quot;:&quot;1&quot;}&#x27;</span><span class="token plain"> -d</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Client </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">null</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> sending CONNECT</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Client </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">null</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> received CONNACK </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Client </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">null</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> sending PUBLISH </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">d0, q0, r0, m1, </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;cameras/117/multimedia/privacy/region1/enable&#x27;</span><span class="token plain">, </span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain">. </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">11</span><span class="token plain"> bytes</span><span class="token punctuation" style="color:rgb(248, 248, 242)">))</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Client </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">null</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> sending DISCONNECT</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">mosquitto_pub -h </span><span class="token number">192.168</span><span class="token plain">.2.111 -p </span><span class="token number">1883</span><span class="token plain"> -u admin -P instar -t </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;cameras/117/multimedia/privacy/region1/enable&#x27;</span><span class="token plain"> -m </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;{&quot;val&quot;:&quot;0&quot;}&#x27;</span><span class="token plain"> -d</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Client </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">null</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> sending CONNECT</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Client </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">null</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> received CONNACK </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Client </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">null</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> sending PUBLISH </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">d0, q0, r0, m1, </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;cameras/117/multimedia/privacy/region1/enable&#x27;</span><span class="token plain">, </span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain">. </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">11</span><span class="token plain"> bytes</span><span class="token punctuation" style="color:rgb(248, 248, 242)">))</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Client </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">null</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> sending DISCONNECT</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Subscribing to the status topic I can see that the command was executed as expected:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">mosquitto_sub -h localhost -p </span><span class="token number">1883</span><span class="token plain"> -u admin -P instar -v -t </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;cameras/117/status/multimedia/privacy/region1/enable&#x27;</span><span class="token plain">    </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">cameras/117/status/multimedia/privacy/region1/enable </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;val&quot;</span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">:</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;1&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">cameras/117/status/multimedia/privacy/region1/enable </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;val&quot;</span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">:</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" alt="Mosquitto2 MQTT Broker" src="/assets/images/Mosquitto2_Broker_02-09a6355ecc5ebebc65ee7216a34b483c.png" width="1020" height="736" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="websockets">Websockets<a class="hash-link" href="#websockets" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="mqtt-explorer">MQTT Explorer<a class="hash-link" href="#mqtt-explorer" title="Direct link to heading">​</a></h3><p>So far I have been using the configured default listener on port <code>1885</code> using the <strong>MQTT</strong> protocol. But I added an additional listener on port <code>8885</code> that requires a websocket connection:</p><div class="language-conf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-conf codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># =================================================================</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Listeners</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># =================================================================</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">listener 1883</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">protocol mqtt</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">listener 1885</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">protocol websockets</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In the <a href="https://mqtt-explorer.com/" target="_blank" rel="noopener noreferrer">MQTT Explorer</a> you can switch the used protocol to <code>ws</code> to test the service:</p><p><img loading="lazy" alt="Mosquitto2 MQTT Broker" src="/assets/images/Mosquitto2_Broker_03-80d58d8c03492fe75d935556dd1ff3fb.png" width="1016" height="734" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="mqttjs-web-client">MQTT.js Web Client<a class="hash-link" href="#mqttjs-web-client" title="Direct link to heading">​</a></h3><p>Using a <a href="/docs/Development/Javascript/2021-06-04--mqtt-dashboard-react/2021-06-04">MQTT.js React Dashboard</a> to connect to the WS service:</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword module" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> </span><span class="token imports maybe-class-name">React</span><span class="token imports punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token imports"> </span><span class="token imports punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token imports"> useState</span><span class="token imports punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token imports"> </span><span class="token imports maybe-class-name">Fragment</span><span class="token imports"> </span><span class="token imports punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"> </span><span class="token keyword module" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;react&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword module" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;./App.css&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">var</span><span class="token plain"> mqtt </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">require</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;mqtt&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">var</span><span class="token plain"> options </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token literal-property property">protocol</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;ws&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token literal-property property">username</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;admin&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token literal-property property">password</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;instar&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">// clientId uniquely identifies client</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">// choose any string you wish</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token literal-property property">clientId</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;mqttjs_&#x27;</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> </span><span class="token known-class-name class-name">Math</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">random</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">toString</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">16</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">substr</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">8</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">var</span><span class="token plain"> client  </span><span class="token operator">=</span><span class="token plain"> mqtt</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">connect</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;ws://192.168.2.111:1885&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> options</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// Get Broker Uptime MQTT topic</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">client</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">subscribe</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;$SYS/broker/uptime&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">function</span><span class="token plain"> </span><span class="token function maybe-class-name" style="color:rgb(80, 250, 123)">App</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">var</span><span class="token plain"> note</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  client</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">on</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;message&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">function</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token parameter">topic</span><span class="token parameter punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token parameter"> message</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    note </span><span class="token operator">=</span><span class="token plain"> message</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">toString</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">// Updates React state with message </span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token function" style="color:rgb(80, 250, 123)">setMsg</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">note</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">log</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">note</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    client</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">end</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token comment" style="color:rgb(98, 114, 164)">// Sets default React state </span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">msg</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> setMsg</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">useState</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token operator">&lt;</span><span class="token maybe-class-name">Fragment</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token plain">em</span><span class="token operator">&gt;</span><span class="token plain">connecting</span><span class="token spread operator">...</span><span class="token operator">&lt;</span><span class="token operator">/</span><span class="token plain">em</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span><span class="token maybe-class-name">Fragment</span><span class="token operator">&gt;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword control-flow" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token operator">&lt;</span><span class="token plain">div className</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;App&quot;</span><span class="token operator">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token operator">&lt;</span><span class="token plain">header className</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;App-header&quot;</span><span class="token operator">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token operator">&lt;</span><span class="token plain">h1</span><span class="token operator">&gt;</span><span class="token maybe-class-name">Mosquitto</span><span class="token plain"> </span><span class="token maybe-class-name">Broker</span><span class="token operator">&lt;</span><span class="token operator">/</span><span class="token plain">h1</span><span class="token operator">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token operator">&lt;</span><span class="token plain">p</span><span class="token operator">&gt;</span><span class="token maybe-class-name">Uptime</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain">msg</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token operator">&lt;</span><span class="token operator">/</span><span class="token plain">p</span><span class="token operator">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token operator">&lt;</span><span class="token operator">/</span><span class="token plain">header</span><span class="token operator">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token operator">&lt;</span><span class="token operator">/</span><span class="token plain">div</span><span class="token operator">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword module" style="color:rgb(189, 147, 249);font-style:italic">export</span><span class="token plain"> </span><span class="token keyword module" style="color:rgb(189, 147, 249);font-style:italic">default</span><span class="token plain"> </span><span class="token maybe-class-name">App</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" alt="Mosquitto2 MQTT Broker" src="/assets/images/Mosquitto2_Broker_04-c2a81f5b204350f8144843088eedfe96.png" width="1184" height="883" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="mosquitto-webserver">Mosquitto Webserver<a class="hash-link" href="#mosquitto-webserver" title="Direct link to heading">​</a></h2><p>When a listener is using the websockets protocol, it is possible to serve http data as well. Set <code>http_dir</code> to a directory which contains the files you wish to serve. If this option is not specified, then no normal http connections will be possible. Let&#x27;s add this third listener to the configuration file:</p><div class="language-conf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-conf codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># =================================================================</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Listeners</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># =================================================================</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">listener 1883</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">protocol mqtt</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">listener 1885</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">protocol websockets</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">listener 8080</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">protocol websockets</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">http_dir /opt/mqtt-tree</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>I am going to use this <a href="https://github.com/mpolinowski/d3-MQTT-Topic-Tree" target="_blank" rel="noopener noreferrer">D3 Tree</a> from <code>@hardillb</code> and download to <code>/opt/mqtt-tree</code>. All I need to add the the <code>./index.html</code> file is the Mosquitto WS URL, Port and the broker login to display a tree view of all registered topics:</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">var</span><span class="token plain"> options </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token comment" style="color:rgb(98, 114, 164)">// host: location.hostname,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token comment" style="color:rgb(98, 114, 164)">// port: parseInt(location.port),</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token literal-property property">host</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;192.168.2.111&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token literal-property property">port</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">1885</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token literal-property property">clientID</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;web&quot;</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">new</span><span class="token plain"> </span><span class="token class-name">Date</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">getTime</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token literal-property property">connectOpts</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token literal-property property">userName</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;admin&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token literal-property property">password</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;instar&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">// useSSL: true,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token literal-property property">keepAliveInterval</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">30</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token literal-property property">timeout</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">10</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token literal-property property">cleanSession</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token literal-property property">onSuccess</span><span class="token operator">:</span><span class="token plain"> onConnect</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token literal-property property">onFailure</span><span class="token operator">:</span><span class="token plain"> onFailure</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Restart the Mosquitto service and visit the broker IP on port <code>8080</code> with your web browser:</p><p><img loading="lazy" alt="Mosquitto2 MQTT Broker" src="/assets/images/Mosquitto2_Broker_05-0fb5a1b5a2b1e93e1b1400b0d83a9bf4.png" width="929" height="713" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="adding-encryption">Adding Encryption<a class="hash-link" href="#adding-encryption" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="creating-self-signed-certificates">Creating Self-Signed Certificates<a class="hash-link" href="#creating-self-signed-certificates" title="Direct link to heading">​</a></h3><p><strong>Client Requirements</strong></p><ul><li>A CA (certificate authority) certificate of the CA that has signed the server certificate on the Mosquitto Broker.</li></ul><p><strong>Broker Requirements</strong></p><ul><li>CA certificate of the CA that has signed the server certificate on the Mosquitto Broker.</li><li>CA certificated server certificate.</li><li>Server Private key for decryption.</li></ul><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">openssl version</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">OpenSSL </span><span class="token number">1.1</span><span class="token plain">.1l  </span><span class="token number">24</span><span class="token plain"> Aug </span><span class="token number">2021</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Mosquitto already creates a directory for self-signed certificates - if it does not exists create it with:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">mkdir</span><span class="token plain"> -p /etc/mosquitto/certs</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">chown</span><span class="token plain"> mosquitto:mosquitto /etc/mosquitto/certs</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="ca-certificates">CA Certificates<a class="hash-link" href="#ca-certificates" title="Direct link to heading">​</a></h4><p>m</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token builtin class-name" style="color:rgb(189, 147, 249)">cd</span><span class="token plain"> /etc/mosquitto/certs</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">openssl genrsa -out ca.key </span><span class="token number">4096</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Important</strong>: The FQDN must not be the same as the <strong>server FQDN</strong>, otherwise you might end up with SSL errors. On a local network using a AVM Fritzbox router every device receives both a hostname - for example my Mosquitto server identifies as <code>debian11</code> - and a domain name hostname + <code>.fritz.box</code>. So, for example, I am able to access the Mosquitto webserver via <code>http://debian11.fritz.box:8080/</code>:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">openssl req -new -x509 -days </span><span class="token number">1825</span><span class="token plain"> -key ca.key -out ca.crt</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">You are about to be asked to enter information that will be incorporated</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">into your certificate request.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">What you are about to enter is what is called a Distinguished Name or a DN.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">There are quite a few fields but you can leave some blank</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">For some fields there will be a default value,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">If you enter </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;.&#x27;</span><span class="token plain">, the field will be left blank.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-----</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Country Name </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">2</span><span class="token plain"> letter code</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">AU</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain">:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">State or Province Name </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">full name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">Some-State</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain">:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Locality Name </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">eg, city</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain">:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Organization Name </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">eg, company</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">Internet Widgits Pty Ltd</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain">:INSTAR</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Organizational Unit Name </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">eg, section</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain">:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Common Name </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">e.g. server FQDN or YOUR name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain">:debian11.fritz.box</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Email Address </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain">:</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">chown</span><span class="token plain"> mosquitto:mosquitto ca.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain">crt,key</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="server-certificates">Server Certificates<a class="hash-link" href="#server-certificates" title="Direct link to heading">​</a></h4><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">openssl genrsa -out server.key </span><span class="token number">4096</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Important</strong>: Here the FQDN must be the <strong>hostname</strong>, otherwise you might end up with SSL errors. As mentioned above my server can be reached via the hostname <code>debian11</code> - I can test this by visiting the mosquitto webserver <code>http://debian11:8080/</code>:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">openssl req -new -out server.csr -key server.key</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">You are about to be asked to enter information that will be incorporated</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">into your certificate request.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">What you are about to enter is what is called a Distinguished Name or a DN.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">There are quite a few fields but you can leave some blank</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">For some fields there will be a default value,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">If you enter </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;.&#x27;</span><span class="token plain">, the field will be left blank.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-----</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Country Name </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">2</span><span class="token plain"> letter code</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">AU</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain">:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">State or Province Name </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">full name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">Some-State</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain">:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Locality Name </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">eg, city</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain">:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Organization Name </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">eg, company</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">Internet Widgits Pty Ltd</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain">:INSTAR</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Organizational Unit Name </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">eg, section</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain">:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Common Name </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">e.g. server FQDN or YOUR name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain">:debian11</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Email Address </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain">:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Please enter the following </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;extra&#x27;</span><span class="token plain"> attributes</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">to be sent with your certificate request</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">A challenge password </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain">:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">An optional company name </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain">:</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">openssl x509 -req -in server.csr -CA ca.crt -CAkey ca.key -CAcreateserial -out server.crt -days </span><span class="token number">1825</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Signature ok</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">subject</span><span class="token operator">=</span><span class="token plain">C </span><span class="token operator">=</span><span class="token plain"> AU, ST </span><span class="token operator">=</span><span class="token plain"> Some-State, O </span><span class="token operator">=</span><span class="token plain"> INSTAR, CN </span><span class="token operator">=</span><span class="token plain"> debian11</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Getting CA Private Key</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">chown</span><span class="token plain"> mosquitto:mosquitto server.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain">csr,key,crt</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The <code>certs</code> directory should now contain the following files:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">-rw-r--r-- </span><span class="token number">1</span><span class="token plain"> mosquitto mosquitto </span><span class="token number">1956</span><span class="token plain"> Feb </span><span class="token number">16</span><span class="token plain"> </span><span class="token number">20</span><span class="token plain">:31 ca.crt</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-rw------- </span><span class="token number">1</span><span class="token plain"> mosquitto mosquitto </span><span class="token number">3243</span><span class="token plain"> Feb </span><span class="token number">16</span><span class="token plain"> </span><span class="token number">20</span><span class="token plain">:30 ca.key</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-rw-r--r-- </span><span class="token number">1</span><span class="token plain"> root      root        </span><span class="token number">41</span><span class="token plain"> Feb </span><span class="token number">16</span><span class="token plain"> </span><span class="token number">20</span><span class="token plain">:37 ca.srl</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-rw-r--r-- </span><span class="token number">1</span><span class="token plain"> mosquitto mosquitto </span><span class="token number">1834</span><span class="token plain"> Feb </span><span class="token number">16</span><span class="token plain"> </span><span class="token number">20</span><span class="token plain">:37 server.crt</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-rw-r--r-- </span><span class="token number">1</span><span class="token plain"> mosquitto mosquitto </span><span class="token number">1659</span><span class="token plain"> Feb </span><span class="token number">16</span><span class="token plain"> </span><span class="token number">20</span><span class="token plain">:37 server.csr</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-rw------- </span><span class="token number">1</span><span class="token plain"> mosquitto mosquitto </span><span class="token number">3243</span><span class="token plain"> Feb </span><span class="token number">16</span><span class="token plain"> </span><span class="token number">20</span><span class="token plain">:34 server.key</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="mosquitto-server-configuration">Mosquitto Server Configuration<a class="hash-link" href="#mosquitto-server-configuration" title="Direct link to heading">​</a></h4><p>Add the following configuration to <code>/etc/mosquitto/conf.d/custom.conf</code>:</p><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"># -----------------------------------------------------------------</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Certificate based SSL/TLS support</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># -----------------------------------------------------------------</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">listener 8883</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">tls_version tlsv1.2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">cafile /etc/mosquitto/certs/ca.crt</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">certfile /etc/mosquitto/certs/server.crt</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">keyfile /etc/mosquitto/certs/server.key</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Then restart the service:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">service</span><span class="token plain"> mosquitto restart </span><span class="token operator">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">service</span><span class="token plain"> mosquitto status</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="testing-the-connection">Testing the Connection<a class="hash-link" href="#testing-the-connection" title="Direct link to heading">​</a></h4><p>All you need to establish a server connection is the <code>ca.crt</code> file on your client machine. Then you can try to subscribe to the last-will topic of your camera and should receive it&#x27;s online status:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">mosquitto_sub -h debian11 -t </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;cameras/117/status/connection&#x27;</span><span class="token plain"> -p </span><span class="token number">8883</span><span class="token plain"> --insecure --cafile ca.crt --tls-version tlsv1.2 -u admin -P instar -v</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">cameras/117/status/connection </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;val&quot;</span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">:</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;online&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">cameras/117/status/connection </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;val&quot;</span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">:</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;offline&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">cameras/117/status/connection </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;val&quot;</span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">:</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;online&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Or with the <strong>MQTT Explorer</strong>:</p><p><img loading="lazy" alt="Mosquitto2 MQTT Broker" src="/assets/images/Mosquitto2_Broker_06-d9a6501da366813cfae1dbec80dbb4ba.png" width="1014" height="640" class="img_ev3q"></p><p>Add the <code>ca.crt</code> file here:</p><p><img loading="lazy" alt="Mosquitto2 MQTT Broker" src="/assets/images/Mosquitto2_Broker_07-48662b02209b8dd16d92d48521f56778.png" width="1007" height="460" class="img_ev3q"></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="client-certificates">Client Certificates<a class="hash-link" href="#client-certificates" title="Direct link to heading">​</a></h4><p>For more security, you can add client certificates, which need to be signed by the server.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="creating-a-client-certificate">Creating a client certificate<a class="hash-link" href="#creating-a-client-certificate" title="Direct link to heading">​</a></h4><p>Generate client certificates for the MQTT clients. <strong>Important</strong>: Don’t use the server name as FQDN:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">openssl genrsa -out client.key </span><span class="token number">4096</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">openssl req -out client.csr -key client.key -new</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">You are about to be asked to enter information that will be incorporated</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">into your certificate request.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">What you are about to enter is what is called a Distinguished Name or a DN.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">There are quite a few fields but you can leave some blank</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">For some fields there will be a default value,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">If you enter </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;.&#x27;</span><span class="token plain">, the field will be left blank.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-----</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Country Name </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">2</span><span class="token plain"> letter code</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">AU</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain">:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">State or Province Name </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">full name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">Some-State</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain">:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Locality Name </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">eg, city</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain">:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Organization Name </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">eg, company</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">Internet Widgits Pty Ltd</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain">:INSTAR</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Organizational Unit Name </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">eg, section</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain">:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Common Name </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">e.g. server FQDN or YOUR name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain">:mqtt.client</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Email Address </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain">:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Please enter the following </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;extra&#x27;</span><span class="token plain"> attributes</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">to be sent with your certificate request</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">A challenge password </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain">:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">An optional company name </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain">:</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">openssl x509 -req -in client.csr -CA ca.crt --CAkey ca.key --CAcreateserial -out client.crt -days </span><span class="token number">1825</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Signature ok</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">subject</span><span class="token operator">=</span><span class="token plain">C </span><span class="token operator">=</span><span class="token plain"> AU, ST </span><span class="token operator">=</span><span class="token plain"> Some-State, O </span><span class="token operator">=</span><span class="token plain"> INSTAR, CN </span><span class="token operator">=</span><span class="token plain"> mqtt.client</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Getting CA Private Key</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">chown</span><span class="token plain"> mosquitto:mosquitto client.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain">csr,crt,key</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Restart the Mosquitto server:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">service</span><span class="token plain"> mosquitto restart </span><span class="token operator">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">service</span><span class="token plain"> mosquitto status</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="update-the-mosquitto-server-configuration">Update the Mosquitto Server Configuration<a class="hash-link" href="#update-the-mosquitto-server-configuration" title="Direct link to heading">​</a></h4><p>To enforce the usage of client certificates, you will need to add <code>require_certificate true</code> to your listener configuration:</p><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"># -----------------------------------------------------------------</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Certificate based SSL/TLS support</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># -----------------------------------------------------------------</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">listener 8883</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">tls_version tlsv1.2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">cafile /etc/mosquitto/certs/ca.crt</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">certfile /etc/mosquitto/certs/server.crt</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">keyfile /etc/mosquitto/certs/server.key</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">require_certificate true</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="testing-the-connection-1">Testing the Connection<a class="hash-link" href="#testing-the-connection-1" title="Direct link to heading">​</a></h4><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">mosquitto_sub -h debian11 -t </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;cameras/117/status/connection&#x27;</span><span class="token plain"> -p </span><span class="token number">8883</span><span class="token plain"> --insecure --cafile ca.crt --cert client.crt --key client.key --tls-version tlsv1.2 -u admin -P instar -v</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">cameras/117/status/connection </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;val&quot;</span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">:</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;online&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>For the MQTT Explorer upload the Client Key and Cert:</p><p><img loading="lazy" alt="Mosquitto2 MQTT Broker" src="/assets/images/Mosquitto2_Broker_08-0dad0d164bdec7d1fcec4b1112dadab6.png" width="1019" height="571" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="connect-your-instar-ip-camera">Connect your INSTAR IP Camera<a class="hash-link" href="#connect-your-instar-ip-camera" title="Direct link to heading">​</a></h2><p>To connect your INSTAR camera you first have to do 2 things:</p><ol><li>Combine the <code>client.key</code> and <code>client.crt</code> into a single file called <code>client.pem</code>:</li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">-----BEGIN RSA PRIVATE KEY-----</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">MIIJKAIBAAKCAgEAorc0ouM2Uh0pBlZ5IbCSonwOACUCPQ+FqWjhRl5FbAAke2iK</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">l6hxaLG33DoTvYoEbjBEmLtsBAz4sdnTGi2z6HOYfMsqGjMehPJmr2XH/kA</span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-----END RSA PRIVATE KEY-----</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-----BEGIN CERTIFICATE-----</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">MIIFIDCCAwgCFHLf6A9ycbmW6ExF+DBGE3T3qhFAMA0GCSqGSIb3DQEBCwUAMFAx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">CVSpxYNxMG6gIpeIFrTogygOfdc</span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-----END CERTIFICATE-----</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="2"><li>Take the <code>ca.crt</code> and save it as <code>ca.pem</code>.</li></ol><p>Now open your camera&#x27;s SSL Cert menu, add the <code>client.pem</code> as your custom certificate and enable it:</p><p><img loading="lazy" alt="Mosquitto2 MQTT Broker" src="/assets/images/Mosquitto2_Broker_09-e913aafe3d5b36029890eba777843163.png" width="948" height="854" class="img_ev3q"></p><p>And secondly add the <code>ca.pem</code> to the Custom CA Store of your camera:</p><p><img loading="lazy" alt="Mosquitto2 MQTT Broker" src="/assets/images/Mosquitto2_Broker_10-af28ed2051bcea94db91923e43b70d4e.png" width="1063" height="525" class="img_ev3q"></p><p>Configure the client to use your MQTT brokers <strong>Hostname</strong> instead of it&#x27;s local IP to be able to activate the <strong>Verify Certificate</strong> option:</p><p><img loading="lazy" alt="Mosquitto2 MQTT Broker" src="/assets/images/Mosquitto2_Broker_11-5100e12de27ee21cc284f18cee3e24e7.png" width="947" height="767" class="img_ev3q"></p><p>Start your MQTT client and check the <code>http://debian11/tmpfs/mqtt-log</code> - you should see it connect on port <code>8883</code> using <strong>TLS</strong>:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token number">2022</span><span class="token plain">-2-18 </span><span class="token number">4</span><span class="token plain">:11:11: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">Info</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> Config: Version </span><span class="token number">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">2022</span><span class="token plain">-2-18 </span><span class="token number">4</span><span class="token plain">:11:11: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">Info</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> Config: Units loaded: </span><span class="token number">283</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">2022</span><span class="token plain">-2-18 </span><span class="token number">4</span><span class="token plain">:11:11: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">Info</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> Config: Memory required: </span><span class="token number">40749</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">2022</span><span class="token plain">-2-18 </span><span class="token number">4</span><span class="token plain">:11:11: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">Info</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> Authenticate with Mqtt-Broker</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">2022</span><span class="token plain">-2-18 </span><span class="token number">4</span><span class="token plain">:11:11: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">Info</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> Activate TLS</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">2022</span><span class="token plain">-2-18 </span><span class="token number">4</span><span class="token plain">:11:11: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">Info</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> Connect to Mqtt-Broker debian11 on port </span><span class="token number">8883</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">2022</span><span class="token plain">-2-18 </span><span class="token number">4</span><span class="token plain">:11:11: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">Info</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> Synchronize Cgi-Server with Mqtt-Broker</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">2022</span><span class="token plain">-2-18 </span><span class="token number">4</span><span class="token plain">:11:11: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">Info</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> Mqtt listen thread has been started.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">2022</span><span class="token plain">-2-18 </span><span class="token number">4</span><span class="token plain">:11:11: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">Info</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> Synchronize Cgi-Server with Mqtt-Broker</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">2022</span><span class="token plain">-2-18 </span><span class="token number">4</span><span class="token plain">:11:12: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">Info</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> Adapter connected</span><span class="token operator">!</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-tags-row row margin-bottom--sm"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docs/tags/linux">LINUX</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docs/tags/smarthome">Smarthome</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docs/tags/mqtt">MQTT</a></li></ul></div></div><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/IoT-and-Machine-Learning/MQTT/2022-02-01--mosquitto-2-broker/index.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/IoT-and-Machine-Learning/MQTT/2022-03-26--mqtt-clients/2022-03-26"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">MQTT Clients</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/IoT-and-Machine-Learning/MQTT/2021-09-12--golang-paho-mqtt/2021-09-12"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Go Paho MQTT Client</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#install-mosquitto-on-debian-bullseye" class="table-of-contents__link toc-highlight">Install Mosquitto on Debian Bullseye</a></li><li><a href="#configure-mosquitto" class="table-of-contents__link toc-highlight">Configure Mosquitto</a></li><li><a href="#verify-that-the-broker-is-working" class="table-of-contents__link toc-highlight">Verify that the Broker is working</a><ul><li><a href="#mosquitto-cli-tools" class="table-of-contents__link toc-highlight">Mosquitto CLI Tools</a></li><li><a href="#connecting-clients" class="table-of-contents__link toc-highlight">Connecting Clients</a></li></ul></li><li><a href="#websockets" class="table-of-contents__link toc-highlight">Websockets</a><ul><li><a href="#mqtt-explorer" class="table-of-contents__link toc-highlight">MQTT Explorer</a></li><li><a href="#mqttjs-web-client" class="table-of-contents__link toc-highlight">MQTT.js Web Client</a></li></ul></li><li><a href="#mosquitto-webserver" class="table-of-contents__link toc-highlight">Mosquitto Webserver</a></li><li><a href="#adding-encryption" class="table-of-contents__link toc-highlight">Adding Encryption</a><ul><li><a href="#creating-self-signed-certificates" class="table-of-contents__link toc-highlight">Creating Self-Signed Certificates</a></li></ul></li><li><a href="#connect-your-instar-ip-camera" class="table-of-contents__link toc-highlight">Connect your INSTAR IP Camera</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Research</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">Notebook</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/tags">Tags</a></li><li class="footer__item"><a class="footer__link-item" href="/Curriculum-Vitae">CV</a></li></ul></div><div class="col footer__col"><div class="footer__title">Social</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.linkedin.com/in/mike-polinowski-6396ba121/" target="_blank" rel="noopener noreferrer" class="footer__link-item">LinkedIn<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/MikePolinowski" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.flickr.com/people/149680084@N06/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Flickr<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/mpolinowski" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 Mike Polinowski, INSTAR Deutschland GmbH, Shenzhen - China.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.23698315.js"></script>
<script src="/assets/js/main.2d20e69f.js"></script>
</body>
</html>